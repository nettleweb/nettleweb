/*! Copyright (C) 2024 WhiteSpider Dev. All rights reserved. Source: https://whitespider.dev/ !*/
"use strict"; / Created by WhiteSpider Dev. DO NOT remove this comment!!! This will break integrity checks! /;
/*! For license information please see out.js.LICENSE.txt */
(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};e.r(t),e.d(t,{Decoder:()=>me,Encoder:()=>pe,PacketType:()=>ue,protocol:()=>de});var n={};e.r(n),e.d(n,{decode:()=>Qp,encode:()=>Gp});const i=Object.create(null);i.open="0",i.close="1",i.ping="2",i.pong="3",i.message="4",i.upgrade="5",i.noop="6";const r=Object.create(null);Object.keys(i).forEach((e=>{r[i[e]]=e}));const s={type:"error",data:"parser error"},o="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),a="function"==typeof ArrayBuffer,c=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,l=({type:e,data:t},n,r)=>o&&t instanceof Blob?n?r(t):h(t,r):a&&(t instanceof ArrayBuffer||c(t))?n?r(t):h(new Blob([t]),r):r(i[e]+(t||"")),h=(e,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function d(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let u;const p="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<64;e++)p["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=e;const f="function"==typeof ArrayBuffer,m=(e,t)=>{if("string"!=typeof e)return{type:"message",data:_(e,t)};const n=e.charAt(0);return"b"===n?{type:"message",data:g(e.substring(1),t)}:r[n]?e.length>1?{type:r[n],data:e.substring(1)}:{type:r[n]}:s},g=(e,t)=>{if(f){const n=(e=>{let t,n,i,r,s,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const l=new ArrayBuffer(o),h=new Uint8Array(l);for(t=0;t<a;t+=4)n=p[e.charCodeAt(t)],i=p[e.charCodeAt(t+1)],r=p[e.charCodeAt(t+2)],s=p[e.charCodeAt(t+3)],h[c++]=n<<2|i>>4,h[c++]=(15&i)<<4|r>>2,h[c++]=(3&r)<<6|63&s;return l})(e);return _(n,t)}return{base64:!0,data:e}},_=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,y=String.fromCharCode(30);let b;function w(e){return e.reduce(((e,t)=>e+t.length),0)}function v(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let i=0;for(let r=0;r<t;r++)n[r]=e[0][i++],i===e[0].length&&(e.shift(),i=0);return e.length&&i<e[0].length&&(e[0]=e[0].slice(i)),n}function k(e){if(e)return function(e){for(var t in k.prototype)e[t]=k.prototype[t];return e}(e)}k.prototype.on=k.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},k.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},k.prototype.off=k.prototype.removeListener=k.prototype.removeAllListeners=k.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,i=this._callbacks["$"+e];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r=0;r<i.length;r++)if((n=i[r])===t||n.fn===t){i.splice(r,1);break}return 0===i.length&&delete this._callbacks["$"+e],this},k.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(n){i=0;for(var r=(n=n.slice(0)).length;i<r;++i)n[i].apply(this,t)}return this},k.prototype.emitReserved=k.prototype.emit,k.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},k.prototype.hasListeners=function(e){return!!this.listeners(e).length};const C="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function E(e,...t){return t.reduce(((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t)),{})}const T=C.setTimeout,x=C.clearTimeout;function S(e,t){t.useNativeTimers?(e.setTimeoutFn=T.bind(C),e.clearTimeoutFn=x.bind(C)):(e.setTimeoutFn=C.setTimeout.bind(C),e.clearTimeoutFn=C.clearTimeout.bind(C))}class I extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class A extends k{constructor(e){super(),this.writable=!1,S(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new I(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=m(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}(e);return t.length?"?"+t:""}}const N="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),R=64,P={};let O,D=0,L=0;function j(e){let t="";do{t=N[e%R]+t,e=Math.floor(e/R)}while(e>0);return t}function M(){const e=j(+new Date);return e!==O?(D=0,O=e):e+"."+j(D++)}for(;L<R;L++)P[N[L]]=L;let F=!1;try{F="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Md){}const U=F;function z(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||U))return new XMLHttpRequest}catch(e){}if(!t)try{return new(C[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function B(){}const q=null!=new z({xdomain:!1}).responseType;class H extends k{constructor(e,t){super(),S(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.data=void 0!==t.data?t.data:null,this.create()}create(){var e;const t=E(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd;const n=this.xhr=new z(t);try{n.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&n.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{n.setRequestHeader("Accept","*/*")}catch(e){}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{var e;3===n.readyState&&(null===(e=this.opts.cookieJar)||void 0===e||e.parseCookies(n)),4===n.readyState&&(200===n.status||1223===n.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof n.status?n.status:0)}),0))},n.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=H.requestsCount++,H.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=B,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete H.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}function W(){for(let e in H.requests)H.requests.hasOwnProperty(e)&&H.requests[e].abort()}H.requestsCount=0,H.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",W):"function"==typeof addEventListener&&addEventListener("onpagehide"in C?"pagehide":"unload",W,!1));const $="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),V=C.WebSocket||C.MozWebSocket,K="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),Y={websocket:class extends A{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=K?{}:E(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=K?new V(e,t,n):t?new V(e,t):new V(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;l(n,this.supportsBinary,(e=>{try{this.ws.send(e)}catch(e){}i&&$((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=M()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!V}},webtransport:class extends A{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((()=>{this.onClose()})).catch((e=>{this.onError("webtransport error",e)})),this.transport.ready.then((()=>{this.transport.createBidirectionalStream().then((e=>{const t=function(e,t){b||(b=new TextDecoder);const n=[];let i=0,r=-1,o=!1;return new TransformStream({transform(a,c){for(n.push(a);;){if(0===i){if(w(n)<1)break;const e=v(n,1);o=128==(128&e[0]),r=127&e[0],i=r<126?3:126===r?1:2}else if(1===i){if(w(n)<2)break;const e=v(n,2);r=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),i=3}else if(2===i){if(w(n)<8)break;const e=v(n,8),t=new DataView(e.buffer,e.byteOffset,e.length),o=t.getUint32(0);if(o>Math.pow(2,21)-1){c.enqueue(s);break}r=o*Math.pow(2,32)+t.getUint32(4),i=3}else{if(w(n)<r)break;const e=v(n,r);c.enqueue(m(o?e:b.decode(e),t)),i=0}if(0===r||r>e){c.enqueue(s);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),i=new TransformStream({transform(e,t){!function(e,t){o&&e.data instanceof Blob?e.data.arrayBuffer().then(d).then(t):a&&(e.data instanceof ArrayBuffer||c(e.data))?t(d(e.data)):l(e,!1,(e=>{u||(u=new TextEncoder),t(u.encode(e))}))}(e,(n=>{const i=n.length;let r;if(i<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,i);else if(i<65536){r=new Uint8Array(3);const e=new DataView(r.buffer);e.setUint8(0,126),e.setUint16(1,i)}else{r=new Uint8Array(9);const e=new DataView(r.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(i))}e.data&&"string"!=typeof e.data&&(r[0]|=128),t.enqueue(r),t.enqueue(n)}))}});i.readable.pipeTo(e.writable),this.writer=i.writable.getWriter();const r=()=>{n.read().then((({done:e,value:t})=>{e||(this.onPacket(t),r())})).catch((e=>{}))};r();const h={type:"open"};this.query.sid&&(h.data=`{"sid":"${this.query.sid}"}`),this.writer.write(h).then((()=>this.onOpen()))}))})))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;this.writer.write(n).then((()=>{i&&$((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){var e;null===(e=this.transport)||void 0===e||e.close()}},polling:class extends A{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let n=location.port;n||(n=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port}const t=e&&e.forceBase64;this.supportsBinary=q&&!t,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const n=e.split(y),i=[];for(let e=0;e<n.length;e++){const r=m(n[e],t);if(i.push(r),"error"===r.type)break}return i})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const n=e.length,i=new Array(n);let r=0;e.forEach(((e,s)=>{l(e,!1,(e=>{i[s]=e,++r===n&&t(i.join(y))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=M()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new H(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}},G=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Z=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Q(e){if(e.length>2e3)throw"URI too long";const t=e,n=e.indexOf("["),i=e.indexOf("]");-1!=n&&-1!=i&&(e=e.substring(0,n)+e.substring(n,i).replace(/:/g,";")+e.substring(i,e.length));let r=G.exec(e||""),s={},o=14;for(;o--;)s[Z[o]]=r[o]||"";return-1!=n&&-1!=i&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function(e,t){const n=t.replace(/\/{2,9}/g,"/").split("/");return"/"!=t.slice(0,1)&&0!==t.length||n.splice(0,1),"/"==t.slice(-1)&&n.splice(n.length-1,1),n}(0,s.path),s.queryKey=function(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,i){t&&(n[t]=i)})),n}(0,s.query),s}class J extends k{constructor(e,t={}){super(),this.binaryType="arraybuffer",this.writeBuffer=[],e&&"object"==typeof e&&(t=e,e=null),e?(e=Q(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Q(t.host).host),S(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},n=e.split("&");for(let e=0,i=n.length;e<i;e++){let i=n[e].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new Y[e](n)}open(){let e;if(this.opts.rememberUpgrade&&J.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(e){let t=this.createTransport(e),n=!1;J.priorWebsocketSuccess=!1;const i=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!n)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;J.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{n||"closed"!==this.readyState&&(l(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function r(){n||(n=!0,l(),t.close(),t=null)}const s=e=>{const n=new Error("probe error: "+e);n.transport=t.name,r(),this.emitReserved("upgradeError",n)};function o(){s("transport closed")}function a(){s("socket closed")}function c(e){t&&e.name!==t.name&&r()}const l=()=>{t.removeListener("open",i),t.removeListener("error",s),t.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};t.once("open",i),t.once("error",s),t.once("close",o),this.once("close",a),this.once("upgrading",c),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((()=>{n||t.open()}),200):t.open()}onOpen(){if(this.readyState="open",J.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let n=0;n<this.writeBuffer.length;n++){const i=this.writeBuffer[n].data;if(i&&(e+="string"==typeof(t=i)?function(e){let t=0,n=0;for(let i=0,r=e.length;i<r;i++)t=e.charCodeAt(i),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(i++,n+=4);return n}(t):Math.ceil(1.33*(t.byteLength||t.size))),n>0&&e>this.maxPayload)return this.writeBuffer.slice(0,n);e+=2}var t;return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,i){if("function"==typeof t&&(i=t,t=void 0),"function"==typeof n&&(i=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const r={type:e,data:t,options:n};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():e()})):this.upgrading?n():e()),this}onError(e){J.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;const i=e.length;for(;n<i;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}J.protocol=4,J.protocol;const X="function"==typeof ArrayBuffer,ee=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,te=Object.prototype.toString,ne="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===te.call(Blob),ie="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===te.call(File);function re(e){return X&&(e instanceof ArrayBuffer||ee(e))||ne&&e instanceof Blob||ie&&e instanceof File}function se(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(se(e[t]))return!0;return!1}if(re(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return se(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&se(e[t]))return!0;return!1}function oe(e){const t=[],n=e.data,i=e;return i.data=ae(n,t),i.attachments=t.length,{packet:i,buffers:t}}function ae(e,t){if(!e)return e;if(re(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){const n=new Array(e.length);for(let i=0;i<e.length;i++)n[i]=ae(e[i],t);return n}if("object"==typeof e&&!(e instanceof Date)){const n={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=ae(e[i],t));return n}return e}function ce(e,t){return e.data=le(e.data,t),delete e.attachments,e}function le(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=le(e[n],t);else if("object"==typeof e)for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=le(e[n],t));return e}const he=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],de=5;var ue;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(ue||(ue={}));class pe{constructor(e){this.replacer=e}encode(e){return e.type!==ue.EVENT&&e.type!==ue.ACK||!se(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===ue.EVENT?ue.BINARY_EVENT:ue.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==ue.BINARY_EVENT&&e.type!==ue.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=oe(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}}function fe(e){return"[object Object]"===Object.prototype.toString.call(e)}class me extends k{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===ue.BINARY_EVENT;n||t.type===ue.BINARY_ACK?(t.type=n?ue.EVENT:ue.ACK,this.reconstructor=new ge(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!re(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(void 0===ue[n.type])throw new Error("unknown packet type "+n.type);if(n.type===ue.BINARY_EVENT||n.type===ue.BINARY_ACK){const i=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const r=e.substring(i,t);if(r!=Number(r)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(r)}if("/"===e.charAt(t+1)){const i=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);n.nsp=e.substring(i,t)}else n.nsp="/";const i=e.charAt(t+1);if(""!==i&&Number(i)==i){const i=t+1;for(;++t;){const n=e.charAt(t);if(null==n||Number(n)!=n){--t;break}if(t===e.length)break}n.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){const i=this.tryParse(e.substr(t));if(!me.isPayloadValid(n.type,i))throw new Error("invalid payload");n.data=i}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case ue.CONNECT:return fe(t);case ue.DISCONNECT:return void 0===t;case ue.CONNECT_ERROR:return"string"==typeof t||fe(t);case ue.EVENT:case ue.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===he.indexOf(t[0]));case ue.ACK:case ue.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class ge{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=ce(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function _e(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const ye=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class be extends k{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[_e(e,"open",this.onopen.bind(this)),_e(e,"packet",this.onpacket.bind(this)),_e(e,"error",this.onerror.bind(this)),_e(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(ye.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const n={type:ue.EVENT,data:t,options:{}};if(n.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,i=t.pop();this._registerAckCallback(e,i),n.id=e}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){var n;const i=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===i)return void(this.acks[e]=t);const r=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))}),i),s=(...e)=>{this.io.clearTimeoutFn(r),t.apply(this,e)};s.withError=!0,this.acks[e]=s}emitWithAck(e,...t){return new Promise(((n,i)=>{const r=(e,t)=>e?i(e):n(t);r.withError=!0,t.push(r),this.emit(e,...t)}))}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push(((e,...i)=>{if(n===this._queue[0])return null!==e?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)):(this._queue.shift(),t&&t(null,...i)),n.pending=!1,this._drainQueue()})),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth((e=>{this._sendConnectPacket(e)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:ue.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach((e=>{if(!this.sendBuffer.some((t=>String(t.id)===e))){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}}))}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case ue.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ue.EVENT:case ue.BINARY_EVENT:this.onevent(e);break;case ue.ACK:case ue.BINARY_ACK:this.onack(e);break;case ue.DISCONNECT:this.ondisconnect();break;case ue.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...i){n||(n=!0,t.packet({type:ue.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ue.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function we(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}we.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},we.prototype.reset=function(){this.attempts=0},we.prototype.setMin=function(e){this.ms=e},we.prototype.setMax=function(e){this.max=e},we.prototype.setJitter=function(e){this.jitter=e};class ve extends k{constructor(e,n){var i;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(n=e,e=void 0),(n=n||{}).path=n.path||"/socket.io",this.opts=n,S(this,n),this.reconnection(!1!==n.reconnection),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(i=n.randomizationFactor)&&void 0!==i?i:.5),this.backoff=new we({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==n.timeout?2e4:n.timeout),this._readyState="closed",this.uri=e;const r=n.parser||t;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=!1!==n.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new J(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=_e(t,"open",(function(){n.onopen(),e&&e()})),r=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},s=_e(t,"error",r);if(!1!==this._timeout){const e=this._timeout,n=this.setTimeoutFn((()=>{i(),r(new Error("timeout")),t.close()}),e);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}return this.subs.push(i),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(_e(e,"ping",this.onping.bind(this)),_e(e,"data",this.ondata.bind(this)),_e(e,"error",this.onerror.bind(this)),_e(e,"close",this.onclose.bind(this)),_e(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){$((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new be(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const e of t)if(this.nsps[e].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn((()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()})))}),t);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const ke={};function Ce(e,t){"object"==typeof e&&(t=e,e=void 0);const n=function(e,t="",n){let i=e;n=n||"undefined"!=typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==n?n.protocol+"//"+e:"https://"+e),i=Q(e)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const r=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+r+":"+i.port+t,i.href=i.protocol+"://"+r+(n&&n.port===i.port?"":":"+i.port),i}(e,(t=t||{}).path||"/socket.io"),i=n.source,r=n.id,s=n.path,o=ke[r]&&s in ke[r].nsps;let a;return t.forceNew||t["force new connection"]||!1===t.multiplex||o?a=new ve(i,t):(ke[r]||(ke[r]=new ve(i,t)),a=ke[r]),n.query&&!t.query&&(t.query=n.queryKey),a.socket(n.path,t)}Object.assign(Ce,{Manager:ve,Socket:be,io:Ce,connect:Ce});const Ee=function(e,t){if(!e)throw Te(t)},Te=function(e){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},xe=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},Se={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){const r=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,l=r>>2,h=(3&r)<<4|o>>4;let d=(15&o)<<2|c>>6,u=63&c;a||(u=64,s||(d=64)),i.push(n[l],n[h],n[d],n[u])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(xe(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){const s=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(s>>10)),t[i++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){const r=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==r||null==s||null==o||null==a)throw new Ie;const c=r<<2|s>>4;if(i.push(c),64!==o){const e=s<<4&240|o>>2;if(i.push(e),64!==a){const e=o<<6&192|a;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Ie extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ae=function(e){const t=xe(e);return Se.encodeByteArray(t,!0)},Ne=function(e){return Ae(e).replace(/\./g,"")},Re=function(e){try{return Se.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Pe(e){return Oe(void 0,e)}function Oe(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=Oe(e[n],t[n]));return e}const De=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e.g)return e.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&Re(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},Le=()=>{var e;return null===(e=De())||void 0===e?void 0:e.config};class je{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function Me(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}function Fe(){try{return"object"==typeof indexedDB}catch(e){return!1}}function Ue(){return new Promise(((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}class ze extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,ze.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Be.prototype.create)}}class Be{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],s=r?function(e,t){return e.replace(qe,((e,n)=>{const i=t[n];return null!=i?String(i):`<${n}?>`}))}(r,n):"Error",o=`${this.serviceName}: ${s} (${i}).`;return new ze(i,o,n)}}const qe=/\{\$([^}]+)}/g;function He(e){return JSON.parse(e)}function We(e){return JSON.stringify(e)}const $e=function(e){let t={},n={},i={},r="";try{const s=e.split(".");t=He(Re(s[0])||""),n=He(Re(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:i,signature:r}};function Ve(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Ke(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function Ye(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Ge(e,t,n){const i={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function Ze(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const r of n){if(!i.includes(r))return!1;const n=e[r],s=t[r];if(Qe(n)&&Qe(s)){if(!Ze(n,s))return!1}else if(n!==s)return!1}for(const e of i)if(!n.includes(e))return!1;return!0}function Qe(e){return null!==e&&"object"==typeof e}class Je{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let i=0;i<16;i++)n[i]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let i=0;i<16;i++)n[i]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){const t=n[e-3]^n[e-8]^n[e-14]^n[e-16];n[e]=4294967295&(t<<1|t>>>31)}let i,r,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],l=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(i=c^o&(a^c),r=1518500249):(i=o^a^c,r=1859775393):e<60?(i=o&a|c&(o|a),r=2400959708):(i=o^a^c,r=3395469782);const t=(s<<5|s>>>27)+i+l+r+n[e]&4294967295;l=c,c=a,a=4294967295&(o<<30|o>>>2),o=s,s=t}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let i=0;const r=this.buf_;let s=this.inbuf_;for(;i<t;){if(0===s)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(r[s]=e.charCodeAt(i),++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}else for(;i<t;)if(r[s]=e[i],++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let i=24;i>=0;i-=8)e[n]=this.chain_[t]>>i&255,++n;return e}}function Xe(e,t){return`${e} failed: ${t} argument `}const et=function(e){let t=0;for(let n=0;n<e.length;n++){const i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t},tt=1e3,nt=2,it=144e5,rt=.5;function st(e,t=tt,n=nt){const i=t*Math.pow(n,e),r=Math.round(rt*i*(Math.random()-.5)*2);return Math.min(it,i+r)}function ot(e){return e&&e._delegate?e._delegate:e}class at{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const ct="[DEFAULT]";class lt{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new je;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(i)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:ct})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=ct){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=ct){return this.instances.has(e)}getOptions(e=ct){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);const s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=e,i===ct?void 0:i),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var i;return n||null}normalizeInstanceIdentifier(e=ct){return this.component?this.component.multipleInstances?e:ct:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ht{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new lt(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const dt=[];var ut;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(ut||(ut={}));const pt={debug:ut.DEBUG,verbose:ut.VERBOSE,info:ut.INFO,warn:ut.WARN,error:ut.ERROR,silent:ut.SILENT},ft=ut.INFO,mt={[ut.DEBUG]:"log",[ut.VERBOSE]:"log",[ut.INFO]:"info",[ut.WARN]:"warn",[ut.ERROR]:"error"},gt=(e,t,...n)=>{if(t<e.logLevel)return;const i=(new Date).toISOString(),r=mt[t];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[r](`[${i}]  ${e.name}:`,...n)};class _t{constructor(e){this.name=e,this._logLevel=ft,this._logHandler=gt,this._userLogHandler=null,dt.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ut))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?pt[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ut.DEBUG,...e),this._logHandler(this,ut.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ut.VERBOSE,...e),this._logHandler(this,ut.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ut.INFO,...e),this._logHandler(this,ut.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ut.WARN,...e),this._logHandler(this,ut.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ut.ERROR,...e),this._logHandler(this,ut.ERROR,...e)}}const yt=(e,t)=>t.some((t=>e instanceof t));let bt,wt;const vt=new WeakMap,kt=new WeakMap,Ct=new WeakMap,Et=new WeakMap,Tt=new WeakMap;let xt={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return kt.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Ct.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return It(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function St(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(wt||(wt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(At(this),e),It(vt.get(this))}:function(...e){return It(t.apply(At(this),e))}:function(e,...n){const i=t.call(At(this),e,...n);return Ct.set(i,e.sort?e.sort():[e]),It(i)}:(e instanceof IDBTransaction&&function(e){if(kt.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)}));kt.set(e,t)}(e),yt(e,bt||(bt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,xt):e);var t}function It(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(It(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&vt.set(t,e)})).catch((()=>{})),Tt.set(t,e),t}(e);if(Et.has(e))return Et.get(e);const t=St(e);return t!==e&&(Et.set(e,t),Tt.set(t,e)),t}const At=e=>Tt.get(e);function Nt(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(e,t),a=It(o);return i&&o.addEventListener("upgradeneeded",(e=>{i(It(o.result),e.oldVersion,e.newVersion,It(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),r&&e.addEventListener("versionchange",(e=>r(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}const Rt=["get","getKey","getAll","getAllKeys","count"],Pt=["put","add","delete","clear"],Ot=new Map;function Dt(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Ot.get(t))return Ot.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,r=Pt.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!Rt.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,r?"readwrite":"readonly");let o=s.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&s.done]))[0]};return Ot.set(t,s),s}var Lt;Lt=xt,xt={...Lt,get:(e,t,n)=>Dt(e,t)||Lt.get(e,t,n),has:(e,t)=>!!Dt(e,t)||Lt.has(e,t)};class jt{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const Mt="@firebase/app",Ft="0.10.3",Ut=new _t("@firebase/app"),zt="[DEFAULT]",Bt={[Mt]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/vertexai-preview":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},qt=new Map,Ht=new Map,Wt=new Map;function $t(e,t){try{e.container.addComponent(t)}catch(n){Ut.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function Vt(e){const t=e.name;if(Wt.has(t))return Ut.debug(`There were multiple attempts to register component ${t}.`),!1;Wt.set(t,e);for(const t of qt.values())$t(t,e);for(const t of Ht.values())$t(t,e);return!0}function Kt(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const Yt=new Be("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Gt{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new at("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Yt.create("app-deleted",{appName:this._name})}}function Zt(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const i=Object.assign({name:zt,automaticDataCollectionEnabled:!1},t),r=i.name;if("string"!=typeof r||!r)throw Yt.create("bad-app-name",{appName:String(r)});if(n||(n=Le()),!n)throw Yt.create("no-options");const s=qt.get(r);if(s){if(Ze(n,s.options)&&Ze(i,s.config))return s;throw Yt.create("duplicate-app",{appName:r})}const o=new ht(r);for(const e of Wt.values())o.addComponent(e);const a=new Gt(n,i,o);return qt.set(r,a),a}function Qt(e=zt){const t=qt.get(e);if(!t&&e===zt&&Le())return Zt();if(!t)throw Yt.create("no-app",{appName:e});return t}function Jt(e,t,n){var i;let r=null!==(i=Bt[e])&&void 0!==i?i:e;n&&(r+=`-${n}`);const s=r.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${r}" with version "${t}":`];return s&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Ut.warn(e.join(" "))}Vt(new at(`${r}-version`,(()=>({library:r,version:t})),"VERSION"))}const Xt="firebase-heartbeat-database",en=1,tn="firebase-heartbeat-store";let nn=null;function rn(){return nn||(nn=Nt(Xt,en,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(tn)}catch(e){console.warn(e)}}}).catch((e=>{throw Yt.create("idb-open",{originalErrorMessage:e.message})}))),nn}async function sn(e,t){try{const n=(await rn()).transaction(tn,"readwrite"),i=n.objectStore(tn);await i.put(t,on(e)),await n.done}catch(e){if(e instanceof ze)Ut.warn(e.message);else{const t=Yt.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});Ut.warn(t.message)}}}function on(e){return`${e.name}!${e.options.appId}`}class an{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ln(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=cn();if((null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==i&&!this._heartbeatsCache.heartbeats.some((e=>e.date===i)))return this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=cn(),{heartbeatsToSend:n,unsentEntries:i}=function(e,t=1024){const n=[];let i=e.slice();for(const r of e){const e=n.find((e=>e.agent===r.agent));if(e){if(e.dates.push(r.date),hn(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),hn(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),r=Ne(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function cn(){return(new Date).toISOString().substring(0,10)}class ln{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Fe()&&Ue().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await rn()).transaction(tn),n=await t.objectStore(tn).get(on(e));return await t.done,n}catch(e){if(e instanceof ze)Ut.warn(e.message);else{const t=Yt.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});Ut.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return sn(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return sn(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function hn(e){return Ne(JSON.stringify({version:2,heartbeats:e})).length}Vt(new at("platform-logger",(e=>new jt(e)),"PRIVATE")),Vt(new at("heartbeat",(e=>new an(e)),"PRIVATE")),Jt(Mt,Ft,""),Jt(Mt,Ft,"esm2017"),Jt("fire-js",""),Jt("firebase","10.12.0","app");const dn="@firebase/installations",un="0.6.7",pn=1e4,fn=`w:${un}`,mn="FIS_v2",gn="https://firebaseinstallations.googleapis.com/v1",_n=36e5,yn=new Be("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function bn(e){return e instanceof ze&&e.code.includes("request-failed")}function wn({projectId:e}){return`${gn}/projects/${e}/installations`}function vn(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function kn(e,t){const n=(await t.json()).error;return yn.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Cn({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function En(e){const t=await e();return t.status>=500&&t.status<600?e():t}function Tn(e){return new Promise((t=>{setTimeout(t,e)}))}const xn=/^[cdef][\w-]{21}$/,Sn="";function In(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){var t;return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(e);return xn.test(t)?t:Sn}catch(e){return Sn}}function An(e){return`${e.appName}!${e.appId}`}const Nn=new Map;function Rn(e,t){const n=An(e);Pn(n,t),function(e,t){const n=(!On&&"BroadcastChannel"in self&&(On=new BroadcastChannel("[Firebase] FID Change"),On.onmessage=e=>{Pn(e.data.key,e.data.fid)}),On);n&&n.postMessage({key:e,fid:t}),0===Nn.size&&On&&(On.close(),On=null)}(n,t)}function Pn(e,t){const n=Nn.get(e);if(n)for(const e of n)e(t)}let On=null;const Dn="firebase-installations-database",Ln=1,jn="firebase-installations-store";let Mn=null;function Fn(){return Mn||(Mn=Nt(Dn,Ln,{upgrade:(e,t)=>{0===t&&e.createObjectStore(jn)}})),Mn}async function Un(e,t){const n=An(e),i=(await Fn()).transaction(jn,"readwrite"),r=i.objectStore(jn),s=await r.get(n);return await r.put(t,n),await i.done,s&&s.fid===t.fid||Rn(e,t.fid),t}async function zn(e){const t=An(e),n=(await Fn()).transaction(jn,"readwrite");await n.objectStore(jn).delete(t),await n.done}async function Bn(e,t){const n=An(e),i=(await Fn()).transaction(jn,"readwrite"),r=i.objectStore(jn),s=await r.get(n),o=t(s);return void 0===o?await r.delete(n):await r.put(o,n),await i.done,!o||s&&s.fid===o.fid||Rn(e,o.fid),o}async function qn(e){let t;const n=await Bn(e.appConfig,(n=>{const i=function(e){return $n(e||{fid:In(),registrationStatus:0})}(n),r=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(yn.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const i=wn(e),r=Cn(e),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}const o={fid:n,authVersion:mn,appId:e.appId,sdkVersion:fn},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await En((()=>fetch(i,a)));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:vn(e.authToken)}}throw await kn("Create Installation",c)}(e,t);return Un(e.appConfig,n)}catch(n){throw bn(n)&&409===n.customData.serverCode?await zn(e.appConfig):await Un(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:i}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:Hn(e)}:{installationEntry:t}}(e,i);return t=r.registrationPromise,r.installationEntry}));return n.fid===Sn?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function Hn(e){let t=await Wn(e.appConfig);for(;1===t.registrationStatus;)await Tn(100),t=await Wn(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await qn(e);return n||t}return t}function Wn(e){return Bn(e,(e=>{if(!e)throw yn.create("installation-not-found");return $n(e)}))}function $n(e){return 1===(t=e).registrationStatus&&t.registrationTime+pn<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function Vn({appConfig:e,heartbeatServiceProvider:t},n){const i=function(e,{fid:t}){return`${wn(e)}/${t}/authTokens:generate`}(e,n),r=function(e,{refreshToken:t}){const n=Cn(e);return n.append("Authorization",function(e){return`${mn} ${e}`}(t)),n}(e,n),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}const o={installation:{sdkVersion:fn,appId:e.appId}},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await En((()=>fetch(i,a)));if(c.ok)return vn(await c.json());throw await kn("Generate Auth Token",c)}async function Kn(e,t=!1){let n;const i=await Bn(e.appConfig,(i=>{if(!Gn(i))throw yn.create("not-registered");const r=i.authToken;if(!t&&(2===(s=r).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+_n}(s)))return i;var s;if(1===r.requestStatus)return n=async function(e,t){let n=await Yn(e.appConfig);for(;1===n.authToken.requestStatus;)await Tn(100),n=await Yn(e.appConfig);const i=n.authToken;return 0===i.requestStatus?Kn(e,t):i}(e,t),i;{if(!navigator.onLine)throw yn.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(i);return n=async function(e,t){try{const n=await Vn(e,t),i=Object.assign(Object.assign({},t),{authToken:n});return await Un(e.appConfig,i),n}catch(n){if(!bn(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await Un(e.appConfig,n)}else await zn(e.appConfig);throw n}}(e,t),t}}));return n?await n:i.authToken}function Yn(e){return Bn(e,(e=>{if(!Gn(e))throw yn.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+pn<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t}))}function Gn(e){return void 0!==e&&2===e.registrationStatus}function Zn(e){return yn.create("missing-app-config-values",{valueName:e})}const Qn="installations";Vt(new at(Qn,(e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw Zn("App Configuration");if(!e.name)throw Zn("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw Zn(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:Kt(t,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),Vt(new at("installations-internal",(e=>{const t=Kt(e.getProvider("app").getImmediate(),Qn).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:i}=await qn(t);return i?i.catch(console.error):Kn(t).catch(console.error),n.fid}(t),getToken:e=>async function(e,t=!1){const n=e;return await async function(e){const{registrationPromise:t}=await qn(e);t&&await t}(n),(await Kn(n,t)).token}(t,e)}}),"PRIVATE")),Jt(dn,un),Jt(dn,un,"esm2017");const Jn="analytics",Xn="firebase_id",ei="origin",ti=6e4,ni="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",ii="https://www.googletagmanager.com/gtag/js",ri=new _t("@firebase/analytics"),si=new Be("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function oi(e){if(!e.startsWith(ii)){const t=si.create("invalid-gtag-resource",{gtagURL:e});return ri.warn(t.message),""}return e}function ai(e){return Promise.all(e.map((e=>e.catch((e=>e)))))}const ci=30,li=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function hi(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function di(e,t=li,n){const{appId:i,apiKey:r,measurementId:s}=e.options;if(!i)throw si.create("no-app-id");if(!r){if(s)return{measurementId:s,appId:i};throw si.create("no-api-key")}const o=t.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new pi;return setTimeout((async()=>{a.abort()}),void 0!==n?n:ti),ui({appId:i,apiKey:r,measurementId:s},o,a,t)}async function ui(e,{throttleEndTimeMillis:t,backoffCount:n},i,r=li){var s;const{appId:o,measurementId:a}=e;try{await function(e,t){return new Promise(((n,i)=>{const r=Math.max(t-Date.now(),0),s=setTimeout(n,r);e.addEventListener((()=>{clearTimeout(s),i(si.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}(i,t)}catch(e){if(a)return ri.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:o,measurementId:a};throw e}try{const t=await async function(e){var t;const{appId:n,apiKey:i}=e,r={method:"GET",headers:hi(i)},s=ni.replace("{app-id}",n),o=await fetch(s,r);if(200!==o.status&&304!==o.status){let e="";try{const n=await o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(e){}throw si.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()}(e);return r.deleteThrottleMetadata(o),t}catch(t){const c=t;if(!function(e){if(!(e instanceof ze&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(c)){if(r.deleteThrottleMetadata(o),a)return ri.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw t}const l=503===Number(null===(s=null==c?void 0:c.customData)||void 0===s?void 0:s.httpStatus)?st(n,r.intervalMillis,ci):st(n,r.intervalMillis),h={throttleEndTimeMillis:Date.now()+l,backoffCount:n+1};return r.setThrottleMetadata(o,h),ri.debug(`Calling attemptFetch again in ${l} millis`),ui(e,h,i,r)}}class pi{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach((e=>e()))}}let fi,mi;async function gi(e,t,n,i,r,s,o){var a;const c=di(e);c.then((t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&ri.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((e=>ri.error(e))),t.push(c);const l=async function(){if(!Fe())return ri.warn(si.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await Ue()}catch(e){return ri.warn(si.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then((e=>e?i.getId():void 0)),[h,d]=await Promise.all([c,l]);(function(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(ii)&&n.src.includes(e))return n;return null})(s)||function(e,t){const n=function(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",t)),n}(0,{createScriptURL:oi}),i=document.createElement("script"),r=`${ii}?l=${e}&id=${t}`;i.src=n?null==n?void 0:n.createScriptURL(r):r,i.async=!0,document.head.appendChild(i)}(s,h.measurementId),mi&&(r("consent","default",mi),mi=void 0),r("js",new Date);const u=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return u[ei]="firebase",u.update=!0,null!=d&&(u[Xn]=d),r("config",h.measurementId,u),fi&&(r("set",fi),fi=void 0),h.measurementId}class _i{constructor(e){this.app=e}_delete(){return delete yi[this.app.options.appId],Promise.resolve()}}let yi={},bi=[];const wi={};let vi,ki,Ci="dataLayer",Ei=!1;function Ti(e,t,n){!function(){const e=[];if(function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()&&e.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||e.push("Cookies are not available."),e.length>0){const t=e.map(((e,t)=>`(${t+1}) ${e}`)).join(" "),n=si.create("invalid-analytics-context",{errorInfo:t});ri.warn(n.message)}}();const i=e.options.appId;if(!i)throw si.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw si.create("no-api-key");ri.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=yi[i])throw si.create("already-exists",{id:i});if(!Ei){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(Ci);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,i,r){let s=function(...e){window[i].push(arguments)};return window[r]&&"function"==typeof window[r]&&(s=window[r]),window[r]=function(e,t,n,i){return async function(r,...s){try{if("event"===r){const[i,r]=s;await async function(e,t,n,i,r){try{let s=[];if(r&&r.send_to){let e=r.send_to;Array.isArray(e)||(e=[e]);const i=await ai(n);for(const n of e){const e=i.find((e=>e.measurementId===n)),r=e&&t[e.appId];if(!r){s=[];break}s.push(r)}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",i,r||{})}catch(e){ri.error(e)}}(e,t,n,i,r)}else if("config"===r){const[r,o]=s;await async function(e,t,n,i,r,s){const o=i[r];try{if(o)await t[o];else{const e=(await ai(n)).find((e=>e.measurementId===r));e&&await t[e.appId]}}catch(e){ri.error(e)}e("config",r,s)}(e,t,n,i,r,o)}else if("consent"===r){const[t]=s;e("consent","update",t)}else if("get"===r){const[t,n,i]=s;e("get",t,n,i)}else if("set"===r){const[t]=s;e("set",t)}else e(r,...s)}catch(e){ri.error(e)}}}(s,e,t,n),{gtagCore:s,wrappedGtag:window[r]}}(yi,bi,wi,Ci,"gtag");ki=e,vi=t,Ei=!0}return yi[i]=gi(e,bi,wi,t,vi,Ci,n),new _i(e)}const xi="@firebase/analytics",Si="0.10.3";Vt(new at(Jn,((e,{options:t})=>Ti(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)),"PUBLIC")),Vt(new at("analytics-internal",(function(e){try{const t=e.getProvider(Jn).getImmediate();return{logEvent:(e,n,i)=>function(e,t,n,i){e=ot(e),async function(e,t,n,i,r){if(r&&r.global)e("event",n,i);else{const r=await t;e("event",n,Object.assign(Object.assign({},i),{send_to:r}))}}(ki,yi[e.app.options.appId],t,n,i).catch((e=>ri.error(e)))}(t,e,n,i)}}catch(e){throw si.create("interop-component-reg-failed",{reason:e})}}),"PRIVATE")),Jt(xi,Si),Jt(xi,Si,"esm2017");const Ii="@firebase/database",Ai="1.0.5";let Ni="";class Ri{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),We(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:He(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Pi{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Ve(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const Oi=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Ri(t)}}catch(e){}return new Pi},Di=Oi("localStorage"),Li=Oi("sessionStorage"),ji=new _t("@firebase/database"),Mi=function(){let e=1;return function(){return e++}}(),Fi=function(e){const t=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);if(r>=55296&&r<=56319){const t=r-55296;i++,Ee(i<e.length,"Surrogate pair missing trail surrogate."),r=65536+(t<<10)+(e.charCodeAt(i)-56320)}r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):r<65536?(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t}(e),n=new Je;n.update(t);const i=n.digest();return Se.encodeByteArray(i)},Ui=function(...e){let t="";for(let n=0;n<e.length;n++){const i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=Ui.apply(null,i):t+="object"==typeof i?We(i):i,t+=" "}return t};let zi=null,Bi=!0;const qi=function(...e){if(!0===Bi&&(Bi=!1,null===zi&&!0===Li.get("logging_enabled")&&(t=!0,Ee(!n||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(ji.logLevel=ut.VERBOSE,zi=ji.log.bind(ji),n&&Li.set("logging_enabled",!0)):"function"==typeof t?zi=t:(zi=null,Li.remove("logging_enabled")))),zi){const t=Ui.apply(null,e);zi(t)}var t,n},Hi=function(e){return function(...t){qi(e,...t)}},Wi=function(...e){const t="FIREBASE INTERNAL ERROR: "+Ui(...e);ji.error(t)},$i=function(...e){const t=`FIREBASE FATAL ERROR: ${Ui(...e)}`;throw ji.error(t),new Error(t)},Vi=function(...e){const t="FIREBASE WARNING: "+Ui(...e);ji.warn(t)},Ki=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},Yi="[MIN_NAME]",Gi="[MAX_NAME]",Zi=function(e,t){if(e===t)return 0;if(e===Yi||t===Gi)return-1;if(t===Yi||e===Gi)return 1;{const n=rr(e),i=rr(t);return null!==n?null!==i?n-i==0?e.length-t.length:n-i:-1:null!==i?1:e<t?-1:1}},Qi=function(e,t){return e===t?0:e<t?-1:1},Ji=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+We(t))},Xi=function(e){if("object"!=typeof e||null===e)return We(e);const t=[];for(const n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=We(t[i]),n+=":",n+=Xi(e[t[i]]);return n+="}",n},er=function(e,t){const n=e.length;if(n<=t)return[e];const i=[];for(let r=0;r<n;r+=t)r+t>n?i.push(e.substring(r,n)):i.push(e.substring(r,r+t));return i};function tr(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const nr=function(e){Ee(!Ki(e),"Invalid JSON number");let t,n,i,r,s;0===e?(n=0,i=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(r=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),n=r+1023,i=Math.round(e*Math.pow(2,52-r)-Math.pow(2,52))):(n=0,i=Math.round(e/Math.pow(2,-1074))));const o=[];for(s=52;s;s-=1)o.push(i%2?1:0),i=Math.floor(i/2);for(s=11;s;s-=1)o.push(n%2?1:0),n=Math.floor(n/2);o.push(t?1:0),o.reverse();const a=o.join("");let c="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()},ir=new RegExp("^-?(0*)\\d{1,10}$"),rr=function(e){if(ir.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},sr=function(e){try{e()}catch(e){setTimeout((()=>{const t=e.stack||"";throw Vi("Exception was thrown by user callback.",t),e}),Math.floor(0))}},or=function(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class ar{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((e=>this.appCheck=e))}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){Vi(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class cr{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(qi("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Vi(e)}}class lr{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}lr.OWNER="owner";const hr="5",dr=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ur="ac",pr="websocket",fr="long_polling";class mr{constructor(e,t,n,i,r=!1,s="",o=!1,a=!1){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Di.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Di.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function gr(e,t,n){let i;if(Ee("string"==typeof t,"typeof type must == string"),Ee("object"==typeof n,"typeof params must == object"),t===pr)i=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==fr)throw new Error("Unknown connection type: "+t);i=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const r=[];return tr(n,((e,t)=>{r.push(e+"="+t)})),i+r.join("&")}class _r{constructor(){this.counters_={}}incrementCounter(e,t=1){Ve(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Pe(this.counters_)}}const yr={},br={};function wr(e){const t=e.toString();return yr[t]||(yr[t]=new _r),yr[t]}class vr{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&sr((()=>{this.onMessage_(e[t])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const kr="start";class Cr{constructor(e,t,n,i,r,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Hi(e),this.stats_=wr(t),this.urlFn=e=>(this.appCheckToken&&(e[ur]=this.appCheckToken),gr(t,fr,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new vr(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new Er(((...e)=>{const[t,n,i,r,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===kr)this.id=n,this.password=i;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)}),(()=>{this.onClosed_()}),this.urlFn);const e={};e[kr]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=hr,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[ur]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&dr.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Cr.forceAllow_=!0}static forceDisallow(){Cr.forceDisallow_=!0}static isAvailable(){return!(!Cr.forceAllow_&&(Cr.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=We(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=Ae(t),i=er(n,1840);for(let e=0;e<i.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=We(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Er{constructor(e,t,n,i){this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Mi(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Er.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";<\/script>');const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){qi("frame writing exception"),e.stack&&qi(e.stack),qi(e)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||qi("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){const e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(i),n()}))}addTag(e,t){setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{qi("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}}),Math.floor(1))}}let Tr=null;"undefined"!=typeof MozWebSocket?Tr=MozWebSocket:"undefined"!=typeof WebSocket&&(Tr=WebSocket);class xr{constructor(e,t,n,i,r,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Hi(this.connId),this.stats_=wr(t),this.connURL=xr.connectionURL_(t,s,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,r){const s={};return s.v=hr,"undefined"!=typeof location&&location.hostname&&dr.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),i&&(s[ur]=i),r&&(s.p=r),gr(e,pr,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Di.set("previous_websocket_failure",!0);try{let e;0,this.mySock=new Tr(this.connURL,[],e)}catch(e){this.log_("Error instantiating WebSocket.");const t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){xr.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==Tr&&!xr.forceDisallow_}static previouslyFailed(){return Di.isInMemoryStorage||!0===Di.get("previous_websocket_failure")}markConnectionHealthy(){Di.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=He(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Ee(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=We(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=er(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}xr.responsesRequiredToBeHealthy=2,xr.healthyTimeout=3e4;class Sr{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Cr,xr]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=xr&&xr.isAvailable();let n=t&&!xr.previouslyFailed();if(e.webSocketOnly&&(t||Vi("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[xr];else{const e=this.transports_=[];for(const t of Sr.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);Sr.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Sr.globalTransportInitialized_=!1;class Ir{constructor(e,t,n,i,r,s,o,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Hi("c:"+this.id+":"),this.transportManager_=new Sr(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=or((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Ji("t",e),n=Ji("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Ji("t",e),n=Ji("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Ji("t",e);if("d"in e){const n=e.d;if("h"===t){const e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?Wi("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Wi("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),hr!==n&&Vi("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),or((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):or((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Di.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Ar{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class Nr{constructor(e){this.allowedEvents_=e,this.listeners_={},Ee(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let e=0;e<i.length;e++)if(i[e].callback===t&&(!n||n===i[e].context))return void i.splice(e,1)}validateEventType_(e){Ee(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class Rr extends Nr{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Me()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new Rr}getInitialEvent(e){return Ee("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class Pr{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function Or(){return new Pr("")}function Dr(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function Lr(e){return e.pieces_.length-e.pieceNum_}function jr(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new Pr(e.pieces_,t)}function Mr(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Fr(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function Ur(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new Pr(t,0)}function zr(e,t){const n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof Pr)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new Pr(n,0)}function Br(e){return e.pieceNum_>=e.pieces_.length}function qr(e,t){const n=Dr(e),i=Dr(t);if(null===n)return t;if(n===i)return qr(jr(e),jr(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Hr(e,t){if(Lr(e)!==Lr(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function Wr(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(Lr(e)>Lr(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class $r{constructor(e,t){this.errorPrefix_=t,this.parts_=Fr(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=et(this.parts_[e]);Vr(this)}}function Vr(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+Kr(e))}function Kr(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class Yr extends Nr{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}static getInstance(){return new Yr}getInitialEvent(e){return Ee("visible"===e,"Unknown event type: "+e),[this.visible_]}}const Gr=1e3;class Zr extends Ar{constructor(e,t,n,i,r,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=Zr.nextPersistentConnectionId_++,this.log_=Hi("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Gr,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Yr.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&Rr.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_(We(r)),Ee(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),n&&(this.requestCBHash_[i]=n)}get(e){this.initConnection_();const t=new je,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,i){this.initConnection_();const r=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+r),this.listens.has(s)||this.listens.set(s,new Map),Ee(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Ee(!this.listens.get(s).has(r),"listen() called twice for same path/queryId.");const o={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(s).set(r,o),this.connected_&&this.sendListen_(o)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);const r={p:n};e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest("q",r,(r=>{const s=r.d,o=r.s;Zr.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",r),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,s))}))}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&Ve(e,"w")){const n=Ke(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();Vi(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=$e(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=$e(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)}))}unlisten(e,t){const n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),Ee(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);const r={p:e};i&&(r.q=n,r.t=i),this.sendRequest("n",r)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){const r={p:t,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,(e=>{i&&setTimeout((()=>{i(e.s,e.d)}),Math.floor(0))}))}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,r){this.initConnection_();const s={p:t,d:n};void 0!==r&&(s.h=r),this.outstandingPuts_.push({action:e,request:s,onComplete:i}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+We(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):Wi("Unrecognized action received from server: "+We(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Ee(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Gr,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Gr,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Gr),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Zr.nextConnectionId_++,r=this.lastSessionId;let s=!1,o=null;const a=function(){o?o.close():(s=!0,n())},c=function(e){Ee(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)};this.realtime_={close:a,sendRequest:c};const l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[a,c]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);s?qi("getToken() completed but was canceled"):(qi("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=c&&c.token,o=new Ir(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,(e=>{Vi(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),r))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&Vi(e),a())}}}interrupt(e){qi("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){qi("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Ye(this.interruptReasons_)&&(this.reconnectDelay_=Gr,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((e=>Xi(e))).join("$"):"default";const i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const n=new Pr(e).toString();let i;if(this.listens.has(n)){const e=this.listens.get(n);i=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(e,t){qi("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){qi("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+Ni.replace(/\./g,"-")]=1,Me()?e["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Rr.getInstance().currentlyOnline();return Ye(this.interruptReasons_)&&e}}Zr.nextPersistentConnectionId_=0,Zr.nextConnectionId_=0;class Qr{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Qr(e,t)}}class Jr{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new Qr(Yi,e),i=new Qr(Yi,t);return 0!==this.compare(n,i)}minPost(){return Qr.MIN}}let Xr;class es extends Jr{static get __EMPTY_NODE(){return Xr}static set __EMPTY_NODE(e){Xr=e}compare(e,t){return Zi(e.name,t.name)}isDefinedOn(e){throw Te("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Qr.MIN}maxPost(){return new Qr(Gi,Xr)}makePost(e,t){return Ee("string"==typeof e,"KeyIndex indexValue must always be a string."),new Qr(e,Xr)}toString(){return".key"}}const ts=new es;class ns{constructor(e,t,n,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,i&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class is{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:is.RED,this.left=null!=i?i:rs.EMPTY_NODE,this.right=null!=r?r:rs.EMPTY_NODE}copy(e,t,n,i,r){return new is(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const r=n(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return rs.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,i;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return rs.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,is.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,is.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}is.RED=!0,is.BLACK=!1;class rs{constructor(e,t=rs.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new rs(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,is.BLACK,null,null))}remove(e){return new rs(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,is.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new ns(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new ns(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new ns(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new ns(this.root_,null,this.comparator_,!0,e)}}function ss(e,t){return Zi(e.name,t.name)}function os(e,t){return Zi(e,t)}let as;rs.EMPTY_NODE=new class{copy(e,t,n,i,r){return this}insert(e,t,n){return new is(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const cs=function(e){return"number"==typeof e?"number:"+nr(e):"string:"+e},ls=function(e){if(e.isLeafNode()){const t=e.val();Ee("string"==typeof t||"number"==typeof t||"object"==typeof t&&Ve(t,".sv"),"Priority must be a string or number.")}else Ee(e===as||e.isEmpty(),"priority of unexpected type.");Ee(e===as||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let hs,ds,us;class ps{constructor(e,t=ps.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Ee(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),ls(this.priorityNode_)}static set __childrenNodeConstructor(e){hs=e}static get __childrenNodeConstructor(){return hs}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new ps(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:ps.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Br(e)?this:".priority"===Dr(e)?this.priorityNode_:ps.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:ps.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=Dr(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(Ee(".priority"!==n||1===Lr(e),".priority must be the last token in a path"),this.updateImmediateChild(n,ps.__childrenNodeConstructor.EMPTY_NODE.updateChild(jr(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+cs(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?nr(this.value_):this.value_,this.lazyHash_=Fi(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===ps.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof ps.__childrenNodeConstructor?-1:(Ee(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,i=ps.VALUE_TYPE_ORDER.indexOf(t),r=ps.VALUE_TYPE_ORDER.indexOf(n);return Ee(i>=0,"Unknown leaf type: "+t),Ee(r>=0,"Unknown leaf type: "+n),i===r?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}ps.VALUE_TYPE_ORDER=["object","boolean","number","string"];const fs=new class extends Jr{compare(e,t){const n=e.node.getPriority(),i=t.node.getPriority(),r=n.compareTo(i);return 0===r?Zi(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Qr.MIN}maxPost(){return new Qr(Gi,new ps("[PRIORITY-POST]",us))}makePost(e,t){const n=ds(e);return new Qr(t,new ps("[PRIORITY-POST]",n))}toString(){return".priority"}},ms=Math.log(2);class gs{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/ms,10)),this.current_=this.count-1;const n=(i=this.count,parseInt(Array(i+1).join("1"),2));var i;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const _s=function(e,t,n,i){e.sort(t);const r=function(t,i){const s=i-t;let o,a;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new is(a,o.node,is.BLACK,null,null);{const c=parseInt(s/2,10)+t,l=r(t,c),h=r(c+1,i);return o=e[c],a=n?n(o):o,new is(a,o.node,is.BLACK,l,h)}},s=function(t){let i=null,s=null,o=e.length;const a=function(t,i){const s=o-t,a=o;o-=t;const l=r(s+1,a),h=e[s],d=n?n(h):h;c(new is(d,h.node,i,null,l))},c=function(e){i?(i.left=e,i=e):(s=e,i=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,is.BLACK):(a(i,is.BLACK),a(i,is.RED))}return s}(new gs(e.length));return new rs(i||t,s)};let ys;const bs={};class ws{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return Ee(bs&&fs,"ChildrenNode.ts has not been loaded"),ys=ys||new ws({".priority":bs},{".priority":fs}),ys}get(e){const t=Ke(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof rs?t:null}hasIndex(e){return Ve(this.indexSet_,e.toString())}addIndex(e,t){Ee(e!==ts,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let i=!1;const r=t.getIterator(Qr.Wrap);let s,o=r.getNext();for(;o;)i=i||e.isDefinedOn(o.node),n.push(o),o=r.getNext();s=i?_s(n,e.getCompare()):bs;const a=e.toString(),c=Object.assign({},this.indexSet_);c[a]=e;const l=Object.assign({},this.indexes_);return l[a]=s,new ws(l,c)}addToIndexes(e,t){const n=Ge(this.indexes_,((n,i)=>{const r=Ke(this.indexSet_,i);if(Ee(r,"Missing index implementation for "+i),n===bs){if(r.isDefinedOn(e.node)){const n=[],i=t.getIterator(Qr.Wrap);let s=i.getNext();for(;s;)s.name!==e.name&&n.push(s),s=i.getNext();return n.push(e),_s(n,r.getCompare())}return bs}{const i=t.get(e.name);let r=n;return i&&(r=r.remove(new Qr(e.name,i))),r.insert(e,e.node)}}));return new ws(n,this.indexSet_)}removeFromIndexes(e,t){const n=Ge(this.indexes_,(n=>{if(n===bs)return n;{const i=t.get(e.name);return i?n.remove(new Qr(e.name,i)):n}}));return new ws(n,this.indexSet_)}}let vs;class ks{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&ls(this.priorityNode_),this.children_.isEmpty()&&Ee(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return vs||(vs=new ks(new rs(os),null,ws.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||vs}updatePriority(e){return this.children_.isEmpty()?this:new ks(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?vs:t}}getChild(e){const t=Dr(e);return null===t?this:this.getImmediateChild(t).getChild(jr(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(Ee(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new Qr(e,t);let i,r;t.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(n,this.children_)):(i=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(n,this.children_));const s=i.isEmpty()?vs:this.priorityNode_;return new ks(i,s,r)}}updateChild(e,t){const n=Dr(e);if(null===n)return t;{Ee(".priority"!==Dr(e)||1===Lr(e),".priority must be the last token in a path");const i=this.getImmediateChild(n).updateChild(jr(e),t);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,i=0,r=!0;if(this.forEachChild(fs,((s,o)=>{t[s]=o.val(e),n++,r&&ks.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):r=!1})),!e&&r&&i<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+cs(this.getPriority().val())+":"),this.forEachChild(fs,((t,n)=>{const i=n.hash();""!==i&&(e+=":"+t+":"+i)})),this.lazyHash_=""===e?"":Fi(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const i=this.resolveIndex_(n);if(i){const n=i.getPredecessorKey(new Qr(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Qr(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Qr(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,Qr.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)<0;)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,Qr.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Cs?-1:0}withIndex(e){if(e===ts||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new ks(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===ts||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(fs),n=t.getIterator(fs);let i=e.getNext(),r=n.getNext();for(;i&&r;){if(i.name!==r.name||!i.node.equals(r.node))return!1;i=e.getNext(),r=n.getNext()}return null===i&&null===r}return!1}return!1}}resolveIndex_(e){return e===ts?null:this.indexMap_.get(e.toString())}}ks.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const Cs=new class extends ks{constructor(){super(new rs(os),ks.EMPTY_NODE,ws.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ks.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(Qr,{MIN:{value:new Qr(Yi,ks.EMPTY_NODE)},MAX:{value:new Qr(Gi,Cs)}}),es.__EMPTY_NODE=ks.EMPTY_NODE,ps.__childrenNodeConstructor=ks,as=Cs,us=Cs;const Es=!0;function Ts(e,t=null){if(null===e)return ks.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),Ee(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new ps(e,Ts(t));if(e instanceof Array||!Es){let n=ks.EMPTY_NODE;return tr(e,((t,i)=>{if(Ve(e,t)&&"."!==t.substring(0,1)){const e=Ts(i);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}})),n.updatePriority(Ts(t))}{const n=[];let i=!1;if(tr(e,((e,t)=>{if("."!==e.substring(0,1)){const r=Ts(t);r.isEmpty()||(i=i||!r.getPriority().isEmpty(),n.push(new Qr(e,r)))}})),0===n.length)return ks.EMPTY_NODE;const r=_s(n,ss,(e=>e.name),os);if(i){const e=_s(n,fs.getCompare());return new ks(r,Ts(t),new ws({".priority":e},{".priority":fs}))}return new ks(r,Ts(t),ws.Default)}}!function(e){ds=e}(Ts);class xs extends Jr{constructor(e){super(),this.indexPath_=e,Ee(!Br(e)&&".priority"!==Dr(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),i=this.extractChild(t.node),r=n.compareTo(i);return 0===r?Zi(e.name,t.name):r}makePost(e,t){const n=Ts(e),i=ks.EMPTY_NODE.updateChild(this.indexPath_,n);return new Qr(t,i)}maxPost(){const e=ks.EMPTY_NODE.updateChild(this.indexPath_,Cs);return new Qr(Gi,e)}toString(){return Fr(this.indexPath_,0).join("/")}}const Ss=new class extends Jr{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?Zi(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Qr.MIN}maxPost(){return Qr.MAX}makePost(e,t){const n=Ts(e);return new Qr(t,n)}toString(){return".value"}};function Is(e){return{type:"value",snapshotNode:e}}function As(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Ns(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Rs(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class Ps{constructor(e){this.index_=e}updateChild(e,t,n,i,r,s){Ee(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=e.getImmediateChild(t);return o.getChild(i).equals(n.getChild(i))&&o.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(Ns(t,o)):Ee(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(As(t,n)):s.trackChildChange(Rs(t,n,o))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(fs,((e,i)=>{t.hasChild(e)||n.trackChildChange(Ns(e,i))})),t.isLeafNode()||t.forEachChild(fs,((t,i)=>{if(e.hasChild(t)){const r=e.getImmediateChild(t);r.equals(i)||n.trackChildChange(Rs(t,i,r))}else n.trackChildChange(As(t,i))}))),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?ks.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Os{constructor(e){this.indexedFilter_=new Ps(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Os.getStartPost_(e),this.endPost_=Os.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,i,r,s){return this.matches(new Qr(t,n))||(n=ks.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,r,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=ks.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(ks.EMPTY_NODE);const r=this;return t.forEachChild(fs,((e,t)=>{r.matches(new Qr(e,t))||(i=i.updateImmediateChild(e,ks.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class Ds{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new Os(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,i,r,s){return this.rangedFilter_.matches(new Qr(t,n))||(n=ks.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,r,s):this.fullLimitUpdateChild_(e,t,n,r,s)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=ks.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;i=ks.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;i=i.updateImmediateChild(t.name,t.node),n++}}}else{let e;i=t.withIndex(this.index_),i=i.updatePriority(ks.EMPTY_NODE),e=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;for(;e.hasNext();){const t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:i=i.updateImmediateChild(t.name,ks.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,i,r){let s;if(this.reverse_){const e=this.index_.getCompare();s=(t,n)=>e(n,t)}else s=this.index_.getCompare();const o=e;Ee(o.numChildren()===this.limit_,"");const a=new Qr(t,n),c=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),l=this.rangedFilter_.matches(a);if(o.hasChild(t)){const e=o.getImmediateChild(t);let h=i.getChildAfterChild(this.index_,c,this.reverse_);for(;null!=h&&(h.name===t||o.hasChild(h.name));)h=i.getChildAfterChild(this.index_,h,this.reverse_);const d=null==h?1:s(h,a);if(l&&!n.isEmpty()&&d>=0)return null!=r&&r.trackChildChange(Rs(t,n,e)),o.updateImmediateChild(t,n);{null!=r&&r.trackChildChange(Ns(t,e));const n=o.updateImmediateChild(t,ks.EMPTY_NODE);return null!=h&&this.rangedFilter_.matches(h)?(null!=r&&r.trackChildChange(As(h.name,h.node)),n.updateImmediateChild(h.name,h.node)):n}}return n.isEmpty()?e:l&&s(c,a)>=0?(null!=r&&(r.trackChildChange(Ns(c.name,c.node)),r.trackChildChange(As(t,n))),o.updateImmediateChild(t,n).updateImmediateChild(c.name,ks.EMPTY_NODE)):e}}class Ls{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=fs}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return Ee(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Ee(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Yi}hasEnd(){return this.endSet_}getIndexEndValue(){return Ee(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Ee(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Gi}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return Ee(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===fs}copy(){const e=new Ls;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function js(e){const t={};if(e.isDefault())return t;let n;if(e.index_===fs?n="$priority":e.index_===Ss?n="$value":e.index_===ts?n="$key":(Ee(e.index_ instanceof xs,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=We(n),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=We(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+We(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=We(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+We(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function Ms(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==fs&&(t.i=e.index_.toString()),t}class Fs extends Ar{constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=Hi("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(Ee(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const s=Fs.getListenId_(e,n),o={};this.listens_[s]=o;const a=js(e._queryParams);this.restRequest_(r+".json",a,((e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(r,a,!1,n),Ke(this.listens_,s)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",i(t,null)}}))}unlisten(e,t){const n=Fs.getListenId_(e,t);delete this.listens_[n]}get(e){const t=js(e._queryParams),n=e._path.toString(),i=new je;return this.restRequest_(n+".json",t,((e,t)=>{let r=t;404===e&&(r=null,e=null),null===e?(this.onDataUpdate_(n,r,!1,null),i.resolve(r)):i.reject(new Error(r))})),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+function(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}(t);this.log_("Sending REST request for "+s);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=He(o.responseText)}catch(e){Vi("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&Vi("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()}))}}class Us{constructor(){this.rootNode_=ks.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function zs(){return{value:null,children:new Map}}function Bs(e,t,n){if(Br(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const i=Dr(t);e.children.has(i)||e.children.set(i,zs()),Bs(e.children.get(i),t=jr(t),n)}}function qs(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,i)=>{qs(i,new Pr(t.toString()+"/"+e),n)}))}class Hs{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&tr(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class Ws{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Hs(e);const n=1e4+2e4*Math.random();or(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;tr(e,((e,i)=>{i>0&&Ve(this.statsToReport_,e)&&(t[e]=i,n=!0)})),n&&this.server_.reportStats(t),or(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var $s;function Vs(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}($s||($s={}));class Ks{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=$s.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(Br(this.path)){if(null!=this.affectedTree.value)return Ee(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Pr(e));return new Ks(Or(),t,this.revert)}}return Ee(Dr(this.path)===e,"operationForChild called for unrelated child."),new Ks(jr(this.path),this.affectedTree,this.revert)}}class Ys{constructor(e,t){this.source=e,this.path=t,this.type=$s.LISTEN_COMPLETE}operationForChild(e){return Br(this.path)?new Ys(this.source,Or()):new Ys(this.source,jr(this.path))}}class Gs{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=$s.OVERWRITE}operationForChild(e){return Br(this.path)?new Gs(this.source,Or(),this.snap.getImmediateChild(e)):new Gs(this.source,jr(this.path),this.snap)}}class Zs{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=$s.MERGE}operationForChild(e){if(Br(this.path)){const t=this.children.subtree(new Pr(e));return t.isEmpty()?null:t.value?new Gs(this.source,Or(),t.value):new Zs(this.source,Or(),t)}return Ee(Dr(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Zs(this.source,jr(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Qs{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Br(e))return this.isFullyInitialized()&&!this.filtered_;const t=Dr(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Js{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Xs(e,t,n,i,r,s){const o=i.filter((e=>e.type===n));o.sort(((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw Te("Should only compare child_ events.");const i=new Qr(t.childName,t.snapshotNode),r=new Qr(n.childName,n.snapshotNode);return e.index_.compare(i,r)}(e,t,n))),o.forEach((n=>{const i=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,s);r.forEach((r=>{r.respondsTo(n.type)&&t.push(r.createEvent(i,e.query_))}))}))}function eo(e,t){return{eventCache:e,serverCache:t}}function to(e,t,n,i){return eo(new Qs(t,n,i),e.serverCache)}function no(e,t,n,i){return eo(e.eventCache,new Qs(t,n,i))}function io(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function ro(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let so;class oo{constructor(e,t=(()=>(so||(so=new rs(Qi)),so))()){this.value=e,this.children=t}static fromObject(e){let t=new oo(null);return tr(e,((e,n)=>{t=t.set(new Pr(e),n)})),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Or(),value:this.value};if(Br(e))return null;{const n=Dr(e),i=this.children.get(n);if(null!==i){const r=i.findRootMostMatchingPathAndValue(jr(e),t);return null!=r?{path:zr(new Pr(n),r.path),value:r.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(Br(e))return this;{const t=Dr(e),n=this.children.get(t);return null!==n?n.subtree(jr(e)):new oo(null)}}set(e,t){if(Br(e))return new oo(t,this.children);{const n=Dr(e),i=(this.children.get(n)||new oo(null)).set(jr(e),t),r=this.children.insert(n,i);return new oo(this.value,r)}}remove(e){if(Br(e))return this.children.isEmpty()?new oo(null):new oo(null,this.children);{const t=Dr(e),n=this.children.get(t);if(n){const i=n.remove(jr(e));let r;return r=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&r.isEmpty()?new oo(null):new oo(this.value,r)}return this}}get(e){if(Br(e))return this.value;{const t=Dr(e),n=this.children.get(t);return n?n.get(jr(e)):null}}setTree(e,t){if(Br(e))return t;{const n=Dr(e),i=(this.children.get(n)||new oo(null)).setTree(jr(e),t);let r;return r=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new oo(this.value,r)}}fold(e){return this.fold_(Or(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((i,r)=>{n[i]=r.fold_(zr(e,i),t)})),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,Or(),t)}findOnPath_(e,t,n){const i=!!this.value&&n(t,this.value);if(i)return i;if(Br(e))return null;{const i=Dr(e),r=this.children.get(i);return r?r.findOnPath_(jr(e),zr(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Or(),t)}foreachOnPath_(e,t,n){if(Br(e))return this;{this.value&&n(t,this.value);const i=Dr(e),r=this.children.get(i);return r?r.foreachOnPath_(jr(e),zr(t,i),n):new oo(null)}}foreach(e){this.foreach_(Or(),e)}foreach_(e,t){this.children.inorderTraversal(((n,i)=>{i.foreach_(zr(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class ao{constructor(e){this.writeTree_=e}static empty(){return new ao(new oo(null))}}function co(e,t,n){if(Br(t))return new ao(new oo(n));{const i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){const r=i.path;let s=i.value;const o=qr(r,t);return s=s.updateChild(o,n),new ao(e.writeTree_.set(r,s))}{const i=new oo(n),r=e.writeTree_.setTree(t,i);return new ao(r)}}}function lo(e,t,n){let i=e;return tr(n,((e,n)=>{i=co(i,zr(t,e),n)})),i}function ho(e,t){if(Br(t))return ao.empty();{const n=e.writeTree_.setTree(t,new oo(null));return new ao(n)}}function uo(e,t){return null!=po(e,t)}function po(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(qr(n.path,t)):null}function fo(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(fs,((e,n)=>{t.push(new Qr(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new Qr(e,n.value))})),t}function mo(e,t){if(Br(t))return e;{const n=po(e,t);return new ao(null!=n?new oo(n):e.writeTree_.subtree(t))}}function go(e){return e.writeTree_.isEmpty()}function _o(e,t){return yo(Or(),e.writeTree_,t)}function yo(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let i=null;return t.children.inorderTraversal(((t,r)=>{".priority"===t?(Ee(null!==r.value,"Priority writes must always be leaf nodes"),i=r.value):n=yo(zr(e,t),r,n)})),n.getChild(e).isEmpty()||null===i||(n=n.updateChild(zr(e,".priority"),i)),n}}function bo(e,t){return No(t,e)}function wo(e,t){if(e.snap)return Wr(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&Wr(zr(e.path,n),t))return!0;return!1}function vo(e){return e.visible}function ko(e,t,n){let i=ao.empty();for(let r=0;r<e.length;++r){const s=e[r];if(t(s)){const e=s.path;let t;if(s.snap)Wr(n,e)?(t=qr(n,e),i=co(i,t,s.snap)):Wr(e,n)&&(t=qr(e,n),i=co(i,Or(),s.snap.getChild(t)));else{if(!s.children)throw Te("WriteRecord should have .snap or .children");if(Wr(n,e))t=qr(n,e),i=lo(i,t,s.children);else if(Wr(e,n))if(t=qr(e,n),Br(t))i=lo(i,Or(),s.children);else{const e=Ke(s.children,Dr(t));if(e){const n=e.getChild(jr(t));i=co(i,Or(),n)}}}}}return i}function Co(e,t,n,i,r){if(i||r){const s=mo(e.visibleWrites,t);if(!r&&go(s))return n;if(r||null!=n||uo(s,Or())){const s=function(e){return(e.visible||r)&&(!i||!~i.indexOf(e.writeId))&&(Wr(e.path,t)||Wr(t,e.path))};return _o(ko(e.allWrites,s,t),n||ks.EMPTY_NODE)}return null}{const i=po(e.visibleWrites,t);if(null!=i)return i;{const i=mo(e.visibleWrites,t);return go(i)?n:null!=n||uo(i,Or())?_o(i,n||ks.EMPTY_NODE):null}}}function Eo(e,t,n,i){return Co(e.writeTree,e.treePath,t,n,i)}function To(e,t){return function(e,t,n){let i=ks.EMPTY_NODE;const r=po(e.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(fs,((e,t)=>{i=i.updateImmediateChild(e,t)})),i;if(n){const r=mo(e.visibleWrites,t);return n.forEachChild(fs,((e,t)=>{const n=_o(mo(r,new Pr(e)),t);i=i.updateImmediateChild(e,n)})),fo(r).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}return fo(mo(e.visibleWrites,t)).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}(e.writeTree,e.treePath,t)}function xo(e,t,n,i){return function(e,t,n,i,r){Ee(i||r,"Either existingEventSnap or existingServerSnap must exist");const s=zr(t,n);if(uo(e.visibleWrites,s))return null;{const t=mo(e.visibleWrites,s);return go(t)?r.getChild(n):_o(t,r.getChild(n))}}(e.writeTree,e.treePath,t,n,i)}function So(e,t){return function(e,t){return po(e.visibleWrites,t)}(e.writeTree,zr(e.treePath,t))}function Io(e,t,n){return function(e,t,n,i){const r=zr(t,n),s=po(e.visibleWrites,r);return null!=s?s:i.isCompleteForChild(n)?_o(mo(e.visibleWrites,r),i.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function Ao(e,t){return No(zr(e.treePath,t),e.writeTree)}function No(e,t){return{treePath:e,writeTree:t}}class Ro{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;Ee("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),Ee(".priority"!==n,"Only non-priority child changes can be tracked.");const i=this.changeMap.get(n);if(i){const r=i.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(n,Rs(n,e.snapshotNode,i.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(n,Ns(n,i.oldSnap));else if("child_changed"===t&&"child_added"===r)this.changeMap.set(n,As(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==r)throw Te("Illegal combination of changes: "+e+" occurred after "+i);this.changeMap.set(n,Rs(n,e.snapshotNode,i.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const Po=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class Oo{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Qs(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Io(this.writes_,e,t)}}getChildAfterChild(e,t,n){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:ro(this.viewCache_),r=function(e,t,n,i,r,s){return function(e,t,n,i,r,s,o){let a;const c=mo(e.visibleWrites,t),l=po(c,Or());if(null!=l)a=l;else{if(null==n)return[];a=_o(c,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let c=n.getNext();for(;c&&e.length<r;)0!==t(c,i)&&e.push(c),c=n.getNext();return e}}(e.writeTree,e.treePath,t,n,i,r,s)}(this.writes_,i,t,1,n,e);return 0===r.length?null:r[0]}}function Do(e,t,n,i,r,s){const o=t.eventCache;if(null!=So(i,n))return t;{let a,c;if(Br(n))if(Ee(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=ro(t),r=To(i,n instanceof ks?n:ks.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),r,s)}else{const n=Eo(i,ro(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{const l=Dr(n);if(".priority"===l){Ee(1===Lr(n),"Can't have a priority with additional path components");const r=o.getNode();c=t.serverCache.getNode();const s=xo(i,n,r,c);a=null!=s?e.filter.updatePriority(r,s):o.getNode()}else{const h=jr(n);let d;if(o.isCompleteForChild(l)){c=t.serverCache.getNode();const e=xo(i,n,o.getNode(),c);d=null!=e?o.getNode().getImmediateChild(l).updateChild(h,e):o.getNode().getImmediateChild(l)}else d=Io(i,l,t.serverCache);a=null!=d?e.filter.updateChild(o.getNode(),l,d,h,r,s):o.getNode()}}return to(t,a,o.isFullyInitialized()||Br(n),e.filter.filtersNodes())}}function Lo(e,t,n,i,r,s,o,a){const c=t.serverCache;let l;const h=o?e.filter:e.filter.getIndexedFilter();if(Br(n))l=h.updateFullNode(c.getNode(),i,null);else if(h.filtersNodes()&&!c.isFiltered()){const e=c.getNode().updateChild(n,i);l=h.updateFullNode(c.getNode(),e,null)}else{const e=Dr(n);if(!c.isCompleteForPath(n)&&Lr(n)>1)return t;const r=jr(n),s=c.getNode().getImmediateChild(e).updateChild(r,i);l=".priority"===e?h.updatePriority(c.getNode(),s):h.updateChild(c.getNode(),e,s,r,Po,null)}const d=no(t,l,c.isFullyInitialized()||Br(n),h.filtersNodes());return Do(e,d,n,r,new Oo(r,d,s),a)}function jo(e,t,n,i,r,s,o){const a=t.eventCache;let c,l;const h=new Oo(r,t,s);if(Br(n))l=e.filter.updateFullNode(t.eventCache.getNode(),i,o),c=to(t,l,!0,e.filter.filtersNodes());else{const r=Dr(n);if(".priority"===r)l=e.filter.updatePriority(t.eventCache.getNode(),i),c=to(t,l,a.isFullyInitialized(),a.isFiltered());else{const s=jr(n),l=a.getNode().getImmediateChild(r);let d;if(Br(s))d=i;else{const e=h.getCompleteChild(r);d=null!=e?".priority"===Mr(s)&&e.getChild(Ur(s)).isEmpty()?e:e.updateChild(s,i):ks.EMPTY_NODE}c=l.equals(d)?t:to(t,e.filter.updateChild(a.getNode(),r,d,s,h,o),a.isFullyInitialized(),e.filter.filtersNodes())}}return c}function Mo(e,t){return e.eventCache.isCompleteForChild(t)}function Fo(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function Uo(e,t,n,i,r,s,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c,l=t;c=Br(n)?i:new oo(null).setTree(n,i);const h=t.serverCache.getNode();return c.children.inorderTraversal(((n,i)=>{if(h.hasChild(n)){const c=Fo(0,t.serverCache.getNode().getImmediateChild(n),i);l=Lo(e,l,new Pr(n),c,r,s,o,a)}})),c.children.inorderTraversal(((n,i)=>{const c=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!h.hasChild(n)&&!c){const c=Fo(0,t.serverCache.getNode().getImmediateChild(n),i);l=Lo(e,l,new Pr(n),c,r,s,o,a)}})),l}class zo{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new Ps(n.getIndex()),r=(s=n).loadsAllData()?new Ps(s.getIndex()):s.hasLimit()?new Ds(s):new Os(s);var s;this.processor_=function(e){return{filter:e}}(r);const o=t.serverCache,a=t.eventCache,c=i.updateFullNode(ks.EMPTY_NODE,o.getNode(),null),l=r.updateFullNode(ks.EMPTY_NODE,a.getNode(),null),h=new Qs(c,o.isFullyInitialized(),i.filtersNodes()),d=new Qs(l,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=eo(d,h),this.eventGenerator_=new Js(this.query_)}get query(){return this.query_}}function Bo(e,t){const n=ro(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!Br(t)&&!n.getImmediateChild(Dr(t)).isEmpty())?n.getChild(t):null}function qo(e){return 0===e.eventRegistrations_.length}function Ho(e,t,n){const i=[];if(n){Ee(null==t,"A cancel should cancel all event registrations.");const r=e.query._path;e.eventRegistrations_.forEach((e=>{const t=e.createCancelEvent(n,r);t&&i.push(t)}))}if(t){let n=[];for(let i=0;i<e.eventRegistrations_.length;++i){const r=e.eventRegistrations_[i];if(r.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(i+1));break}}else n.push(r)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return i}function Wo(e,t,n,i){t.type===$s.MERGE&&null!==t.source.queryId&&(Ee(ro(e.viewCache_),"We should always have a full cache before handling merges"),Ee(io(e.viewCache_),"Missing event cache, even though we have a server cache"));const r=e.viewCache_,s=function(e,t,n,i,r){const s=new Ro;let o,a;if(n.type===$s.OVERWRITE){const c=n;c.source.fromUser?o=jo(e,t,c.path,c.snap,i,r,s):(Ee(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered()&&!Br(c.path),o=Lo(e,t,c.path,c.snap,i,r,a,s))}else if(n.type===$s.MERGE){const c=n;c.source.fromUser?o=function(e,t,n,i,r,s,o){let a=t;return i.foreach(((i,c)=>{const l=zr(n,i);Mo(t,Dr(l))&&(a=jo(e,a,l,c,r,s,o))})),i.foreach(((i,c)=>{const l=zr(n,i);Mo(t,Dr(l))||(a=jo(e,a,l,c,r,s,o))})),a}(e,t,c.path,c.children,i,r,s):(Ee(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered(),o=Uo(e,t,c.path,c.children,i,r,a,s))}else if(n.type===$s.ACK_USER_WRITE){const a=n;o=a.revert?function(e,t,n,i,r,s){let o;if(null!=So(i,n))return t;{const a=new Oo(i,t,r),c=t.eventCache.getNode();let l;if(Br(n)||".priority"===Dr(n)){let n;if(t.serverCache.isFullyInitialized())n=Eo(i,ro(t));else{const e=t.serverCache.getNode();Ee(e instanceof ks,"serverChildren would be complete if leaf node"),n=To(i,e)}l=e.filter.updateFullNode(c,n,s)}else{const r=Dr(n);let h=Io(i,r,t.serverCache);null==h&&t.serverCache.isCompleteForChild(r)&&(h=c.getImmediateChild(r)),l=null!=h?e.filter.updateChild(c,r,h,jr(n),a,s):t.eventCache.getNode().hasChild(r)?e.filter.updateChild(c,r,ks.EMPTY_NODE,jr(n),a,s):c,l.isEmpty()&&t.serverCache.isFullyInitialized()&&(o=Eo(i,ro(t)),o.isLeafNode()&&(l=e.filter.updateFullNode(l,o,s)))}return o=t.serverCache.isFullyInitialized()||null!=So(i,Or()),to(t,l,o,e.filter.filtersNodes())}}(e,t,a.path,i,r,s):function(e,t,n,i,r,s,o){if(null!=So(r,n))return t;const a=t.serverCache.isFiltered(),c=t.serverCache;if(null!=i.value){if(Br(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return Lo(e,t,n,c.getNode().getChild(n),r,s,a,o);if(Br(n)){let i=new oo(null);return c.getNode().forEachChild(ts,((e,t)=>{i=i.set(new Pr(e),t)})),Uo(e,t,n,i,r,s,a,o)}return t}{let l=new oo(null);return i.foreach(((e,t)=>{const i=zr(n,e);c.isCompleteForPath(i)&&(l=l.set(e,c.getNode().getChild(i)))})),Uo(e,t,n,l,r,s,a,o)}}(e,t,a.path,a.affectedTree,i,r,s)}else{if(n.type!==$s.LISTEN_COMPLETE)throw Te("Unknown operation type: "+n.type);o=function(e,t,n,i,r){const s=t.serverCache;return Do(e,no(t,s.getNode(),s.isFullyInitialized()||Br(n),s.isFiltered()),n,i,Po,r)}(e,t,n.path,i,s)}const c=s.getChanges();return function(e,t,n){const i=t.eventCache;if(i.isFullyInitialized()){const r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=io(e);(n.length>0||!e.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&n.push(Is(io(t)))}}(t,o,c),{viewCache:o,changes:c}}(e.processor_,r,t,n,i);var o,a;return o=e.processor_,a=s.viewCache,Ee(a.eventCache.getNode().isIndexed(o.filter.getIndex()),"Event snap not indexed"),Ee(a.serverCache.getNode().isIndexed(o.filter.getIndex()),"Server snap not indexed"),Ee(s.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,$o(e,s.changes,s.viewCache.eventCache.getNode(),null)}function $o(e,t,n,i){const r=i?[i]:e.eventRegistrations_;return function(e,t,n,i){const r=[],s=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),Xs(e,r,"child_removed",t,i,n),Xs(e,r,"child_added",t,i,n),Xs(e,r,"child_moved",s,i,n),Xs(e,r,"child_changed",t,i,n),Xs(e,r,"value",t,i,n),r}(e.eventGenerator_,t,n,r)}let Vo,Ko;class Yo{constructor(){this.views=new Map}}function Go(e,t,n,i){const r=t.source.queryId;if(null!==r){const s=e.views.get(r);return Ee(null!=s,"SyncTree gave us an op for an invalid query."),Wo(s,t,n,i)}{let r=[];for(const s of e.views.values())r=r.concat(Wo(s,t,n,i));return r}}function Zo(e,t,n,i,r){const s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=Eo(n,r?i:null),s=!1;e?s=!0:i instanceof ks?(e=To(n,i),s=!1):(e=ks.EMPTY_NODE,s=!1);const o=eo(new Qs(e,s,!1),new Qs(i,r,!1));return new zo(t,o)}return o}function Qo(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function Jo(e,t){let n=null;for(const i of e.views.values())n=n||Bo(i,t);return n}function Xo(e,t){if(t._queryParams.loadsAllData())return na(e);{const n=t._queryIdentifier;return e.views.get(n)}}function ea(e,t){return null!=Xo(e,t)}function ta(e){return null!=na(e)}function na(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let ia=1;class ra{constructor(e){this.listenProvider_=e,this.syncPointTree_=new oo(null),this.pendingWriteTree_={visibleWrites:ao.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function sa(e,t,n,i,r){return function(e,t,n,i,r){Ee(i>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),e.allWrites.push({path:t,snap:n,writeId:i,visible:r}),r&&(e.visibleWrites=co(e.visibleWrites,t,n)),e.lastWriteId=i}(e.pendingWriteTree_,t,n,i,r),r?ua(e,new Gs({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function oa(e,t,n=!1){const i=function(e,t){for(let n=0;n<e.allWrites.length;n++){const i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(function(e,t){const n=e.allWrites.findIndex((e=>e.writeId===t));Ee(n>=0,"removeWrite called with nonexistent writeId.");const i=e.allWrites[n];e.allWrites.splice(n,1);let r=i.visible,s=!1,o=e.allWrites.length-1;for(;r&&o>=0;){const t=e.allWrites[o];t.visible&&(o>=n&&wo(t,i.path)?r=!1:Wr(i.path,t.path)&&(s=!0)),o--}return!!r&&(s?(function(e){e.visibleWrites=ko(e.allWrites,vo,Or()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0):(i.snap?e.visibleWrites=ho(e.visibleWrites,i.path):tr(i.children,(t=>{e.visibleWrites=ho(e.visibleWrites,zr(i.path,t))})),!0))}(e.pendingWriteTree_,t)){let t=new oo(null);return null!=i.snap?t=t.set(Or(),!0):tr(i.children,(e=>{t=t.set(new Pr(e),!0)})),ua(e,new Ks(i.path,t,n))}return[]}function aa(e,t,n){return ua(e,new Gs({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function ca(e,t,n,i,r=!1){const s=t._path,o=e.syncPointTree_.get(s);let a=[];if(o&&("default"===t._queryIdentifier||ea(o,t))){const c=function(e,t,n,i){const r=t._queryIdentifier,s=[];let o=[];const a=ta(e);if("default"===r)for(const[t,r]of e.views.entries())o=o.concat(Ho(r,n,i)),qo(r)&&(e.views.delete(t),r.query._queryParams.loadsAllData()||s.push(r.query));else{const t=e.views.get(r);t&&(o=o.concat(Ho(t,n,i)),qo(t)&&(e.views.delete(r),t.query._queryParams.loadsAllData()||s.push(t.query)))}return a&&!ta(e)&&s.push(new(Ee(Vo,"Reference.ts has not been loaded"),Vo)(t._repo,t._path)),{removed:s,events:o}}(o,t,n,i);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));const l=c.removed;if(a=c.events,!r){const n=-1!==l.findIndex((e=>e._queryParams.loadsAllData())),r=e.syncPointTree_.findOnPath(s,((e,t)=>ta(t)));if(n&&!r){const t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){const n=function(e){return e.fold(((e,t,n)=>{if(t&&ta(t))return[na(t)];{let e=[];return t&&(e=Qo(t)),tr(n,((t,n)=>{e=e.concat(n)})),e}}))}(t);for(let t=0;t<n.length;++t){const i=n[t],r=i.query,s=ma(e,i);e.listenProvider_.startListening(va(r),ga(e,r),s.hashFn,s.onComplete)}}}if(!r&&l.length>0&&!i)if(n){const n=null;e.listenProvider_.stopListening(va(t),n)}else l.forEach((t=>{const n=e.queryToTagMap.get(_a(t));e.listenProvider_.stopListening(va(t),n)}))}!function(e,t){for(let n=0;n<t.length;++n){const i=t[n];if(!i._queryParams.loadsAllData()){const t=_a(i),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,l)}return a}function la(e,t,n,i){const r=ya(e,i);if(null!=r){const i=ba(r),s=i.path,o=i.queryId,a=qr(s,t);return wa(e,s,new Gs(Vs(o),a,n))}return[]}function ha(e,t,n,i=!1){const r=t._path;let s=null,o=!1;e.syncPointTree_.foreachOnPath(r,((e,t)=>{const n=qr(e,r);s=s||Jo(t,n),o=o||ta(t)}));let a,c=e.syncPointTree_.get(r);c?(o=o||ta(c),s=s||Jo(c,Or())):(c=new Yo,e.syncPointTree_=e.syncPointTree_.set(r,c)),null!=s?a=!0:(a=!1,s=ks.EMPTY_NODE,e.syncPointTree_.subtree(r).foreachChild(((e,t)=>{const n=Jo(t,Or());n&&(s=s.updateImmediateChild(e,n))})));const l=ea(c,t);if(!l&&!t._queryParams.loadsAllData()){const n=_a(t);Ee(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");const i=ia++;e.queryToTagMap.set(n,i),e.tagToQueryMap.set(i,n)}let h=function(e,t,n,i,r,s){const o=Zo(e,t,i,r,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,n),function(e,t){const n=e.viewCache_.eventCache,i=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(fs,((e,t)=>{i.push(As(e,t))})),n.isFullyInitialized()&&i.push(Is(n.getNode())),$o(e,i,n.getNode(),t)}(o,n)}(c,t,n,bo(e.pendingWriteTree_,r),s,a);if(!l&&!o&&!i){const n=Xo(c,t);h=h.concat(function(e,t,n){const i=t._path,r=ga(e,t),s=ma(e,n),o=e.listenProvider_.startListening(va(t),r,s.hashFn,s.onComplete),a=e.syncPointTree_.subtree(i);if(r)Ee(!ta(a.value),"If we're adding a query, it shouldn't be shadowed");else{const t=a.fold(((e,t,n)=>{if(!Br(e)&&t&&ta(t))return[na(t).query];{let e=[];return t&&(e=e.concat(Qo(t).map((e=>e.query)))),tr(n,((t,n)=>{e=e.concat(n)})),e}}));for(let n=0;n<t.length;++n){const i=t[n];e.listenProvider_.stopListening(va(i),ga(e,i))}}return o}(e,t,n))}return h}function da(e,t,n){const i=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(t,((e,n)=>{const i=Jo(n,qr(e,t));if(i)return i}));return Co(i,t,r,n,!0)}function ua(e,t){return pa(t,e.syncPointTree_,null,bo(e.pendingWriteTree_,Or()))}function pa(e,t,n,i){if(Br(e.path))return fa(e,t,n,i);{const r=t.get(Or());null==n&&null!=r&&(n=Jo(r,Or()));let s=[];const o=Dr(e.path),a=e.operationForChild(o),c=t.children.get(o);if(c&&a){const e=n?n.getImmediateChild(o):null,t=Ao(i,o);s=s.concat(pa(a,c,e,t))}return r&&(s=s.concat(Go(r,e,i,n))),s}}function fa(e,t,n,i){const r=t.get(Or());null==n&&null!=r&&(n=Jo(r,Or()));let s=[];return t.children.inorderTraversal(((t,r)=>{const o=n?n.getImmediateChild(t):null,a=Ao(i,t),c=e.operationForChild(t);c&&(s=s.concat(fa(c,r,o,a)))})),r&&(s=s.concat(Go(r,e,i,n))),s}function ma(e,t){const n=t.query,i=ga(e,n);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||ks.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return i?function(e,t,n){const i=ya(e,n);if(i){const n=ba(i),r=n.path,s=n.queryId,o=qr(r,t);return wa(e,r,new Ys(Vs(s),o))}return[]}(e,n._path,i):function(e,t){return ua(e,new Ys({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);{const i=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const i=new Error(e+" at "+t._path.toString()+": "+n);return i.code=e.toUpperCase(),i}(t,n);return ca(e,n,null,i)}}}}function ga(e,t){const n=_a(t);return e.queryToTagMap.get(n)}function _a(e){return e._path.toString()+"$"+e._queryIdentifier}function ya(e,t){return e.tagToQueryMap.get(t)}function ba(e){const t=e.indexOf("$");return Ee(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Pr(e.substr(0,t))}}function wa(e,t,n){const i=e.syncPointTree_.get(t);return Ee(i,"Missing sync point for query tag that we're tracking"),Go(i,n,bo(e.pendingWriteTree_,t),null)}function va(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(Ee(Ko,"Reference.ts has not been loaded"),Ko)(e._repo,e._path):e}class ka{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new ka(t)}node(){return this.node_}}class Ca{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=zr(this.path_,e);return new Ca(this.syncTree_,t)}node(){return da(this.syncTree_,this.path_)}}const Ea=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},Ta=function(e,t,n){return e&&"object"==typeof e?(Ee(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?xa(e[".sv"],t,n):"object"==typeof e[".sv"]?Sa(e[".sv"],t):void Ee(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},xa=function(e,t,n){if("timestamp"===e)return n.timestamp;Ee(!1,"Unexpected server value: "+e)},Sa=function(e,t,n){e.hasOwnProperty("increment")||Ee(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const i=e.increment;"number"!=typeof i&&Ee(!1,"Unexpected increment value: "+i);const r=t.node();if(Ee(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;const s=r.getValue();return"number"!=typeof s?i:s+i},Ia=function(e,t,n,i){return Na(t,new Ca(n,e),i)},Aa=function(e,t,n){return Na(e,new ka(t),n)};function Na(e,t,n){const i=e.getPriority().val(),r=Ta(i,t.getImmediateChild(".priority"),n);let s;if(e.isLeafNode()){const i=e,s=Ta(i.getValue(),t,n);return s!==i.getValue()||r!==i.getPriority().val()?new ps(s,Ts(r)):e}{const i=e;return s=i,r!==i.getPriority().val()&&(s=s.updatePriority(new ps(r))),i.forEachChild(fs,((e,i)=>{const r=Na(i,t.getImmediateChild(e),n);r!==i&&(s=s.updateImmediateChild(e,r))})),s}}class Ra{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function Pa(e,t){let n=t instanceof Pr?t:new Pr(t),i=e,r=Dr(n);for(;null!==r;){const e=Ke(i.node.children,r)||{children:{},childCount:0};i=new Ra(r,i,e),n=jr(n),r=Dr(n)}return i}function Oa(e){return e.node.value}function Da(e,t){e.node.value=t,Ua(e)}function La(e){return e.node.childCount>0}function ja(e,t){tr(e.node.children,((n,i)=>{t(new Ra(n,e,i))}))}function Ma(e,t,n,i){n&&!i&&t(e),ja(e,(e=>{Ma(e,t,!0,i)})),n&&i&&t(e)}function Fa(e){return new Pr(null===e.parent?e.name:Fa(e.parent)+"/"+e.name)}function Ua(e){null!==e.parent&&function(e,t,n){const i=function(e){return void 0===Oa(e)&&!La(e)}(n),r=Ve(e.node.children,t);i&&r?(delete e.node.children[t],e.node.childCount--,Ua(e)):i||r||(e.node.children[t]=n.node,e.node.childCount++,Ua(e))}(e.parent,e.name,e)}const za=/[\[\].#$\/\u0000-\u001F\u007F]/,Ba=/[\[\].#$\u0000-\u001F\u007F]/,qa=10485760,Ha=function(e){return"string"==typeof e&&0!==e.length&&!za.test(e)},Wa=function(e){return"string"==typeof e&&0!==e.length&&!Ba.test(e)},$a=function(e,t,n){const i=n instanceof Pr?new $r(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+Kr(i));if("function"==typeof t)throw new Error(e+"contains a function "+Kr(i)+" with contents = "+t.toString());if(Ki(t))throw new Error(e+"contains "+t.toString()+" "+Kr(i));if("string"==typeof t&&t.length>qa/3&&et(t)>qa)throw new Error(e+"contains a string greater than "+qa+" utf8 bytes "+Kr(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,r=!1;if(tr(t,((t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!Ha(t)))throw new Error(e+" contains an invalid key ("+t+") "+Kr(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=et(t),Vr(e)}(i,t),$a(e,s,i),function(e){const t=e.parts_.pop();e.byteLength_-=et(t),e.parts_.length>0&&(e.byteLength_-=1)}(i)})),n&&r)throw new Error(e+' contains ".value" child '+Kr(i)+" in addition to actual children.")}},Va=function(e,t,n,i){if(!(i&&void 0===n||Wa(n)))throw new Error(Xe(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Ka=function(e,t,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Va(e,t,n,i)};class Ya{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Ga(e,t){let n=null;for(let i=0;i<t.length;i++){const r=t[i],s=r.getPath();null===n||Hr(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(r)}n&&e.eventLists_.push(n)}function Za(e,t,n){Ga(e,n),function(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){const r=e.eventLists_[i];r&&(t(r.path)?(Qa(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}(e,(e=>Wr(e,t)||Wr(t,e)))}function Qa(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const i=n.getEventRunner();zi&&qi("event: "+n.toString()),sr(i)}}}const Ja="repo_interrupt",Xa=25;class ec{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Ya,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=zs(),this.transactionQueueTree_=new Ra,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function tc(e,t,n){if(e.stats_=wr(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new Fs(e.repoInfo_,((t,n,i,r)=>{rc(e,t,n,i,r)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>sc(e,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{We(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new Zr(e.repoInfo_,t,((t,n,i,r)=>{rc(e,t,n,i,r)}),(t=>{sc(e,t)}),(t=>{!function(e,t){tr(t,((t,n)=>{oc(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(t,n){const i=t.toString();return br[i]||(br[i]=new Ws(e.stats_,e.server_)),br[i]}(e.repoInfo_),e.infoData_=new Us,e.infoSyncTree_=new ra({startListening:(t,n,i,r)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=aa(e.infoSyncTree_,t._path,o),setTimeout((()=>{r("ok")}),0)),s},stopListening:()=>{}}),oc(e,"connected",!1),e.serverSyncTree_=new ra({startListening:(t,n,i,r)=>(e.server_.listen(t,i,n,((n,i)=>{const s=r(n,i);Za(e.eventQueue_,t._path,s)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function nc(e){const t=e.infoData_.getNode(new Pr(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function ic(e){return Ea({timestamp:nc(e)})}function rc(e,t,n,i,r){e.dataUpdateCount++;const s=new Pr(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(r)if(i){const t=Ge(n,(e=>Ts(e)));o=function(e,t,n,i){const r=ya(e,i);if(r){const i=ba(r),s=i.path,o=i.queryId,a=qr(s,t),c=oo.fromObject(n);return wa(e,s,new Zs(Vs(o),a,c))}return[]}(e.serverSyncTree_,s,t,r)}else{const t=Ts(n);o=la(e.serverSyncTree_,s,t,r)}else if(i){const t=Ge(n,(e=>Ts(e)));o=function(e,t,n){const i=oo.fromObject(n);return ua(e,new Zs({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,i))}(e.serverSyncTree_,s,t)}else{const t=Ts(n);o=aa(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=pc(e,s)),Za(e.eventQueue_,a,o)}function sc(e,t){oc(e,"connected",t),!1===t&&function(e){hc(e,"onDisconnectEvents");const t=ic(e),n=zs();qs(e.onDisconnect_,Or(),((i,r)=>{const s=Ia(i,r,e.serverSyncTree_,t);Bs(n,i,s)}));let i=[];qs(n,Or(),((t,n)=>{i=i.concat(aa(e.serverSyncTree_,t,n));const r=yc(e,t);pc(e,r)})),e.onDisconnect_=zs(),Za(e.eventQueue_,Or(),i)}(e)}function oc(e,t,n){const i=new Pr("/.info/"+t),r=Ts(n);e.infoData_.updateSnapshot(i,r);const s=aa(e.infoSyncTree_,i,r);Za(e.eventQueue_,i,s)}function ac(e){return e.nextWriteId_++}function cc(e,t,n,i,r){hc(e,"set",{path:t.toString(),value:n,priority:i});const s=ic(e),o=Ts(n,i),a=da(e.serverSyncTree_,t),c=Aa(o,a,s),l=ac(e),h=sa(e.serverSyncTree_,t,c,l,!0);Ga(e.eventQueue_,h),e.server_.put(t.toString(),o.val(!0),((n,i)=>{const s="ok"===n;s||Vi("set at "+t+" failed: "+n);const o=oa(e.serverSyncTree_,l,!s);Za(e.eventQueue_,t,o),function(e,t,n,i){t&&sr((()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let r=e;i&&(r+=": "+i);const s=new Error(r);s.code=e,t(s)}}))}(0,r,n,i)}));const d=yc(e,t);pc(e,d),Za(e.eventQueue_,d,[])}function lc(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Ja)}function hc(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),qi(n,...t)}function dc(e,t,n){return da(e.serverSyncTree_,t,n)||ks.EMPTY_NODE}function uc(e,t=e.transactionQueueTree_){if(t||_c(e,t),Oa(t)){const n=mc(e,t);Ee(n.length>0,"Sending zero length transaction queue"),n.every((e=>0===e.status))&&function(e,t,n){const i=n.map((e=>e.currentWriteId)),r=dc(e,t,i);let s=r;const o=r.hash();for(let e=0;e<n.length;e++){const i=n[e];Ee(0===i.status,"tryToSendTransactionQueue_: items in queue should all be run."),i.status=1,i.retryCount++;const r=qr(t,i.path);s=s.updateChild(r,i.currentOutputSnapshotRaw)}const a=s.val(!0),c=t;e.server_.put(c.toString(),a,(i=>{hc(e,"transaction put response",{path:c.toString(),status:i});let r=[];if("ok"===i){const i=[];for(let t=0;t<n.length;t++)n[t].status=2,r=r.concat(oa(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&i.push((()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved))),n[t].unwatcher();_c(e,Pa(e.transactionQueueTree_,t)),uc(e,e.transactionQueueTree_),Za(e.eventQueue_,t,r);for(let e=0;e<i.length;e++)sr(i[e])}else{if("datastale"===i)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{Vi("transaction at "+c.toString()+" failed: "+i);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=i}pc(e,t)}}),o)}(e,Fa(t),n)}else La(t)&&ja(t,(t=>{uc(e,t)}))}function pc(e,t){const n=fc(e,t),i=Fa(n);return function(e,t,n){if(0===t.length)return;const i=[];let r=[];const s=t.filter((e=>0===e.status)).map((e=>e.currentWriteId));for(let a=0;a<t.length;a++){const c=t[a],l=qr(n,c.path);let h,d=!1;if(Ee(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===c.status)d=!0,h=c.abortReason,r=r.concat(oa(e.serverSyncTree_,c.currentWriteId,!0));else if(0===c.status)if(c.retryCount>=Xa)d=!0,h="maxretry",r=r.concat(oa(e.serverSyncTree_,c.currentWriteId,!0));else{const n=dc(e,c.path,s);c.currentInputSnapshot=n;const i=t[a].update(n.val());if(void 0!==i){$a("transaction failed: Data returned ",i,c.path);let t=Ts(i);"object"==typeof i&&null!=i&&Ve(i,".priority")||(t=t.updatePriority(n.getPriority()));const o=c.currentWriteId,a=ic(e),l=Aa(t,n,a);c.currentOutputSnapshotRaw=t,c.currentOutputSnapshotResolved=l,c.currentWriteId=ac(e),s.splice(s.indexOf(o),1),r=r.concat(sa(e.serverSyncTree_,c.path,l,c.currentWriteId,c.applyLocally)),r=r.concat(oa(e.serverSyncTree_,o,!0))}else d=!0,h="nodata",r=r.concat(oa(e.serverSyncTree_,c.currentWriteId,!0))}Za(e.eventQueue_,n,r),r=[],d&&(t[a].status=2,o=t[a].unwatcher,setTimeout(o,Math.floor(0)),t[a].onComplete&&("nodata"===h?i.push((()=>t[a].onComplete(null,!1,t[a].currentInputSnapshot))):i.push((()=>t[a].onComplete(new Error(h),!1,null)))))}var o;_c(e,e.transactionQueueTree_);for(let e=0;e<i.length;e++)sr(i[e]);uc(e,e.transactionQueueTree_)}(e,mc(e,n),i),i}function fc(e,t){let n,i=e.transactionQueueTree_;for(n=Dr(t);null!==n&&void 0===Oa(i);)i=Pa(i,n),n=Dr(t=jr(t));return i}function mc(e,t){const n=[];return gc(e,t,n),n.sort(((e,t)=>e.order-t.order)),n}function gc(e,t,n){const i=Oa(t);if(i)for(let e=0;e<i.length;e++)n.push(i[e]);ja(t,(t=>{gc(e,t,n)}))}function _c(e,t){const n=Oa(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,Da(t,n.length>0?n:void 0)}ja(t,(t=>{_c(e,t)}))}function yc(e,t){const n=Fa(fc(e,t)),i=Pa(e.transactionQueueTree_,t);return function(e,t,n){let i=e.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(i,(t=>{bc(e,t)})),bc(e,i),Ma(i,(t=>{bc(e,t)})),n}function bc(e,t){const n=Oa(t);if(n){const i=[];let r=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(Ee(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(Ee(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),r=r.concat(oa(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&i.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===s?Da(t,void 0):n.length=s+1,Za(e.eventQueue_,Fa(t),r);for(let e=0;e<i.length;e++)sr(i[e])}}const wc=function(e,t){const n=vc(e),i=n.namespace;"firebase.com"===n.domain&&$i(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||$i("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Vi("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const r="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new mr(n.host,n.secure,i,r,t,"",i!==n.subdomain),path:new Pr(n.pathString)}},vc=function(e){let t="",n="",i="",r="",s="",o=!0,a="https",c=443;if("string"==typeof e){let l=e.indexOf("//");l>=0&&(a=e.substring(0,l-1),e=e.substring(l+2));let h=e.indexOf("/");-1===h&&(h=e.length);let d=e.indexOf("?");-1===d&&(d=e.length),t=e.substring(0,Math.min(h,d)),h<d&&(r=function(e){let t="";const n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let i=n[e];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(h,d)));const u=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Vi(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,d)));l=t.indexOf(":"),l>=0?(o="https"===a||"wss"===a,c=parseInt(t.substring(l+1),10)):l=t.length;const p=t.slice(0,l);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{const e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=i}"ns"in u&&(s=u.ns)}return{host:t,port:c,domain:n,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};class kc{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+We(this.snapshot.exportVal())}}class Cc{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Ec{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return Ee(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Tc{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return Br(this._path)?null:Mr(this._path)}get ref(){return new xc(this._repo,this._path)}get _queryIdentifier(){const e=Ms(this._queryParams),t=Xi(e);return"{}"===t?"default":t}get _queryObject(){return Ms(this._queryParams)}isEqual(e){if(!((e=ot(e))instanceof Tc))return!1;const t=this._repo===e._repo,n=Hr(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class xc extends Tc{constructor(e,t){super(e,t,new Ls,!1)}get parent(){const e=Ur(this._path);return null===e?null:new xc(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class Sc{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new Pr(e),n=Ac(this.ref,e);return new Sc(this._node.getChild(t),n,fs)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,((t,n)=>e(new Sc(n,Ac(this.ref,t),fs))))}hasChild(e){const t=new Pr(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Ic(e,t){return(e=ot(e))._checkNotDeleted("ref"),void 0!==t?Ac(e._root,t):e._root}function Ac(e,t){return null===Dr((e=ot(e))._path)?Ka("child","path",t,!1):Va("child","path",t,!1),new xc(e._repo,zr(e._path,t))}function Nc(e,t){(function(e,t){if(".info"===Dr(t))throw new Error(e+" failed = Can't modify data under /.info/")})("set",(e=ot(e))._path),function(e,t,n,i){i&&void 0===t||$a(Xe(e,"value"),t,n)}("set",t,e._path,!1);const n=new je;return cc(e._repo,e._path,t,null,n.wrapCallback((()=>{}))),n.promise}function Rc(e){e=ot(e);const t=new Ec((()=>{})),n=new Pc(t);return function(e,t,n){const i=function(e,t){const n=t._path;let i=null;e.syncPointTree_.foreachOnPath(n,((e,t)=>{const r=qr(e,n);i=i||Jo(t,r)}));let r=e.syncPointTree_.get(n);r?i=i||Jo(r,Or()):(r=new Yo,e.syncPointTree_=e.syncPointTree_.set(n,r));const s=null!=i,o=s?new Qs(i,!0,!1):null;return io(Zo(r,t,bo(e.pendingWriteTree_,t._path),s?o.getNode():ks.EMPTY_NODE,s).viewCache_)}(e.serverSyncTree_,t);return null!=i?Promise.resolve(i):e.server_.get(t).then((i=>{const r=Ts(i).withIndex(t._queryParams.getIndex());let s;if(ha(e.serverSyncTree_,t,n,!0),t._queryParams.loadsAllData())s=aa(e.serverSyncTree_,t._path,r);else{const n=ga(e.serverSyncTree_,t);s=la(e.serverSyncTree_,t._path,r,n)}return Za(e.eventQueue_,t._path,s),ca(e.serverSyncTree_,t,n,null,!0),r}),(n=>(hc(e,"get for query "+We(t)+" failed: "+n),Promise.reject(new Error(n)))))}(e._repo,e,n).then((t=>new Sc(t,new xc(e._repo,e._path),e._queryParams.getIndex())))}class Pc{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new kc("value",this,new Sc(e.snapshotNode,new xc(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Cc(this,e,t):null}matches(e){return e instanceof Pc&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}!function(e){Ee(!Vo,"__referenceConstructor has already been defined"),Vo=e}(xc),function(e){Ee(!Ko,"__referenceConstructor has already been defined"),Ko=e}(xc);const Oc={};function Dc(e,t,n,i,r){let s=i||e.options.databaseURL;void 0===s&&(e.options.projectId||$i("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),qi("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a,c=wc(s,r),l=c.repoInfo;"undefined"!=typeof process&&process.env&&(a=process.env.FIREBASE_DATABASE_EMULATOR_HOST),a?(o=!0,s=`http://${a}?ns=${l.namespace}`,c=wc(s,r),l=c.repoInfo):o=!c.repoInfo.secure;const h=r&&o?new lr(lr.OWNER):new cr(e.name,e.options,t);(function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Ha(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Wa(e)}(n))throw new Error(Xe(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')})("Invalid Firebase Database URL",c),Br(c.path)||$i("Database URL must point to the root of a Firebase Database (not including a child path).");const d=function(e,t,n,i){let r=Oc[t.name];r||(r={},Oc[t.name]=r);let s=r[e.toURLString()];return s&&$i("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new ec(e,false,n,i),r[e.toURLString()]=s,s}(l,e,h,new ar(e.name,n));return new Lc(d,e)}class Lc{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(tc(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new xc(this._repo,Or())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=Oc[t];n&&n[e.key]===e||$i(`Database ${t}(${e.repoInfo_}) has already been deleted.`),lc(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&$i("Cannot call "+e+" on a deleted database.")}}function jc(e){(e=ot(e))._checkNotDeleted("goOffline"),lc(e._repo)}function Mc(e){const t=Object.create(Storage.prototype);return t.getItem=t=>e.get(t),t.setItem=(t,n)=>e.set(t,n),t.removeItem=t=>{e.delete(t)},t.clear=()=>e.clear(),t.key=t=>e.keys()[t]||null,Object.defineProperty(t,"length",{get:()=>e.size,enumerable:!1,configurable:!1}),Object.freeze(t)}function Fc(e){const t=Object.create(null);return t.has=t=>t in e,t.get=t=>e[t]||null,t.set=(t,n)=>{e[t]=n},t.delete=t=>delete e[t],t.clear=()=>{for(const t of Object.keys(e))delete e[t]},t.keys=()=>Object.keys(e),t.values=()=>{const t=[];for(const n of Object.keys(e))t.push(e[n]);return t},t.entries=()=>{const t=[];for(const n of Object.keys(e))t.push([n,e[n]]);return t},Object.defineProperties(t,{size:{get:()=>Object.keys(e).length,enumerable:!1,configurable:!1}}),Object.freeze(t)}function Uc(e){const t=Object.create(null);return t.has=t=>null!==e.getItem(t),t.get=t=>e.getItem(t),t.set=(t,n)=>e.setItem(t,n),t.clear=()=>e.clear(),t.delete=t=>(e.removeItem(t),!0),t.keys=()=>{const t=e.length,n=new Array(t);for(let i=0;i<t;i++)n[i]=e.key(i);return n},t.values=()=>{const t=e.length,n=new Array(t);for(let i=0;i<t;i++)n[i]=e.getItem(e.key(i));return n},t.entries=()=>{const t=e.length,n=new Array(t);for(let i=0;i<t;i++){const t=e.key(i);n[i]=[t,e.getItem(t)]}return n},Object.defineProperties(t,{size:{get:()=>e.length,enumerable:!1,configurable:!1}}),Object.freeze(t)}Zr.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Zr.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},Ni="10.12.0",Vt(new at("database",((e,{instanceIdentifier:t})=>Dc(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)),"PUBLIC").setMultipleInstances(!0)),Jt(Ii,Ai,void 0),Jt(Ii,Ai,"esm2017");const zc=function(...e){if(1!==e.length)throw new Error("Invalid arguments");const t=e[0];if("object"!=typeof t)throw new Error("Invalid arguments");const n=Object.create(Bc);try{const e=t.localStorage,i=t.sessionStorage;if("object"!=typeof e||"object"!=typeof i)throw void 0;n.storageEnabled=!0,n.localStorage=Uc(e),n.sessionStorage=Uc(i)}catch(e){n.storageEnabled=!1,n.localStorage=Fc(Object.create(null)),n.sessionStorage=Fc(Object.create(null))}return Object.defineProperties(t,{localStorage:{value:Mc(n.localStorage),writable:!1,enumerable:!1,configurable:!1},sessionStorage:{value:Mc(n.sessionStorage),writable:!1,enumerable:!1,configurable:!1}}),Object.freeze(n)},Bc=Object.freeze(Object.create(null));Object.defineProperty(zc,"prototype",{value:Bc,writable:!1,enumerable:!1,configurable:!1}),Object.setPrototypeOf(zc,null),Object.freeze(zc);const qc=zc,Hc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Wc=new Uint8Array(new ArrayBuffer(256));for(let e=0;e<64;e++)Wc[Hc.charCodeAt(e)]=e;const $c={encode:function(e){let t="",n="";const i=new Uint8Array(e);for(let e=0;e<i.length;e+=3){const n=i[e]<<16|i[e+1]<<8|i[e+2];t+=Hc[n>>18&63]+Hc[n>>12&63]+Hc[n>>6&63]+Hc[63&n]}const r=i.length%3;return 1===r?(n="==",t=t.slice(0,-2)):2===r&&(n="=",t=t.slice(0,-1)),t+n},decode:function(e){let t=0;e.endsWith("==")?t=2:e.endsWith("=")&&(t=1);const n=.75*e.length-t,i=new ArrayBuffer(n),r=new Uint8Array(i);let s=0;for(let t=0;t<e.length;t+=4){const n=Wc[e.charCodeAt(t)]<<18|Wc[e.charCodeAt(t+1)]<<12|Wc[e.charCodeAt(t+2)]<<6|Wc[e.charCodeAt(t+3)];r[s++]=n>>16&255,r[s++]=n>>8&255,r[s++]=255&n}return i}};Object.setPrototypeOf($c,null),Object.freeze($c);const Vc=$c,Kc={encode:function(e){const t=Array.from(e).map((e=>e.codePointAt(0)||0)),n=[];for(const e of t)e<=127?n.push(e):e<=2047?(n.push(e>>6|192),n.push(63&e|128)):e<=65535?(n.push(e>>12|224),n.push(e>>6&63|128),n.push(63&e|128)):e<=1114111&&(n.push(e>>18|240),n.push(e>>12&63|128),n.push(e>>6&63|128),n.push(63&e|128));return new Uint8Array(n).buffer},decode:function(e){const t=new Uint8Array(e);let n="",i=0;for(;i<t.length;){const e=t[i];if(0==(128&e))n+=String.fromCharCode(e),i+=1;else if(192==(224&e)){const r=t[i+1];n+=String.fromCharCode((31&e)<<6|63&r),i+=2}else if(224==(240&e)){const r=t[i+1],s=t[i+2];n+=String.fromCharCode((15&e)<<12|(63&r)<<6|63&s),i+=3}else if(240==(248&e)){const r=(7&e)<<18|(63&t[i+1])<<12|(63&t[i+2])<<6|63&t[i+3];n+=r<=1114111?String.fromCodePoint(r):"",i+=4}else n+="",i+=1}return n}};Object.setPrototypeOf(Kc,null),Object.freeze(Kc);const Yc=Kc;function Gc(e){if("string"!=typeof e||!e)throw new Error("expected a non-empty string, got: "+e)}function Zc(e){if("number"!=typeof e)throw new Error("expected a number, got: "+e)}const Qc="emoji",Jc="keyvalue",Xc="favorites",el="tokens",tl="count",nl="group-order",il="eTag",rl="url",sl="skinTone",ol="readonly",al="readwrite",cl="skinUnicodes";function ll(e){return function(e,t){const n=new Set,i=[];for(const r of e){const e=t(r);n.has(e)||(n.add(e),i.push(r))}return i}(e,(e=>e.unicode))}const hl={},dl={},ul={};function pl(e,t,n){n.onerror=()=>t(n.error),n.onblocked=()=>t(new Error("IDB blocked")),n.onsuccess=()=>e(n.result)}function fl(e,t,n,i){return new Promise(((r,s)=>{const o=e.transaction(t,n,{durability:"relaxed"}),a="string"==typeof t?o.objectStore(t):t.map((e=>o.objectStore(e)));let c;i(a,o,(e=>{c=e})),o.oncomplete=()=>r(c),o.onerror=()=>s(o.error)}))}function ml(e){const t=hl[e],n=t&&t.result;if(n){n.close();const t=ul[e];if(t)for(const e of t)e()}delete hl[e],delete dl[e],delete ul[e]}const gl=new Set([":D","XD",":'D","O:)",":X",":P",";P","XP",":L",":Z",":j","8D","XO","8)",":B",":O",":S",":'o","Dx","X(","D:",":C",">0)",":3","</3","<3","\\M/",":E","8#"]);function _l(e){return e.split(/[\s_]+/).map((e=>!e.match(/\w/)||gl.has(e)?e.toLowerCase():e.replace(/[)(:,]/g,"").replace(//g,"'").toLowerCase())).filter(Boolean)}const yl=2;function bl(e){return e.filter(Boolean).map((e=>e.toLowerCase())).filter((e=>e.length>=yl))}function wl(e,t,n,i){e[t](n).onsuccess=e=>i&&i(e.target.result)}function vl(e,t,n){wl(e,"get",t,n)}function kl(e,t,n){wl(e,"getAll",t,n)}function Cl(e){e.commit&&e.commit()}function El(e,t){const n=function(e,t){let n=e[0];for(let i=1;i<e.length;i++){const r=e[i];t(n)>t(r)&&(n=r)}return n}(e,(e=>e.length)),i=[];for(const r of n)e.some((e=>-1===e.findIndex((e=>t(e)===t(r)))))||i.push(r);return i}async function Tl(e,t,n,i){try{const r=function(e){return e.map((({annotation:e,emoticon:t,group:n,order:i,shortcodes:r,skins:s,tags:o,emoji:a,version:c})=>{const l=[...new Set(bl([...(r||[]).map(_l).flat(),...o.map(_l).flat(),..._l(e),t]))].sort(),h={annotation:e,group:n,order:i,tags:o,tokens:l,unicode:a,version:c};if(t&&(h.emoticon=t),r&&(h.shortcodes=r),s){h.skinTones=[],h.skinUnicodes=[],h.skinVersions=[];for(const{tone:e,emoji:t,version:n}of s)h.skinTones.push(e),h.skinUnicodes.push(t),h.skinVersions.push(n)}return h}))}(t);await fl(e,[Qc,Jc],al,(([e,t],s)=>{let o,a,c=0;function l(){2==++c&&function(){if(o!==i||a!==n){e.clear();for(const t of r)e.put(t);t.put(i,il),t.put(n,rl),Cl(s)}}()}vl(t,il,(e=>{o=e,l()})),vl(t,rl,(e=>{a=e,l()}))}))}finally{}}async function xl(e,t){const n=bl(_l(t));return n.length?fl(e,Qc,ol,((e,t,i)=>{const r=[],s=()=>{const e=El(r,(e=>e.unicode));i(e.sort(((e,t)=>e.order<t.order?-1:1)))};for(let t=0;t<n.length;t++){const i=n[t],o=t===n.length-1?IDBKeyRange.bound(i,i+"",!1,!0):IDBKeyRange.only(i);kl(e.index(el),o,(e=>{r.push(e),r.length===n.length&&s()}))}})):[]}function Sl(e,t,n){return fl(e,t,ol,((e,t,i)=>vl(e,n,i)))}const Il=["name","url"];function Al(e){!function(e){const t=e&&Array.isArray(e),n=t&&e.length&&(!e[0]||Il.some((t=>!(t in e[0]))));if(!t||n)throw new Error("Custom emojis are in the wrong format")}(e);const t=(e,t)=>e.name.toLowerCase()<t.name.toLowerCase()?-1:1,n=e.sort(t),i=function(e,t){const n=new Map;for(const t of e){const e=[...new Set((t.shortcodes||[]).map((e=>_l(e))).flat())];for(const i of e){let e=n;for(let t=0;t<i.length;t++){const n=i.charAt(t);let r=e.get(n);r||(r=new Map,e.set(n,r)),e=r}let r=e.get("");r||(r=[],e.set("",r)),r.push(t)}}return(e,t)=>{let i=n;for(let t=0;t<e.length;t++){const n=e.charAt(t),r=i.get(n);if(!r)return[];i=r}if(t)return i.get("")||[];const r=[],s=[i];for(;s.length;){const e=[...s.shift().entries()].sort(((e,t)=>e[0]<t[0]?-1:1));for(const[t,n]of e)""===t?r.push(...n):s.push(n)}return r}}(e),r=e=>i(e,!0),s=e=>i(e,!1),o=new Map,a=new Map;for(const t of e){a.set(t.name.toLowerCase(),t);for(const e of t.shortcodes||[])o.set(e.toLowerCase(),t)}return{all:n,search:e=>{const n=_l(e),i=n.map(((e,t)=>(t<n.length-1?r:s)(e)));return El(i,(e=>e.name)).sort(t)},byShortcode:e=>o.get(e.toLowerCase()),byName:e=>a.get(e.toLowerCase())}}const Nl="undefined"!=typeof wrappedJSObject;function Rl(e){if(!e)return e;if(Nl&&(e=structuredClone(e)),delete e.tokens,e.skinTones){const t=e.skinTones.length;e.skins=Array(t);for(let n=0;n<t;n++)e.skins[n]={tone:e.skinTones[n],unicode:e.skinUnicodes[n],version:e.skinVersions[n]};delete e.skinTones,delete e.skinUnicodes,delete e.skinVersions}return e}function Pl(e){e||console.warn("emoji-picker-element is more efficient if the dataSource server exposes an ETag header.")}const Ol=["annotation","emoji","group","order","tags","version"];function Dl(e,t){if(2!==Math.floor(e.status/100))throw new Error("Failed to fetch: "+t+":  "+e.status)}async function Ll(e){const t=await fetch(e);Dl(t,e);const n=t.headers.get("etag");Pl(n);const i=await t.json();return function(e){if(!e||!Array.isArray(e)||!e[0]||"object"!=typeof e[0]||Ol.some((t=>!(t in e[0]))))throw new Error("Emoji data is in the wrong format")}(i),[n,i]}async function jl(e){let t=function(e){for(var t=e.length,n=new ArrayBuffer(t),i=new Uint8Array(n),r=-1;++r<t;)i[r]=e.charCodeAt(r);return n}(JSON.stringify(e));const n=function(e){for(var t="",n=new Uint8Array(e),i=n.byteLength,r=-1;++r<i;)t+=String.fromCharCode(n[r]);return t}(await crypto.subtle.digest("SHA-1",t));return btoa(n)}class Ml{constructor({dataSource:e="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",locale:t="en",customEmoji:n=[]}={}){this.dataSource=e,this.locale=t,this._dbName=`emoji-picker-element-${this.locale}`,this._db=void 0,this._lazyUpdate=void 0,this._custom=Al(n),this._clear=this._clear.bind(this),this._ready=this._init()}async _init(){const e=this._db=await(t=this._dbName,dl[t]||(dl[t]=async function(e){const t=await new Promise(((t,n)=>{const i=indexedDB.open(e,1);hl[e]=i,i.onupgradeneeded=e=>{e.oldVersion<1&&function(e){function t(t,n,i){const r=n?e.createObjectStore(t,{keyPath:n}):e.createObjectStore(t);if(i)for(const[e,[t,n]]of Object.entries(i))r.createIndex(e,t,{multiEntry:n});return r}t(Jc),t(Qc,"unicode",{[el]:["tokens",!0],[nl]:[["group","order"]],[cl]:["skinUnicodes",!0]}),t(Xc,void 0,{[tl]:[""]})}(i.result)},pl(t,n,i)}));return t.onclose=()=>ml(e),t}(t)),dl[t]);var t;!function(e,t){let n=ul[e];n||(n=ul[e]=[]),n.push(t)}(this._dbName,this._clear);const n=this.dataSource,i=await async function(e){return!await Sl(e,Jc,rl)}(e);i?await async function(e,t){let[n,i]=await Ll(t);n||(n=await jl(i)),await Tl(e,i,t,n)}(e,n):this._lazyUpdate=async function(e,t){let n,i=await async function(e){const t=await fetch(e,{method:"HEAD"});Dl(t,e);const n=t.headers.get("etag");return Pl(n),n}(t);if(!i){const e=await Ll(t);i=e[0],n=e[1],i||(i=await jl(n))}await async function(e,t,n){const[i,r]=await Promise.all([il,rl].map((t=>Sl(e,Jc,t))));return i===n&&r===t}(e,t,i)||(n||(n=(await Ll(t))[1]),await Tl(e,n,t,i))}(e,n)}async ready(){const e=async()=>(this._ready||(this._ready=this._init()),this._ready);await e(),this._db||await e()}async getEmojiByGroup(e){return Zc(e),await this.ready(),ll(await async function(e,t){return fl(e,Qc,ol,((e,n,i)=>{const r=IDBKeyRange.bound([t,0],[t+1,0],!1,!0);kl(e.index(nl),r,i)}))}(this._db,e)).map(Rl)}async getEmojiBySearchQuery(e){return Gc(e),await this.ready(),[...this._custom.search(e),...ll(await xl(this._db,e)).map(Rl)]}async getEmojiByShortcode(e){Gc(e),await this.ready();return this._custom.byShortcode(e)||Rl(await async function(e,t){const n=await xl(e,t);if(!n.length){const n=e=>(e.shortcodes||[]).includes(t.toLowerCase());return await async function(e,t){return fl(e,Qc,ol,((e,n,i)=>{let r;const s=()=>{e.getAll(r&&IDBKeyRange.lowerBound(r,!0),50).onsuccess=e=>{const n=e.target.result;for(const e of n)if(r=e.unicode,t(e))return i(e);if(n.length<50)return i();s()}};s()}))}(e,n)||null}return n.filter((e=>{const n=(e.shortcodes||[]).map((e=>e.toLowerCase()));return n.includes(t.toLowerCase())}))[0]||null}(this._db,e))}async getEmojiByUnicodeOrName(e){Gc(e),await this.ready();return this._custom.byName(e)||Rl(await async function(e,t){return fl(e,Qc,ol,((e,n,i)=>vl(e,t,(n=>{if(n)return i(n);vl(e.index(cl),t,(e=>i(e||null)))}))))}(this._db,e))}async getPreferredSkinTone(){return await this.ready(),await Sl(this._db,Jc,sl)||0}async setPreferredSkinTone(e){return Zc(e),await this.ready(),function(e,t,n,i){return fl(e,t,al,((e,t)=>{e.put(i,n),Cl(t)}))}(this._db,Jc,sl,e)}async incrementFavoriteEmojiCount(e){return Gc(e),await this.ready(),t=this._db,n=e,fl(t,Xc,al,((e,t)=>vl(e,n,(i=>{e.put((i||0)+1,n),Cl(t)}))));var t,n}async getTopFavoriteEmoji(e){return Zc(e),await this.ready(),(await function(e,t,n){return 0===n?[]:fl(e,[Xc,Qc],ol,(([e,i],r,s)=>{const o=[];e.index(tl).openCursor(void 0,"prev").onsuccess=e=>{const r=e.target.result;if(!r)return s(o);function a(e){if(o.push(e),o.length===n)return s(o);r.continue()}const c=r.primaryKey,l=t.byName(c);if(l)return a(l);vl(i,c,(e=>{if(e)return a(e);r.continue()}))}}))}(this._db,this._custom,e)).map(Rl)}set customEmoji(e){this._custom=Al(e)}get customEmoji(){return this._custom.all}async _shutdown(){await this.ready();try{await this._lazyUpdate}catch(e){}}_clear(){this._db=this._ready=this._lazyUpdate=void 0}async close(){await this._shutdown(),await ml(this._dbName)}async delete(){var e;await this._shutdown(),await(e=this._dbName,new Promise(((t,n)=>{ml(e),pl(t,n,indexedDB.deleteDatabase(e))})))}}const Fl=[[-1,"","custom"],[0,"","smileys-emotion"],[1,"","people-body"],[3,"","animals-nature"],[4,"","food-drink"],[5,"","travel-places"],[6,"","activities"],[7,"","objects"],[8,"","symbols"],[9,"","flags"]].map((([e,t,n])=>({id:e,emoji:t,name:n}))),Ul=Fl.slice(1),zl="function"==typeof requestIdleCallback?requestIdleCallback:setTimeout;function Bl(e){return e.unicode.includes("")}const ql={"":15.1,"":14,"":13.1,"":12.1,"":11,"":5,"":4,"":3,"":2,"":1,"":.7,"":.6},Hl=["","","","","","","","","","","","","",""],Wl='"Twemoji Mozilla","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji","EmojiOne Color","Android Emoji",sans-serif',$l=(e,t)=>e<t?-1:e>t?1:0,Vl=(e,t)=>{const n=document.createElement("canvas");n.width=n.height=1;const i=n.getContext("2d");return i.textBaseline="top",i.font=`100px ${Wl}`,i.fillStyle=t,i.scale(.01,.01),i.fillText(e,0,0),i.getImageData(0,0,1,1).data};function Kl(e){const t=Vl(e,"#000"),n=Vl(e,"#fff");return t&&n&&((e,t)=>{const n=[...e].join(",");return n===[...t].join(",")&&!n.startsWith("0,0,0,")})(t,n)}let Yl;const Gl=()=>(Yl||(Yl=new Promise((e=>zl((()=>e(function(){const e=Object.entries(ql);try{for(const[t,n]of e)if(Kl(t))return n}catch(e){}return e[0][1]}())))))),Yl),Zl=new Map;function Ql(e){e.preventDefault(),e.stopPropagation()}function Jl(e,t,n){return(t+=e?-1:1)<0?t=n.length-1:t>=n.length&&(t=0),t}function Xl(e,t){const n=new Set,i=[];for(const r of e){const e=t(r);n.has(e)||(n.add(e),i.push(r))}return i}const eh=requestAnimationFrame;let th,nh="function"==typeof ResizeObserver;function ih(e){{const t=document.createRange();return t.selectNode(e.firstChild),t.getBoundingClientRect().width}}function rh(e,t,n){let i=e.get(t);return i||(i=n(),e.set(t,i)),i}function sh(e){return""+e}const oh=new WeakMap,ah=new WeakMap,ch=Symbol("un-keyed"),lh="replaceChildren"in Element.prototype;function hh(e,t){const{targetNode:n}=t;let{targetParentNode:i}=t,r=!1;i?r=function(e,t){let n=e.firstChild,i=0;for(;n;){if(t[i]!==n)return!0;n=n.nextSibling,i++}return i!==t.length}(i,e):(r=!0,t.targetNode=void 0,t.targetParentNode=i=n.parentNode),r&&function(e,t){lh?e.replaceChildren(...t):(e.innerHTML="",e.append(...t))}(i,e)}function dh(e){const{template:t,elementsToBindings:n}=rh(oh,e,(()=>function(e){let t="",n=!1,i=!1,r=-1;const s=new Map,o=[];for(let a=0,c=e.length;a<c;a++){const l=e[a];if(t+=l,a===c-1)break;for(let e=0;e<l.length;e++)switch(l.charAt(e)){case"<":"/"===l.charAt(e+1)?o.pop():(n=!0,o.push(++r));break;case">":n=!1,i=!1;break;case"=":i=!0}const h=rh(s,o[o.length-1],(()=>[]));let d,u,p;if(i){const t=/(\S+)="?([^"=]*)$/.exec(l);d=t[1],u=t[2],p=/^[^">]*/.exec(e[a+1])[0]}const f={attributeName:d,attributeValuePre:u,attributeValuePost:p,expressionIndex:a};h.push(f),n||i||(t+=" ")}const a=function(e){const t=document.createElement("template");return t.innerHTML=e,t}(t);return{template:a,elementsToBindings:s}}(e))),i=t.cloneNode(!0).content.firstElementChild,r=function(e,t){const n=[],i=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT);let r=e,s=-1;do{const e=t.get(++s);if(e)for(let t=0;t<e.length;t++){const i=e[t],s={binding:i,targetNode:i.attributeName?r:r.firstChild,targetParentNode:void 0,currentExpression:void 0};n.push(s)}}while(r=i.nextNode());return n}(i,n);return function(e){return function(e,t){for(const n of t){const{targetNode:t,currentExpression:i,binding:{expressionIndex:r,attributeName:s,attributeValuePre:o,attributeValuePost:a}}=n,c=e[r];if(i!==c)if(n.currentExpression=c,s)t.setAttribute(s,o+sh(c)+a);else{let e;Array.isArray(c)?hh(c,n):c instanceof Element?(e=c,t.replaceWith(e)):t.nodeValue=sh(c),e&&(n.targetNode=e)}}}(e,r),i}}const uh="function"==typeof queueMicrotask?queueMicrotask:e=>Promise.resolve().then(e);function ph(e,t,n){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!n(e[i],t[i]))return!1;return!0}const fh=[],{assign:mh}=Object;function gh(e,t){const n={},i=new AbortController,r=i.signal,{state:s,createEffect:o}=function(e){let t,n=!1;const i=new Map,r=new Set;let s;const o=()=>{if(n)return;const e=[...r];r.clear();try{for(const t of e)t()}finally{s=!1,r.size&&(s=!0,uh(o))}},a=new Proxy({},{get(e,n){if(t){let e=i.get(n);e||(e=new Set,i.set(n,e)),e.add(t)}return e[n]},set(e,t,n){e[t]=n;const a=i.get(t);if(a){for(const e of a)r.add(e);s||(s=!0,uh(o))}return!0}});return e.addEventListener("abort",(()=>{n=!0})),{state:a,createEffect:e=>{const n=()=>{const i=t;t=n;try{return e()}finally{t=i}};return n()}}}(r);mh(s,{skinToneEmoji:void 0,i18n:void 0,database:void 0,customEmoji:void 0,customCategorySorting:void 0,emojiVersion:void 0}),mh(s,t),mh(s,{initialLoad:!0,currentEmojis:[],currentEmojisWithCategories:[],rawSearchText:"",searchText:"",searchMode:!1,activeSearchItem:-1,message:void 0,skinTonePickerExpanded:!1,skinTonePickerExpandedAfterAnimation:!1,currentSkinTone:0,activeSkinTone:0,skinToneButtonText:void 0,pickerStyle:void 0,skinToneButtonLabel:"",skinTones:[],currentFavorites:[],defaultFavoriteEmojis:void 0,numColumns:8,isRtl:!1,scrollbarWidth:0,currentGroupIndex:0,groups:Ul,databaseLoaded:!1,activeSearchItemId:void 0}),o((()=>{s.currentGroup!==s.groups[s.currentGroupIndex]&&(s.currentGroup=s.groups[s.currentGroupIndex])}));const a=t=>{e.getElementById(t).focus()},c=t=>e.getElementById(`emo-${t.id}`),l=(e,t)=>{n.rootElement.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0,composed:!0}))},h=(e,t)=>e.id===t.id,d=(e,t)=>{const{category:n,emojis:i}=e,{category:r,emojis:s}=t;return n===r&&ph(i,s,h)},u=e=>{ph(s.currentEmojis,e,h)||(s.currentEmojis=e)},p=e=>{s.searchMode!==e&&(s.searchMode=e)},f=(e,t)=>t&&e.skins&&e.skins[t]||e.unicode,m={labelWithSkin:(e,t)=>{return(n=[e.name||f(e,t),e.annotation,...e.shortcodes||fh].filter(Boolean),Xl(n,(e=>e))).join(", ");var n},titleForEmoji:e=>e.annotation||(e.shortcodes||fh).join(", "),unicodeWithSkin:f},g={onClickSkinToneButton:function(e){s.skinTonePickerExpanded=!s.skinTonePickerExpanded,s.activeSkinTone=s.currentSkinTone,s.skinTonePickerExpanded&&(Ql(e),eh((()=>a("skintone-list"))))},onEmojiClick:async function(e){const{target:t}=e;t.classList.contains("emoji")&&(Ql(e),C(t.id.substring(4)))},onNavClick:function(e){const{target:t}=e,i=t.closest(".nav-button");if(!i)return;const r=parseInt(i.dataset.groupId,10);n.searchElement.value="",s.rawSearchText="",s.searchText="",s.activeSearchItem=-1,s.currentGroupIndex=s.groups.findIndex((e=>e.id===r))},onNavKeydown:function(e){const{target:t,key:n}=e,i=t=>{t&&(Ql(e),t.focus())};switch(n){case"ArrowLeft":return i(t.previousElementSibling);case"ArrowRight":return i(t.nextElementSibling);case"Home":return i(t.parentElement.firstElementChild);case"End":return i(t.parentElement.lastElementChild)}},onSearchKeydown:function(e){if(!s.searchMode||!s.currentEmojis.length)return;const t=t=>{Ql(e),s.activeSearchItem=Jl(t,s.activeSearchItem,s.currentEmojis)};switch(e.key){case"ArrowDown":return t(!1);case"ArrowUp":return t(!0);case"Enter":if(-1!==s.activeSearchItem)return Ql(e),C(s.currentEmojis[s.activeSearchItem].id);s.activeSearchItem=0}},onSkinToneOptionsClick:function(e){const{target:{id:t}}=e,n=t&&t.match(/^skintone-(\d)/);n&&(Ql(e),E(parseInt(n[1],10)))},onSkinToneOptionsFocusOut:async function(e){const{relatedTarget:t}=e;t&&"skintone-list"===t.id||(s.skinTonePickerExpanded=!1)},onSkinToneOptionsKeydown:function(e){if(!s.skinTonePickerExpanded)return;const t=async t=>{Ql(e),s.activeSkinTone=t};switch(e.key){case"ArrowUp":return t(Jl(!0,s.activeSkinTone,s.skinTones));case"ArrowDown":return t(Jl(!1,s.activeSkinTone,s.skinTones));case"Home":return t(0);case"End":return t(s.skinTones.length-1);case"Enter":return Ql(e),E(s.activeSkinTone);case"Escape":return Ql(e),s.skinTonePickerExpanded=!1,a("skintone-button")}},onSkinToneOptionsKeyup:function(e){if(s.skinTonePickerExpanded)return" "===e.key?(Ql(e),E(s.activeSkinTone)):void 0},onSearchInput:function(e){s.rawSearchText=e.target.value}},_={calculateEmojiGridStyle:function(e){!function(e,t,n){let i;nh?(i=new ResizeObserver((e=>n(e[0].contentRect.width))),i.observe(e)):eh((()=>n(e.getBoundingClientRect().width))),t.addEventListener("abort",(()=>{i&&i.disconnect()}))}(e,r,(t=>{{const i=getComputedStyle(n.rootElement),r=parseInt(i.getPropertyValue("--num-columns"),10),o="rtl"===i.getPropertyValue("direction"),a=e.parentElement.getBoundingClientRect().width-t;s.numColumns=r,s.scrollbarWidth=a,s.isRtl=o}}))}};let y=!0;function b(){s.database.customEmoji=s.customEmoji||fh}function w(e){return!e.unicode||!Bl(e)||Zl.get(e.unicode)}async function v(e){const t=s.emojiVersion||await Gl();return e.filter((({version:e})=>!e||e<=t))}async function k(e){return function(e,t){const n=e=>{const n={};for(const i of e)"number"==typeof i.tone&&i.version<=t&&(n[i.tone]=i.unicode);return n};return e.map((({unicode:e,skins:t,shortcodes:i,url:r,name:s,category:o,annotation:a})=>({unicode:e,name:s,shortcodes:i,url:r,category:o,annotation:a,id:e||s,skins:t&&n(t)})))}(e,s.emojiVersion||await Gl())}async function C(e){const t=await s.database.getEmojiByUnicodeOrName(e),n=[...s.currentEmojis,...s.currentFavorites].find((t=>t.id===e)),i=n.unicode&&f(n,s.currentSkinTone);await s.database.incrementFavoriteEmojiCount(e),l("emoji-click",{emoji:t,skinTone:s.currentSkinTone,...i&&{unicode:i},...n.name&&{name:n.name}})}function E(e){s.currentSkinTone=e,s.skinTonePickerExpanded=!1,a("skintone-button"),l("skin-tone-change",{skinTone:e}),s.database.setPreferredSkinTone(e)}return o((()=>{(function(e,t,n,i,r,s,o,a){const{labelWithSkin:c,titleForEmoji:l,unicodeWithSkin:h}=n,{html:d,map:u}=function(e){const t=rh(ah,e,(()=>new Map));let n=ch;return{map:function(e,t,i){return e.map(((e,r)=>{const s=n;n=i(e);try{return t(e,r)}finally{n=s}}))},html:function(e,...i){const r=rh(t,e,(()=>new Map));return rh(r,n,(()=>dh(e)))(i)}}}(t);function p(e,n,i){return u(e,((e,r)=>d`<button role="${n?"option":"menuitem"}" aria-selected="${t.searchMode?r===t.activeSearchItem:""}" aria-label="${c(e,t.currentSkinTone)}" title="${l(e)}" class="emoji ${n&&r===t.activeSearchItem?"active":""}" id="${`${i}-${e.id}`}">${e.unicode?h(e,t.currentSkinTone):d`<img class="custom-emoji" src="${e.url}" alt="" loading="lazy">`}</button>`),(e=>`${i}-${e.id}`))}const f=d`<section data-ref="rootElement" class="picker" aria-label="${t.i18n.regionLabel}" style="${t.pickerStyle}"><div class="pad-top"></div><div class="search-row"><div class="search-wrapper"><input id="search" class="search" type="search" role="combobox" enterkeyhint="search" placeholder="${t.i18n.searchLabel}" autocapitalize="none" autocomplete="off" spellcheck="true" aria-expanded="${!(!t.searchMode||!t.currentEmojis.length)}" aria-controls="search-results" aria-describedby="search-description" aria-autocomplete="list" aria-activedescendant="${t.activeSearchItemId?`emo-${t.activeSearchItemId}`:""}" data-ref="searchElement" data-on-input="onSearchInput" data-on-keydown="onSearchKeydown"><label class="sr-only" for="search">${t.i18n.searchLabel}</label> <span id="search-description" class="sr-only">${t.i18n.searchDescription}</span></div><div class="skintone-button-wrapper ${t.skinTonePickerExpandedAfterAnimation?"expanded":""}"><button id="skintone-button" class="emoji ${t.skinTonePickerExpanded?"hide-focus":""}" aria-label="${t.skinToneButtonLabel}" title="${t.skinToneButtonLabel}" aria-describedby="skintone-description" aria-haspopup="listbox" aria-expanded="${t.skinTonePickerExpanded}" aria-controls="skintone-list" data-on-click="onClickSkinToneButton">${t.skinToneButtonText}</button></div><span id="skintone-description" class="sr-only">${t.i18n.skinToneDescription}</span><div data-ref="skinToneDropdown" id="skintone-list" class="skintone-list hide-focus ${t.skinTonePickerExpanded?"":"hidden no-animate"}" style="transform:translateY(${t.skinTonePickerExpanded?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))"})" role="listbox" aria-label="${t.i18n.skinTonesLabel}" aria-activedescendant="skintone-${t.activeSkinTone}" aria-hidden="${!t.skinTonePickerExpanded}" tabIndex="-1" data-on-focusout="onSkinToneOptionsFocusOut" data-on-click="onSkinToneOptionsClick" data-on-keydown="onSkinToneOptionsKeydown" data-on-keyup="onSkinToneOptionsKeyup">${u(t.skinTones,((e,n)=>d`<div id="skintone-${n}" class="emoji ${n===t.activeSkinTone?"active":""}" aria-selected="${n===t.activeSkinTone}" role="option" title="${t.i18n.skinTones[n]}" aria-label="${t.i18n.skinTones[n]}">${e}</div>`),(e=>e))}</div></div><div class="nav" role="tablist" style="grid-template-columns:repeat(${t.groups.length},1fr)" aria-label="${t.i18n.categoriesLabel}" data-on-keydown="onNavKeydown" data-on-click="onNavClick">${u(t.groups,(e=>d`<button role="tab" class="nav-button" aria-controls="tab-${e.id}" aria-label="${t.i18n.categories[e.name]}" aria-selected="${!t.searchMode&&t.currentGroup.id===e.id}" title="${t.i18n.categories[e.name]}" data-group-id="${e.id}"><div class="nav-emoji emoji">${e.emoji}</div></button>`),(e=>e.id))}</div><div class="indicator-wrapper"><div class="indicator" style="transform:translateX(${(t.isRtl?-1:1)*t.currentGroupIndex*100}%)"></div></div><div class="message ${t.message?"":"gone"}" role="alert" aria-live="polite">${t.message}</div><div data-ref="tabpanelElement" class="tabpanel ${!t.databaseLoaded||t.message?"gone":""}" role="${t.searchMode?"region":"tabpanel"}" aria-label="${t.searchMode?t.i18n.searchResultsLabel:t.i18n.categories[t.currentGroup.name]}" id="${t.searchMode?"":`tab-${t.currentGroup.id}`}" tabIndex="0" data-on-click="onEmojiClick"><div data-action="calculateEmojiGridStyle">${u(t.currentEmojisWithCategories,((e,n)=>d`<div><div id="menu-label-${n}" class="category ${1===t.currentEmojisWithCategories.length&&""===t.currentEmojisWithCategories[0].category?"gone":""}" aria-hidden="true">${t.searchMode?t.i18n.searchResultsLabel:e.category?e.category:t.currentEmojisWithCategories.length>1?t.i18n.categories.custom:t.i18n.categories[t.currentGroup.name]}</div><div class="emoji-menu" role="${t.searchMode?"listbox":"menu"}" aria-labelledby="menu-label-${n}" id="${t.searchMode?"search-results":""}">${p(e.emojis,t.searchMode,"emo")}</div></div>`),(e=>e.category))}</div></div><div class="favorites emoji-menu ${t.message?"gone":""}" role="menu" aria-label="${t.i18n.favoritesLabel}" style="padding-inline-end:${`${t.scrollbarWidth}px`}" data-on-click="onEmojiClick">${p(t.currentFavorites,!1,"fav")}</div><button data-ref="baselineEmoji" aria-hidden="true" tabindex="-1" class="abs-pos hidden emoji baseline-emoji"></button></section>`;if(a){e.appendChild(f);const t=(t,n)=>{for(const i of e.querySelectorAll(`[${t}]`))n(i,i.getAttribute(t))};for(const e of["click","focusout","input","keydown","keyup"])t(`data-on-${e}`,((t,n)=>{t.addEventListener(e,i[n])}));t("data-ref",((e,t)=>{s[t]=e})),t("data-action",((e,t)=>{r[t](e)})),o.addEventListener("abort",(()=>{e.removeChild(f)}))}})(e,s,m,g,_,n,r,y),y=!1})),s.emojiVersion||Gl().then((e=>{e||(s.message=s.i18n.emojiUnsupportedMessage)})),o((()=>{s.database&&async function(){let e=!1;const t=setTimeout((()=>{e=!0,s.message=s.i18n.loadingMessage}),1e3);try{await s.database.ready(),s.databaseLoaded=!0}catch(e){console.error(e),s.message=s.i18n.networkErrorMessage}finally{clearTimeout(t),e&&(e=!1,s.message="")}}()})),o((()=>{s.pickerStyle=`\n      --num-groups: ${s.groups.length}; \n      --indicator-opacity: ${s.searchMode?0:1}; \n      --num-skintones: 6;`})),o((()=>{s.customEmoji&&s.database&&b()})),o((()=>{s.customEmoji&&s.customEmoji.length?s.groups!==Fl&&(s.groups=Fl):s.groups!==Ul&&(s.currentGroupIndex&&s.currentGroupIndex--,s.groups=Ul)})),o((()=>{!async function(){s.databaseLoaded&&(s.currentSkinTone=await s.database.getPreferredSkinTone())}()})),o((()=>{s.skinTones=Array(6).fill().map(((e,t)=>function(e,t){if(0===t)return e;const n=e.indexOf("");return-1!==n?e.substring(0,n)+String.fromCodePoint(127995+t-1)+e.substring(n):(e.endsWith("")&&(e=e.substring(0,e.length-1)),e+"\ud83c"+String.fromCodePoint(57339+t-1))}(s.skinToneEmoji,t)))})),o((()=>{s.skinToneButtonText=s.skinTones[s.currentSkinTone]})),o((()=>{s.skinToneButtonLabel=s.i18n.skinToneLabel.replace("{skinTone}",s.i18n.skinTones[s.currentSkinTone])})),o((()=>{s.databaseLoaded&&async function(){const{database:e}=s,t=(await Promise.all(Hl.map((t=>e.getEmojiByUnicodeOrName(t))))).filter(Boolean);s.defaultFavoriteEmojis=t}()})),o((()=>{s.databaseLoaded&&s.defaultFavoriteEmojis&&async function(){b();const{database:e,defaultFavoriteEmojis:t,numColumns:n}=s,i=await e.getTopFavoriteEmoji(n),r=await k(Xl([...i,...t],(e=>e.unicode||e.name)).slice(0,n));s.currentFavorites=r}()})),o((()=>{!async function(){const{searchText:e,currentGroup:t,databaseLoaded:n,customEmoji:i}=s;if(n)if(e.length>=2){const t=await async function(e){return k(await v(await s.database.getEmojiBySearchQuery(e)))}(e);s.searchText===e&&(u(t),p(!0))}else{const{id:e}=t;if(-1!==e||i&&i.length){const t=await async function(e){const t=-1===e?s.customEmoji:await s.database.getEmojiByGroup(e);return k(await v(t))}(e);s.currentGroup.id===e&&(u(t),p(!1))}}else s.currentEmojis=[],s.searchMode=!1}()})),o((()=>{const{currentEmojis:e,emojiVersion:t}=s,i=e.filter((e=>e.unicode)).filter((e=>Bl(e)&&!Zl.has(e.unicode)));if(!t&&i.length)u(e),eh((()=>function(e){(function(e,t,n){for(const i of e){const e=ih(n(i));void 0===th&&(th=ih(t));const r=e/1.8<th;Zl.set(i.unicode,r)}})(e,n.baselineEmoji,c),s.currentEmojis=s.currentEmojis}(i)));else{const i=t?e:e.filter(w);u(i),eh((()=>{var e;(e=n.tabpanelElement)&&(e.scrollTop=0)}))}})),o((()=>{})),o((()=>{var e;e=function(){const{searchMode:e,currentEmojis:t}=s;if(e)return[{category:"",emojis:t}];const n=new Map;for(const e of t){const t=e.category||"";let i=n.get(t);i||(i=[],n.set(t,i)),i.push(e)}return[...n.entries()].map((([e,t])=>({category:e,emojis:t}))).sort(((e,t)=>s.customCategorySorting(e.category,t.category)))}(),ph(s.currentEmojisWithCategories,e,d)||(s.currentEmojisWithCategories=e)})),o((()=>{s.activeSearchItemId=-1!==s.activeSearchItem&&s.currentEmojis[s.activeSearchItem].id})),o((()=>{const{rawSearchText:e}=s;zl((()=>{s.searchText=(e||"").trim(),s.activeSearchItem=-1}))})),o((()=>{s.skinTonePickerExpanded?n.skinToneDropdown.addEventListener("transitionend",(()=>{s.skinTonePickerExpandedAfterAnimation=!0}),{once:!0}):s.skinTonePickerExpandedAfterAnimation=!1})),{$set(e){mh(s,e)},$destroy(){i.abort()}}}var _h={categoriesLabel:"Categories",emojiUnsupportedMessage:"Your browser does not support color emoji.",favoritesLabel:"Favorites",loadingMessage:"Loading",networkErrorMessage:"Could not load emoji.",regionLabel:"Emoji picker",searchDescription:"When search results are available, press up or down to select and enter to choose.",searchLabel:"Search",searchResultsLabel:"Search results",skinToneDescription:"When expanded, press up or down to select and enter to choose.",skinToneLabel:"Choose a skin tone (currently {skinTone})",skinTonesLabel:"Skin tones",skinTones:["Default","Light","Medium-Light","Medium","Medium-Dark","Dark"],categories:{custom:"Custom","smileys-emotion":"Smileys and emoticons","people-body":"People and body","animals-nature":"Animals and nature","food-drink":"Food and drink","travel-places":"Travel and places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"}};const yh=["customEmoji","customCategorySorting","database","dataSource","i18n","locale","skinToneEmoji","emojiVersion"],bh=`:host{--emoji-font-family:${Wl}}`;class wh extends HTMLElement{constructor(e){super(),this.attachShadow({mode:"open"});const t=document.createElement("style");t.textContent=":host{--emoji-size:1.375rem;--emoji-padding:0.5rem;--category-emoji-size:var(--emoji-size);--category-emoji-padding:var(--emoji-padding);--indicator-height:3px;--input-border-radius:0.5rem;--input-border-size:1px;--input-font-size:1rem;--input-line-height:1.5;--input-padding:0.25rem;--num-columns:8;--outline-size:2px;--border-size:1px;--skintone-border-radius:1rem;--category-font-size:1rem;display:flex;width:min-content;height:400px}:host,:host(.light){color-scheme:light;--background:#fff;--border-color:#e0e0e0;--indicator-color:#385ac1;--input-border-color:#999;--input-font-color:#111;--input-placeholder-color:#999;--outline-color:#999;--category-font-color:#111;--button-active-background:#e6e6e6;--button-hover-background:#d9d9d9}:host(.dark){color-scheme:dark;--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}@media (prefers-color-scheme:dark){:host{color-scheme:dark;--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}}:host([hidden]){display:none}button{margin:0;padding:0;border:0;background:0 0;box-shadow:none;-webkit-tap-highlight-color:transparent}button::-moz-focus-inner{border:0}input{padding:0;margin:0;line-height:1.15;font-family:inherit}input[type=search]{-webkit-appearance:none}:focus{outline:var(--outline-color) solid var(--outline-size);outline-offset:calc(-1*var(--outline-size))}:host([data-js-focus-visible]) :focus:not([data-focus-visible-added]){outline:0}:focus:not(:focus-visible){outline:0}.hide-focus{outline:0}*{box-sizing:border-box}.picker{contain:content;display:flex;flex-direction:column;background:var(--background);border:var(--border-size) solid var(--border-color);width:100%;height:100%;overflow:hidden;--total-emoji-size:calc(var(--emoji-size) + (2 * var(--emoji-padding)));--total-category-emoji-size:calc(var(--category-emoji-size) + (2 * var(--category-emoji-padding)))}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.hidden{opacity:0;pointer-events:none}.abs-pos{position:absolute;left:0;top:0}.gone{display:none!important}.skintone-button-wrapper,.skintone-list{background:var(--background);z-index:3}.skintone-button-wrapper.expanded{z-index:1}.skintone-list{position:absolute;inset-inline-end:0;top:0;z-index:2;overflow:visible;border-bottom:var(--border-size) solid var(--border-color);border-radius:0 0 var(--skintone-border-radius) var(--skintone-border-radius);will-change:transform;transition:transform .2s ease-in-out;transform-origin:center 0}@media (prefers-reduced-motion:reduce){.skintone-list{transition-duration:.001s}}@supports not (inset-inline-end:0){.skintone-list{right:0}}.skintone-list.no-animate{transition:none}.tabpanel{overflow-y:auto;-webkit-overflow-scrolling:touch;will-change:transform;min-height:0;flex:1;contain:content}.emoji-menu{display:grid;grid-template-columns:repeat(var(--num-columns),var(--total-emoji-size));justify-content:space-around;align-items:flex-start;width:100%}.category{padding:var(--emoji-padding);font-size:var(--category-font-size);color:var(--category-font-color)}.custom-emoji,.emoji,button.emoji{height:var(--total-emoji-size);width:var(--total-emoji-size)}.emoji,button.emoji{font-size:var(--emoji-size);display:flex;align-items:center;justify-content:center;border-radius:100%;line-height:1;overflow:hidden;font-family:var(--emoji-font-family);cursor:pointer}@media (hover:hover) and (pointer:fine){.emoji:hover,button.emoji:hover{background:var(--button-hover-background)}}.emoji.active,.emoji:active,button.emoji.active,button.emoji:active{background:var(--button-active-background)}.custom-emoji{padding:var(--emoji-padding);object-fit:contain;pointer-events:none;background-repeat:no-repeat;background-position:center center;background-size:var(--emoji-size) var(--emoji-size)}.nav,.nav-button{align-items:center}.nav{display:grid;justify-content:space-between;contain:content}.nav-button{display:flex;justify-content:center}.nav-emoji{font-size:var(--category-emoji-size);width:var(--total-category-emoji-size);height:var(--total-category-emoji-size)}.indicator-wrapper{display:flex;border-bottom:1px solid var(--border-color)}.indicator{width:calc(100%/var(--num-groups));height:var(--indicator-height);opacity:var(--indicator-opacity);background-color:var(--indicator-color);will-change:transform,opacity;transition:opacity .1s linear,transform .25s ease-in-out}@media (prefers-reduced-motion:reduce){.indicator{will-change:opacity;transition:opacity .1s linear}}.pad-top,input.search{background:var(--background);width:100%}.pad-top{height:var(--emoji-padding);z-index:3}.search-row{display:flex;align-items:center;position:relative;padding-inline-start:var(--emoji-padding);padding-bottom:var(--emoji-padding)}.search-wrapper{flex:1;min-width:0}input.search{padding:var(--input-padding);border-radius:var(--input-border-radius);border:var(--input-border-size) solid var(--input-border-color);color:var(--input-font-color);font-size:var(--input-font-size);line-height:var(--input-line-height)}input.search::placeholder{color:var(--input-placeholder-color)}.favorites{display:flex;flex-direction:row;border-top:var(--border-size) solid var(--border-color);contain:content}.message{padding:var(--emoji-padding)}"+bh,this.shadowRoot.appendChild(t),this._ctx={locale:"en",dataSource:"https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",skinToneEmoji:"",customCategorySorting:$l,customEmoji:null,i18n:_h,emojiVersion:null,...e};for(const e of yh)"database"!==e&&Object.prototype.hasOwnProperty.call(this,e)&&(this._ctx[e]=this[e],delete this[e]);this._dbFlush()}connectedCallback(){this._cmp||(this._cmp=gh(this.shadowRoot,this._ctx))}disconnectedCallback(){uh((()=>{if(!this.isConnected&&this._cmp){this._cmp.$destroy(),this._cmp=void 0;const{database:e}=this._ctx;e.close().catch((e=>console.error(e)))}}))}static get observedAttributes(){return["locale","data-source","skin-tone-emoji","emoji-version"]}attributeChangedCallback(e,t,n){this._set(e.replace(/-([a-z])/g,((e,t)=>t.toUpperCase())),"emoji-version"===e?parseFloat(n):n)}_set(e,t){this._ctx[e]=t,this._cmp&&this._cmp.$set({[e]:t}),["locale","dataSource"].includes(e)&&this._dbFlush()}_dbCreate(){const{locale:e,dataSource:t,database:n}=this._ctx;n&&n.locale===e&&n.dataSource===t||this._set("database",new Ml({locale:e,dataSource:t}))}_dbFlush(){uh((()=>this._dbCreate()))}}const vh={};for(const e of yh)vh[e]={get(){return"database"===e&&this._dbCreate(),this._ctx[e]},set(t){if("database"===e)throw new Error("database is read-only");this._set(e,t)}};Object.defineProperties(wh.prototype,vh),customElements.get("emoji-picker")||customElements.define("emoji-picker",wh);const kh={}.constructor,Ch="".constructor,Eh=[].constructor;function Th(e){let t=e.length;for(;--t>=0;)e[t]=0}const xh=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Sh=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Ih=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Ah=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Nh=new Array(576);Th(Nh);const Rh=new Array(60);Th(Rh);const Ph=new Array(512);Th(Ph);const Oh=new Array(256);Th(Oh);const Dh=new Array(29);Th(Dh);const Lh=new Array(30);function jh(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}let Mh,Fh,Uh;function zh(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Th(Lh);const Bh=e=>e<256?Ph[e]:Ph[256+(e>>>7)],qh=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Hh=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,qh(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},Wh=(e,t,n)=>{Hh(e,n[2*t],n[2*t+1])},$h=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},Vh=(e,t,n)=>{const i=new Array(16);let r,s,o=0;for(r=1;r<=15;r++)o=o+n[r-1]<<1,i[r]=o;for(s=0;s<=t;s++){let t=e[2*s+1];0!==t&&(e[2*s]=$h(i[t]++,t))}},Kh=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Yh=e=>{e.bi_valid>8?qh(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Gh=(e,t,n,i)=>{const r=2*t,s=2*n;return e[r]<e[s]||e[r]===e[s]&&i[t]<=i[n]},Zh=(e,t,n)=>{const i=e.heap[n];let r=n<<1;for(;r<=e.heap_len&&(r<e.heap_len&&Gh(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!Gh(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i},Qh=(e,t,n)=>{let i,r,s,o,a=0;if(0!==e.sym_next)do{i=255&e.pending_buf[e.sym_buf+a++],i+=(255&e.pending_buf[e.sym_buf+a++])<<8,r=e.pending_buf[e.sym_buf+a++],0===i?Wh(e,r,t):(s=Oh[r],Wh(e,s+256+1,t),o=xh[s],0!==o&&(r-=Dh[s],Hh(e,r,o)),i--,s=Bh(i),Wh(e,s,n),o=Sh[s],0!==o&&(i-=Lh[s],Hh(e,i,o)))}while(a<e.sym_next);Wh(e,256,t)},Jh=(e,t)=>{const n=t.dyn_tree,i=t.stat_desc.static_tree,r=t.stat_desc.has_stree,s=t.stat_desc.elems;let o,a,c,l=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<s;o++)0!==n[2*o]?(e.heap[++e.heap_len]=l=o,e.depth[o]=0):n[2*o+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=l<2?++l:0,n[2*c]=1,e.depth[c]=0,e.opt_len--,r&&(e.static_len-=i[2*c+1]);for(t.max_code=l,o=e.heap_len>>1;o>=1;o--)Zh(e,n,o);c=s;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Zh(e,n,1),a=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=a,n[2*c]=n[2*o]+n[2*a],e.depth[c]=(e.depth[o]>=e.depth[a]?e.depth[o]:e.depth[a])+1,n[2*o+1]=n[2*a+1]=c,e.heap[1]=c++,Zh(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,i=t.max_code,r=t.stat_desc.static_tree,s=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,c=t.stat_desc.max_length;let l,h,d,u,p,f,m=0;for(u=0;u<=15;u++)e.bl_count[u]=0;for(n[2*e.heap[e.heap_max]+1]=0,l=e.heap_max+1;l<573;l++)h=e.heap[l],u=n[2*n[2*h+1]+1]+1,u>c&&(u=c,m++),n[2*h+1]=u,h>i||(e.bl_count[u]++,p=0,h>=a&&(p=o[h-a]),f=n[2*h],e.opt_len+=f*(u+p),s&&(e.static_len+=f*(r[2*h+1]+p)));if(0!==m){do{for(u=c-1;0===e.bl_count[u];)u--;e.bl_count[u]--,e.bl_count[u+1]+=2,e.bl_count[c]--,m-=2}while(m>0);for(u=c;0!==u;u--)for(h=e.bl_count[u];0!==h;)d=e.heap[--l],d>i||(n[2*d+1]!==u&&(e.opt_len+=(u-n[2*d+1])*n[2*d],n[2*d+1]=u),h--)}})(e,t),Vh(n,l,e.bl_count)},Xh=(e,t,n)=>{let i,r,s=-1,o=t[1],a=0,c=7,l=4;for(0===o&&(c=138,l=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)r=o,o=t[2*(i+1)+1],++a<c&&r===o||(a<l?e.bl_tree[2*r]+=a:0!==r?(r!==s&&e.bl_tree[2*r]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,s=r,0===o?(c=138,l=3):r===o?(c=6,l=3):(c=7,l=4))},ed=(e,t,n)=>{let i,r,s=-1,o=t[1],a=0,c=7,l=4;for(0===o&&(c=138,l=3),i=0;i<=n;i++)if(r=o,o=t[2*(i+1)+1],!(++a<c&&r===o)){if(a<l)do{Wh(e,r,e.bl_tree)}while(0!=--a);else 0!==r?(r!==s&&(Wh(e,r,e.bl_tree),a--),Wh(e,16,e.bl_tree),Hh(e,a-3,2)):a<=10?(Wh(e,17,e.bl_tree),Hh(e,a-3,3)):(Wh(e,18,e.bl_tree),Hh(e,a-11,7));a=0,s=r,0===o?(c=138,l=3):r===o?(c=6,l=3):(c=7,l=4)}};let td=!1;const nd=(e,t,n,i)=>{Hh(e,0+(i?1:0),3),Yh(e),qh(e,n),qh(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var id={_tr_init:e=>{td||((()=>{let e,t,n,i,r;const s=new Array(16);for(n=0,i=0;i<28;i++)for(Dh[i]=n,e=0;e<1<<xh[i];e++)Oh[n++]=i;for(Oh[n-1]=i,r=0,i=0;i<16;i++)for(Lh[i]=r,e=0;e<1<<Sh[i];e++)Ph[r++]=i;for(r>>=7;i<30;i++)for(Lh[i]=r<<7,e=0;e<1<<Sh[i]-7;e++)Ph[256+r++]=i;for(t=0;t<=15;t++)s[t]=0;for(e=0;e<=143;)Nh[2*e+1]=8,e++,s[8]++;for(;e<=255;)Nh[2*e+1]=9,e++,s[9]++;for(;e<=279;)Nh[2*e+1]=7,e++,s[7]++;for(;e<=287;)Nh[2*e+1]=8,e++,s[8]++;for(Vh(Nh,287,s),e=0;e<30;e++)Rh[2*e+1]=5,Rh[2*e]=$h(e,5);Mh=new jh(Nh,xh,257,286,15),Fh=new jh(Rh,Sh,0,30,15),Uh=new jh(new Array(0),Ih,0,19,7)})(),td=!0),e.l_desc=new zh(e.dyn_ltree,Mh),e.d_desc=new zh(e.dyn_dtree,Fh),e.bl_desc=new zh(e.bl_tree,Uh),e.bi_buf=0,e.bi_valid=0,Kh(e)},_tr_stored_block:nd,_tr_flush_block:(e,t,n,i)=>{let r,s,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),Jh(e,e.l_desc),Jh(e,e.d_desc),o=(e=>{let t;for(Xh(e,e.dyn_ltree,e.l_desc.max_code),Xh(e,e.dyn_dtree,e.d_desc.max_code),Jh(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Ah[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),r=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=r&&(r=s)):r=s=n+5,n+4<=r&&-1!==t?nd(e,t,n,i):4===e.strategy||s===r?(Hh(e,2+(i?1:0),3),Qh(e,Nh,Rh)):(Hh(e,4+(i?1:0),3),((e,t,n,i)=>{let r;for(Hh(e,t-257,5),Hh(e,n-1,5),Hh(e,i-4,4),r=0;r<i;r++)Hh(e,e.bl_tree[2*Ah[r]+1],3);ed(e,e.dyn_ltree,t-1),ed(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),Qh(e,e.dyn_ltree,e.dyn_dtree)),Kh(e),i&&Yh(e)},_tr_tally:(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(Oh[n]+256+1)]++,e.dyn_dtree[2*Bh(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{Hh(e,2,3),Wh(e,256,Nh),(e=>{16===e.bi_valid?(qh(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},rd=(e,t,n,i)=>{let r=65535&e|0,s=e>>>16&65535|0,o=0;for(;0!==n;){o=n>2e3?2e3:n,n-=o;do{r=r+t[i++]|0,s=s+r|0}while(--o);r%=65521,s%=65521}return r|s<<16|0};const sd=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var od=(e,t,n,i)=>{const r=sd,s=i+n;e^=-1;for(let n=i;n<s;n++)e=e>>>8^r[255&(e^t[n])];return-1^e},ad={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},cd={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:ld,_tr_stored_block:hd,_tr_flush_block:dd,_tr_tally:ud,_tr_align:pd}=id,{Z_NO_FLUSH:fd,Z_PARTIAL_FLUSH:md,Z_FULL_FLUSH:gd,Z_FINISH:_d,Z_BLOCK:yd,Z_OK:bd,Z_STREAM_END:wd,Z_STREAM_ERROR:vd,Z_DATA_ERROR:kd,Z_BUF_ERROR:Cd,Z_DEFAULT_COMPRESSION:Ed,Z_FILTERED:Td,Z_HUFFMAN_ONLY:xd,Z_RLE:Sd,Z_FIXED:Id,Z_DEFAULT_STRATEGY:Ad,Z_UNKNOWN:Nd,Z_DEFLATED:Rd}=cd,Pd=258,Od=262,Dd=42,Ld=113,jd=666,Md=(e,t)=>(e.msg=ad[t],t),Fd=e=>2*e-(e>4?9:0),Ud=e=>{let t=e.length;for(;--t>=0;)e[t]=0},zd=e=>{let t,n,i,r=e.w_size;t=e.hash_size,i=t;do{n=e.head[--i],e.head[i]=n>=r?n-r:0}while(--t);t=r,i=t;do{n=e.prev[--i],e.prev[i]=n>=r?n-r:0}while(--t)};let Bd=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const qd=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},Hd=(e,t)=>{dd(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,qd(e.strm)},Wd=(e,t)=>{e.pending_buf[e.pending++]=t},$d=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Vd=(e,t,n,i)=>{let r=e.avail_in;return r>i&&(r=i),0===r?0:(e.avail_in-=r,t.set(e.input.subarray(e.next_in,e.next_in+r),n),1===e.state.wrap?e.adler=rd(e.adler,t,r,n):2===e.state.wrap&&(e.adler=od(e.adler,t,r,n)),e.next_in+=r,e.total_in+=r,r)},Kd=(e,t)=>{let n,i,r=e.max_chain_length,s=e.strstart,o=e.prev_length,a=e.nice_match;const c=e.strstart>e.w_size-Od?e.strstart-(e.w_size-Od):0,l=e.window,h=e.w_mask,d=e.prev,u=e.strstart+Pd;let p=l[s+o-1],f=l[s+o];e.prev_length>=e.good_match&&(r>>=2),a>e.lookahead&&(a=e.lookahead);do{if(n=t,l[n+o]===f&&l[n+o-1]===p&&l[n]===l[s]&&l[++n]===l[s+1]){s+=2,n++;do{}while(l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&s<u);if(i=Pd-(u-s),s=u-Pd,i>o){if(e.match_start=t,o=i,i>=a)break;p=l[s+o-1],f=l[s+o]}}}while((t=d[t&h])>c&&0!=--r);return o<=e.lookahead?o:e.lookahead},Yd=e=>{const t=e.w_size;let n,i,r;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Od)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),zd(e),i+=t),0===e.strm.avail_in)break;if(n=Vd(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=n,e.lookahead+e.insert>=3)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=Bd(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=Bd(e,e.ins_h,e.window[r+3-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Od&&0!==e.strm.avail_in)},Gd=(e,t)=>{let n,i,r,s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,a=e.strm.avail_in;do{if(n=65535,r=e.bi_valid+42>>3,e.strm.avail_out<r)break;if(r=e.strm.avail_out-r,i=e.strstart-e.block_start,n>i+e.strm.avail_in&&(n=i+e.strm.avail_in),n>r&&(n=r),n<s&&(0===n&&t!==_d||t===fd||n!==i+e.strm.avail_in))break;o=t===_d&&n===i+e.strm.avail_in?1:0,hd(e,0,0,o),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,qd(e.strm),i&&(i>n&&(i=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,n-=i),n&&(Vd(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===o);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==fd&&t!==_d&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(r=e.window_size-e.strstart,e.strm.avail_in>r&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,r+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),r>e.strm.avail_in&&(r=e.strm.avail_in),r&&(Vd(e.strm,e.window,e.strstart,r),e.strstart+=r,e.insert+=r>e.w_size-e.insert?e.w_size-e.insert:r),e.high_water<e.strstart&&(e.high_water=e.strstart),r=e.bi_valid+42>>3,r=e.pending_buf_size-r>65535?65535:e.pending_buf_size-r,s=r>e.w_size?e.w_size:r,i=e.strstart-e.block_start,(i>=s||(i||t===_d)&&t!==fd&&0===e.strm.avail_in&&i<=r)&&(n=i>r?r:i,o=t===_d&&0===e.strm.avail_in&&n===i?1:0,hd(e,e.block_start,n,o),e.block_start+=n,qd(e.strm)),o?3:1)},Zd=(e,t)=>{let n,i;for(;;){if(e.lookahead<Od){if(Yd(e),e.lookahead<Od&&t===fd)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=Bd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-Od&&(e.match_length=Kd(e,n)),e.match_length>=3)if(i=ud(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=Bd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Bd(e,e.ins_h,e.window[e.strstart+1]);else i=ud(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(Hd(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===_d?(Hd(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Hd(e,!1),0===e.strm.avail_out)?1:2},Qd=(e,t)=>{let n,i,r;for(;;){if(e.lookahead<Od){if(Yd(e),e.lookahead<Od&&t===fd)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=Bd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Od&&(e.match_length=Kd(e,n),e.match_length<=5&&(e.strategy===Td||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,i=ud(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=Bd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(Hd(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(i=ud(e,0,e.window[e.strstart-1]),i&&Hd(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=ud(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===_d?(Hd(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Hd(e,!1),0===e.strm.avail_out)?1:2};function Jd(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r}const Xd=[new Jd(0,0,0,0,Gd),new Jd(4,4,8,4,Zd),new Jd(4,5,16,8,Zd),new Jd(4,6,32,32,Zd),new Jd(4,4,16,16,Qd),new Jd(8,16,32,32,Qd),new Jd(8,16,128,128,Qd),new Jd(8,32,128,256,Qd),new Jd(32,128,258,1024,Qd),new Jd(32,258,258,4096,Qd)];function eu(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Rd,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Ud(this.dyn_ltree),Ud(this.dyn_dtree),Ud(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Ud(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Ud(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const tu=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Dd&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==Ld&&t.status!==jd?1:0},nu=e=>{if(tu(e))return Md(e,vd);e.total_in=e.total_out=0,e.data_type=Nd;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Dd:Ld,e.adler=2===t.wrap?0:1,t.last_flush=-2,ld(t),bd},iu=e=>{const t=nu(e);var n;return t===bd&&((n=e.state).window_size=2*n.w_size,Ud(n.head),n.max_lazy_match=Xd[n.level].max_lazy,n.good_match=Xd[n.level].good_length,n.nice_match=Xd[n.level].nice_length,n.max_chain_length=Xd[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),t},ru=(e,t,n,i,r,s)=>{if(!e)return vd;let o=1;if(t===Ed&&(t=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),r<1||r>9||n!==Rd||i<8||i>15||t<0||t>9||s<0||s>Id||8===i&&1!==o)return Md(e,vd);8===i&&(i=9);const a=new eu;return e.state=a,a.strm=e,a.status=Dd,a.wrap=o,a.gzhead=null,a.w_bits=i,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=r+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<r+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=s,a.method=n,iu(e)};var su={deflateInit:(e,t)=>ru(e,t,Rd,15,8,Ad),deflateInit2:ru,deflateReset:iu,deflateResetKeep:nu,deflateSetHeader:(e,t)=>tu(e)||2!==e.state.wrap?vd:(e.state.gzhead=t,bd),deflate:(e,t)=>{if(tu(e)||t>yd||t<0)return e?Md(e,vd):vd;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===jd&&t!==_d)return Md(e,0===e.avail_out?Cd:vd);const i=n.last_flush;if(n.last_flush=t,0!==n.pending){if(qd(e),0===e.avail_out)return n.last_flush=-1,bd}else if(0===e.avail_in&&Fd(t)<=Fd(i)&&t!==_d)return Md(e,Cd);if(n.status===jd&&0!==e.avail_in)return Md(e,Cd);if(n.status===Dd&&0===n.wrap&&(n.status=Ld),n.status===Dd){let t=Rd+(n.w_bits-8<<4)<<8,i=-1;if(i=n.strategy>=xd||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=i<<6,0!==n.strstart&&(t|=32),t+=31-t%31,$d(n,t),0!==n.strstart&&($d(n,e.adler>>>16),$d(n,65535&e.adler)),e.adler=1,n.status=Ld,qd(e),0!==n.pending)return n.last_flush=-1,bd}if(57===n.status)if(e.adler=0,Wd(n,31),Wd(n,139),Wd(n,8),n.gzhead)Wd(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Wd(n,255&n.gzhead.time),Wd(n,n.gzhead.time>>8&255),Wd(n,n.gzhead.time>>16&255),Wd(n,n.gzhead.time>>24&255),Wd(n,9===n.level?2:n.strategy>=xd||n.level<2?4:0),Wd(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Wd(n,255&n.gzhead.extra.length),Wd(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=od(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Wd(n,0),Wd(n,0),Wd(n,0),Wd(n,0),Wd(n,0),Wd(n,9===n.level?2:n.strategy>=xd||n.level<2?4:0),Wd(n,3),n.status=Ld,qd(e),0!==n.pending)return n.last_flush=-1,bd;if(69===n.status){if(n.gzhead.extra){let t=n.pending,i=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+i>n.pending_buf_size;){let r=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=od(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=r,qd(e),0!==n.pending)return n.last_flush=-1,bd;t=0,i-=r}let r=new Uint8Array(n.gzhead.extra);n.pending_buf.set(r.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending+=i,n.gzhead.hcrc&&n.pending>t&&(e.adler=od(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,i=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(e.adler=od(e.adler,n.pending_buf,n.pending-i,i)),qd(e),0!==n.pending)return n.last_flush=-1,bd;i=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Wd(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>i&&(e.adler=od(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,i=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(e.adler=od(e.adler,n.pending_buf,n.pending-i,i)),qd(e),0!==n.pending)return n.last_flush=-1,bd;i=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Wd(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>i&&(e.adler=od(e.adler,n.pending_buf,n.pending-i,i))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(qd(e),0!==n.pending))return n.last_flush=-1,bd;Wd(n,255&e.adler),Wd(n,e.adler>>8&255),e.adler=0}if(n.status=Ld,qd(e),0!==n.pending)return n.last_flush=-1,bd}if(0!==e.avail_in||0!==n.lookahead||t!==fd&&n.status!==jd){let i=0===n.level?Gd(n,t):n.strategy===xd?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(Yd(e),0===e.lookahead)){if(t===fd)return 1;break}if(e.match_length=0,n=ud(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(Hd(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===_d?(Hd(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Hd(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===Sd?((e,t)=>{let n,i,r,s;const o=e.window;for(;;){if(e.lookahead<=Pd){if(Yd(e),e.lookahead<=Pd&&t===fd)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=e.strstart-1,i=o[r],i===o[++r]&&i===o[++r]&&i===o[++r])){s=e.strstart+Pd;do{}while(i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&r<s);e.match_length=Pd-(s-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=ud(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=ud(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(Hd(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===_d?(Hd(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Hd(e,!1),0===e.strm.avail_out)?1:2})(n,t):Xd[n.level].func(n,t);if(3!==i&&4!==i||(n.status=jd),1===i||3===i)return 0===e.avail_out&&(n.last_flush=-1),bd;if(2===i&&(t===md?pd(n):t!==yd&&(hd(n,0,0,!1),t===gd&&(Ud(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),qd(e),0===e.avail_out))return n.last_flush=-1,bd}return t!==_d?bd:n.wrap<=0?wd:(2===n.wrap?(Wd(n,255&e.adler),Wd(n,e.adler>>8&255),Wd(n,e.adler>>16&255),Wd(n,e.adler>>24&255),Wd(n,255&e.total_in),Wd(n,e.total_in>>8&255),Wd(n,e.total_in>>16&255),Wd(n,e.total_in>>24&255)):($d(n,e.adler>>>16),$d(n,65535&e.adler)),qd(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?bd:wd)},deflateEnd:e=>{if(tu(e))return vd;const t=e.state.status;return e.state=null,t===Ld?Md(e,kd):bd},deflateSetDictionary:(e,t)=>{let n=t.length;if(tu(e))return vd;const i=e.state,r=i.wrap;if(2===r||1===r&&i.status!==Dd||i.lookahead)return vd;if(1===r&&(e.adler=rd(e.adler,t,n,0)),i.wrap=0,n>=i.w_size){0===r&&(Ud(i.head),i.strstart=0,i.block_start=0,i.insert=0);let e=new Uint8Array(i.w_size);e.set(t.subarray(n-i.w_size,n),0),t=e,n=i.w_size}const s=e.avail_in,o=e.next_in,a=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Yd(i);i.lookahead>=3;){let e=i.strstart,t=i.lookahead-2;do{i.ins_h=Bd(i,i.ins_h,i.window[e+3-1]),i.prev[e&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=e,e++}while(--t);i.strstart=e,i.lookahead=2,Yd(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=o,e.input=a,e.avail_in=s,i.wrap=r,bd},deflateInfo:"pako deflate (from Nodeca project)"};const ou=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var au={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)ou(n,t)&&(e[t]=n[t])}}return e},flattenChunks:e=>{let t=0;for(let n=0,i=e.length;n<i;n++)t+=e[n].length;const n=new Uint8Array(t);for(let t=0,i=0,r=e.length;t<r;t++){let r=e[t];n.set(r,i),i+=r.length}return n}};let cu=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){cu=!1}const lu=new Uint8Array(256);for(let e=0;e<256;e++)lu[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;lu[254]=lu[254]=1;var hu={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,i,r,s,o=e.length,a=0;for(r=0;r<o;r++)n=e.charCodeAt(r),55296==(64512&n)&&r+1<o&&(i=e.charCodeAt(r+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),r++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(a),s=0,r=0;s<a;r++)n=e.charCodeAt(r),55296==(64512&n)&&r+1<o&&(i=e.charCodeAt(r+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),r++)),n<128?t[s++]=n:n<2048?(t[s++]=192|n>>>6,t[s++]=128|63&n):n<65536?(t[s++]=224|n>>>12,t[s++]=128|n>>>6&63,t[s++]=128|63&n):(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63,t[s++]=128|n>>>6&63,t[s++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let i,r;const s=new Array(2*n);for(r=0,i=0;i<n;){let t=e[i++];if(t<128){s[r++]=t;continue}let o=lu[t];if(o>4)s[r++]=65533,i+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&i<n;)t=t<<6|63&e[i++],o--;o>1?s[r++]=65533:t<65536?s[r++]=t:(t-=65536,s[r++]=55296|t>>10&1023,s[r++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&cu)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let i=0;i<t;i++)n+=String.fromCharCode(e[i]);return n})(s,r)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+lu[e[n]]>t?n:t}},du=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const uu=Object.prototype.toString,{Z_NO_FLUSH:pu,Z_SYNC_FLUSH:fu,Z_FULL_FLUSH:mu,Z_FINISH:gu,Z_OK:_u,Z_STREAM_END:yu,Z_DEFAULT_COMPRESSION:bu,Z_DEFAULT_STRATEGY:wu,Z_DEFLATED:vu}=cd;function ku(e){this.options=au.assign({level:bu,method:vu,chunkSize:16384,windowBits:15,memLevel:8,strategy:wu},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new du,this.strm.avail_out=0;let n=su.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==_u)throw new Error(ad[n]);if(t.header&&su.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?hu.string2buf(t.dictionary):"[object ArrayBuffer]"===uu.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=su.deflateSetDictionary(this.strm,e),n!==_u)throw new Error(ad[n]);this._dict_set=!0}}function Cu(e,t){const n=new ku(t);if(n.push(e,!0),n.err)throw n.msg||ad[n.err];return n.result}ku.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize;let r,s;if(this.ended)return!1;for(s=t===~~t?t:!0===t?gu:pu,"string"==typeof e?n.input=hu.string2buf(e):"[object ArrayBuffer]"===uu.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(s===fu||s===mu)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(r=su.deflate(n,s),r===yu)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),r=su.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===_u;if(0!==n.avail_out){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},ku.prototype.onData=function(e){this.chunks.push(e)},ku.prototype.onEnd=function(e){e===_u&&(this.result=au.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Eu={Deflate:ku,deflate:Cu,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Cu(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Cu(e,t)},constants:cd};const Tu=16209;var xu=function(e,t){let n,i,r,s,o,a,c,l,h,d,u,p,f,m,g,_,y,b,w,v,k,C,E,T;const x=e.state;n=e.next_in,E=e.input,i=n+(e.avail_in-5),r=e.next_out,T=e.output,s=r-(t-e.avail_out),o=r+(e.avail_out-257),a=x.dmax,c=x.wsize,l=x.whave,h=x.wnext,d=x.window,u=x.hold,p=x.bits,f=x.lencode,m=x.distcode,g=(1<<x.lenbits)-1,_=(1<<x.distbits)-1;e:do{p<15&&(u+=E[n++]<<p,p+=8,u+=E[n++]<<p,p+=8),y=f[u&g];t:for(;;){if(b=y>>>24,u>>>=b,p-=b,b=y>>>16&255,0===b)T[r++]=65535&y;else{if(!(16&b)){if(0==(64&b)){y=f[(65535&y)+(u&(1<<b)-1)];continue t}if(32&b){x.mode=16191;break e}e.msg="invalid literal/length code",x.mode=Tu;break e}w=65535&y,b&=15,b&&(p<b&&(u+=E[n++]<<p,p+=8),w+=u&(1<<b)-1,u>>>=b,p-=b),p<15&&(u+=E[n++]<<p,p+=8,u+=E[n++]<<p,p+=8),y=m[u&_];n:for(;;){if(b=y>>>24,u>>>=b,p-=b,b=y>>>16&255,!(16&b)){if(0==(64&b)){y=m[(65535&y)+(u&(1<<b)-1)];continue n}e.msg="invalid distance code",x.mode=Tu;break e}if(v=65535&y,b&=15,p<b&&(u+=E[n++]<<p,p+=8,p<b&&(u+=E[n++]<<p,p+=8)),v+=u&(1<<b)-1,v>a){e.msg="invalid distance too far back",x.mode=Tu;break e}if(u>>>=b,p-=b,b=r-s,v>b){if(b=v-b,b>l&&x.sane){e.msg="invalid distance too far back",x.mode=Tu;break e}if(k=0,C=d,0===h){if(k+=c-b,b<w){w-=b;do{T[r++]=d[k++]}while(--b);k=r-v,C=T}}else if(h<b){if(k+=c+h-b,b-=h,b<w){w-=b;do{T[r++]=d[k++]}while(--b);if(k=0,h<w){b=h,w-=b;do{T[r++]=d[k++]}while(--b);k=r-v,C=T}}}else if(k+=h-b,b<w){w-=b;do{T[r++]=d[k++]}while(--b);k=r-v,C=T}for(;w>2;)T[r++]=C[k++],T[r++]=C[k++],T[r++]=C[k++],w-=3;w&&(T[r++]=C[k++],w>1&&(T[r++]=C[k++]))}else{k=r-v;do{T[r++]=T[k++],T[r++]=T[k++],T[r++]=T[k++],w-=3}while(w>2);w&&(T[r++]=T[k++],w>1&&(T[r++]=T[k++]))}break}}break}}while(n<i&&r<o);w=p>>3,n-=w,p-=w<<3,u&=(1<<p)-1,e.next_in=n,e.next_out=r,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=r<o?o-r+257:257-(r-o),x.hold=u,x.bits=p};const Su=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Iu=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Au=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Nu=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Ru=(e,t,n,i,r,s,o,a)=>{const c=a.bits;let l,h,d,u,p,f,m=0,g=0,_=0,y=0,b=0,w=0,v=0,k=0,C=0,E=0,T=null;const x=new Uint16Array(16),S=new Uint16Array(16);let I,A,N,R=null;for(m=0;m<=15;m++)x[m]=0;for(g=0;g<i;g++)x[t[n+g]]++;for(b=c,y=15;y>=1&&0===x[y];y--);if(b>y&&(b=y),0===y)return r[s++]=20971520,r[s++]=20971520,a.bits=1,0;for(_=1;_<y&&0===x[_];_++);for(b<_&&(b=_),k=1,m=1;m<=15;m++)if(k<<=1,k-=x[m],k<0)return-1;if(k>0&&(0===e||1!==y))return-1;for(S[1]=0,m=1;m<15;m++)S[m+1]=S[m]+x[m];for(g=0;g<i;g++)0!==t[n+g]&&(o[S[t[n+g]]++]=g);if(0===e?(T=R=o,f=20):1===e?(T=Su,R=Iu,f=257):(T=Au,R=Nu,f=0),E=0,g=0,m=_,p=s,w=b,v=0,d=-1,C=1<<b,u=C-1,1===e&&C>852||2===e&&C>592)return 1;for(;;){I=m-v,o[g]+1<f?(A=0,N=o[g]):o[g]>=f?(A=R[o[g]-f],N=T[o[g]-f]):(A=96,N=0),l=1<<m-v,h=1<<w,_=h;do{h-=l,r[p+(E>>v)+h]=I<<24|A<<16|N|0}while(0!==h);for(l=1<<m-1;E&l;)l>>=1;if(0!==l?(E&=l-1,E+=l):E=0,g++,0==--x[m]){if(m===y)break;m=t[n+o[g]]}if(m>b&&(E&u)!==d){for(0===v&&(v=b),p+=_,w=m-v,k=1<<w;w+v<y&&(k-=x[w+v],!(k<=0));)w++,k<<=1;if(C+=1<<w,1===e&&C>852||2===e&&C>592)return 1;d=E&u,r[d]=b<<24|w<<16|p-s|0}}return 0!==E&&(r[p+E]=m-v<<24|64<<16|0),a.bits=b,0};const{Z_FINISH:Pu,Z_BLOCK:Ou,Z_TREES:Du,Z_OK:Lu,Z_STREAM_END:ju,Z_NEED_DICT:Mu,Z_STREAM_ERROR:Fu,Z_DATA_ERROR:Uu,Z_MEM_ERROR:zu,Z_BUF_ERROR:Bu,Z_DEFLATED:qu}=cd,Hu=16180,Wu=16190,$u=16191,Vu=16192,Ku=16194,Yu=16199,Gu=16200,Zu=16206,Qu=16209,Ju=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Xu(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const ep=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Hu||t.mode>16211?1:0},tp=e=>{if(ep(e))return Fu;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Hu,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Lu},np=e=>{if(ep(e))return Fu;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,tp(e)},ip=(e,t)=>{let n;if(ep(e))return Fu;const i=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Fu:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,np(e))},rp=(e,t)=>{if(!e)return Fu;const n=new Xu;e.state=n,n.strm=e,n.window=null,n.mode=Hu;const i=ip(e,t);return i!==Lu&&(e.state=null),i};let sp,op,ap=!0;const cp=e=>{if(ap){sp=new Int32Array(512),op=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Ru(1,e.lens,0,288,sp,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Ru(2,e.lens,0,32,op,0,e.work,{bits:5}),ap=!1}e.lencode=sp,e.lenbits=9,e.distcode=op,e.distbits=5},lp=(e,t,n,i)=>{let r;const s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),i>=s.wsize?(s.window.set(t.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(r=s.wsize-s.wnext,r>i&&(r=i),s.window.set(t.subarray(n-i,n-i+r),s.wnext),(i-=r)?(s.window.set(t.subarray(n-i,n),0),s.wnext=i,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0};var hp={inflateReset:np,inflateReset2:ip,inflateResetKeep:tp,inflateInit:e=>rp(e,15),inflateInit2:rp,inflate:(e,t)=>{let n,i,r,s,o,a,c,l,h,d,u,p,f,m,g,_,y,b,w,v,k,C,E=0;const T=new Uint8Array(4);let x,S;const I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ep(e)||!e.output||!e.input&&0!==e.avail_in)return Fu;n=e.state,n.mode===$u&&(n.mode=Vu),o=e.next_out,r=e.output,c=e.avail_out,s=e.next_in,i=e.input,a=e.avail_in,l=n.hold,h=n.bits,d=a,u=c,C=Lu;e:for(;;)switch(n.mode){case Hu:if(0===n.wrap){n.mode=Vu;break}for(;h<16;){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}if(2&n.wrap&&35615===l){0===n.wbits&&(n.wbits=15),n.check=0,T[0]=255&l,T[1]=l>>>8&255,n.check=od(n.check,T,2,0),l=0,h=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",n.mode=Qu;break}if((15&l)!==qu){e.msg="unknown compression method",n.mode=Qu;break}if(l>>>=4,h-=4,k=8+(15&l),0===n.wbits&&(n.wbits=k),k>15||k>n.wbits){e.msg="invalid window size",n.mode=Qu;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&l?16189:$u,l=0,h=0;break;case 16181:for(;h<16;){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}if(n.flags=l,(255&n.flags)!==qu){e.msg="unknown compression method",n.mode=Qu;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Qu;break}n.head&&(n.head.text=l>>8&1),512&n.flags&&4&n.wrap&&(T[0]=255&l,T[1]=l>>>8&255,n.check=od(n.check,T,2,0)),l=0,h=0,n.mode=16182;case 16182:for(;h<32;){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}n.head&&(n.head.time=l),512&n.flags&&4&n.wrap&&(T[0]=255&l,T[1]=l>>>8&255,T[2]=l>>>16&255,T[3]=l>>>24&255,n.check=od(n.check,T,4,0)),l=0,h=0,n.mode=16183;case 16183:for(;h<16;){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&n.flags&&4&n.wrap&&(T[0]=255&l,T[1]=l>>>8&255,n.check=od(n.check,T,2,0)),l=0,h=0,n.mode=16184;case 16184:if(1024&n.flags){for(;h<16;){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}n.length=l,n.head&&(n.head.extra_len=l),512&n.flags&&4&n.wrap&&(T[0]=255&l,T[1]=l>>>8&255,n.check=od(n.check,T,2,0)),l=0,h=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(p=n.length,p>a&&(p=a),p&&(n.head&&(k=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(s,s+p),k)),512&n.flags&&4&n.wrap&&(n.check=od(n.check,i,p,s)),a-=p,s+=p,n.length-=p),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===a)break e;p=0;do{k=i[s+p++],n.head&&k&&n.length<65536&&(n.head.name+=String.fromCharCode(k))}while(k&&p<a);if(512&n.flags&&4&n.wrap&&(n.check=od(n.check,i,p,s)),a-=p,s+=p,k)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===a)break e;p=0;do{k=i[s+p++],n.head&&k&&n.length<65536&&(n.head.comment+=String.fromCharCode(k))}while(k&&p<a);if(512&n.flags&&4&n.wrap&&(n.check=od(n.check,i,p,s)),a-=p,s+=p,k)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;h<16;){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}if(4&n.wrap&&l!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Qu;break}l=0,h=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=$u;break;case 16189:for(;h<32;){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}e.adler=n.check=Ju(l),l=0,h=0,n.mode=Wu;case Wu:if(0===n.havedict)return e.next_out=o,e.avail_out=c,e.next_in=s,e.avail_in=a,n.hold=l,n.bits=h,Mu;e.adler=n.check=1,n.mode=$u;case $u:if(t===Ou||t===Du)break e;case Vu:if(n.last){l>>>=7&h,h-=7&h,n.mode=Zu;break}for(;h<3;){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}switch(n.last=1&l,l>>>=1,h-=1,3&l){case 0:n.mode=16193;break;case 1:if(cp(n),n.mode=Yu,t===Du){l>>>=2,h-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Qu}l>>>=2,h-=2;break;case 16193:for(l>>>=7&h,h-=7&h;h<32;){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Qu;break}if(n.length=65535&l,l=0,h=0,n.mode=Ku,t===Du)break e;case Ku:n.mode=16195;case 16195:if(p=n.length,p){if(p>a&&(p=a),p>c&&(p=c),0===p)break e;r.set(i.subarray(s,s+p),o),a-=p,s+=p,c-=p,o+=p,n.length-=p;break}n.mode=$u;break;case 16196:for(;h<14;){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}if(n.nlen=257+(31&l),l>>>=5,h-=5,n.ndist=1+(31&l),l>>>=5,h-=5,n.ncode=4+(15&l),l>>>=4,h-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Qu;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;h<3;){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}n.lens[I[n.have++]]=7&l,l>>>=3,h-=3}for(;n.have<19;)n.lens[I[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,x={bits:n.lenbits},C=Ru(0,n.lens,0,19,n.lencode,0,n.work,x),n.lenbits=x.bits,C){e.msg="invalid code lengths set",n.mode=Qu;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;E=n.lencode[l&(1<<n.lenbits)-1],g=E>>>24,_=E>>>16&255,y=65535&E,!(g<=h);){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}if(y<16)l>>>=g,h-=g,n.lens[n.have++]=y;else{if(16===y){for(S=g+2;h<S;){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}if(l>>>=g,h-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=Qu;break}k=n.lens[n.have-1],p=3+(3&l),l>>>=2,h-=2}else if(17===y){for(S=g+3;h<S;){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}l>>>=g,h-=g,k=0,p=3+(7&l),l>>>=3,h-=3}else{for(S=g+7;h<S;){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}l>>>=g,h-=g,k=0,p=11+(127&l),l>>>=7,h-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Qu;break}for(;p--;)n.lens[n.have++]=k}}if(n.mode===Qu)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Qu;break}if(n.lenbits=9,x={bits:n.lenbits},C=Ru(1,n.lens,0,n.nlen,n.lencode,0,n.work,x),n.lenbits=x.bits,C){e.msg="invalid literal/lengths set",n.mode=Qu;break}if(n.distbits=6,n.distcode=n.distdyn,x={bits:n.distbits},C=Ru(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,x),n.distbits=x.bits,C){e.msg="invalid distances set",n.mode=Qu;break}if(n.mode=Yu,t===Du)break e;case Yu:n.mode=Gu;case Gu:if(a>=6&&c>=258){e.next_out=o,e.avail_out=c,e.next_in=s,e.avail_in=a,n.hold=l,n.bits=h,xu(e,u),o=e.next_out,r=e.output,c=e.avail_out,s=e.next_in,i=e.input,a=e.avail_in,l=n.hold,h=n.bits,n.mode===$u&&(n.back=-1);break}for(n.back=0;E=n.lencode[l&(1<<n.lenbits)-1],g=E>>>24,_=E>>>16&255,y=65535&E,!(g<=h);){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}if(_&&0==(240&_)){for(b=g,w=_,v=y;E=n.lencode[v+((l&(1<<b+w)-1)>>b)],g=E>>>24,_=E>>>16&255,y=65535&E,!(b+g<=h);){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}l>>>=b,h-=b,n.back+=b}if(l>>>=g,h-=g,n.back+=g,n.length=y,0===_){n.mode=16205;break}if(32&_){n.back=-1,n.mode=$u;break}if(64&_){e.msg="invalid literal/length code",n.mode=Qu;break}n.extra=15&_,n.mode=16201;case 16201:if(n.extra){for(S=n.extra;h<S;){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,h-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;E=n.distcode[l&(1<<n.distbits)-1],g=E>>>24,_=E>>>16&255,y=65535&E,!(g<=h);){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}if(0==(240&_)){for(b=g,w=_,v=y;E=n.distcode[v+((l&(1<<b+w)-1)>>b)],g=E>>>24,_=E>>>16&255,y=65535&E,!(b+g<=h);){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}l>>>=b,h-=b,n.back+=b}if(l>>>=g,h-=g,n.back+=g,64&_){e.msg="invalid distance code",n.mode=Qu;break}n.offset=y,n.extra=15&_,n.mode=16203;case 16203:if(n.extra){for(S=n.extra;h<S;){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,h-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Qu;break}n.mode=16204;case 16204:if(0===c)break e;if(p=u-c,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Qu;break}p>n.wnext?(p-=n.wnext,f=n.wsize-p):f=n.wnext-p,p>n.length&&(p=n.length),m=n.window}else m=r,f=o-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do{r[o++]=m[f++]}while(--p);0===n.length&&(n.mode=Gu);break;case 16205:if(0===c)break e;r[o++]=n.length,c--,n.mode=Gu;break;case Zu:if(n.wrap){for(;h<32;){if(0===a)break e;a--,l|=i[s++]<<h,h+=8}if(u-=c,e.total_out+=u,n.total+=u,4&n.wrap&&u&&(e.adler=n.check=n.flags?od(n.check,r,u,o-u):rd(n.check,r,u,o-u)),u=c,4&n.wrap&&(n.flags?l:Ju(l))!==n.check){e.msg="incorrect data check",n.mode=Qu;break}l=0,h=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;h<32;){if(0===a)break e;a--,l+=i[s++]<<h,h+=8}if(4&n.wrap&&l!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Qu;break}l=0,h=0}n.mode=16208;case 16208:C=ju;break e;case Qu:C=Uu;break e;case 16210:return zu;default:return Fu}return e.next_out=o,e.avail_out=c,e.next_in=s,e.avail_in=a,n.hold=l,n.bits=h,(n.wsize||u!==e.avail_out&&n.mode<Qu&&(n.mode<Zu||t!==Pu))&&lp(e,e.output,e.next_out,u-e.avail_out),d-=e.avail_in,u-=e.avail_out,e.total_in+=d,e.total_out+=u,n.total+=u,4&n.wrap&&u&&(e.adler=n.check=n.flags?od(n.check,r,u,e.next_out-u):rd(n.check,r,u,e.next_out-u)),e.data_type=n.bits+(n.last?64:0)+(n.mode===$u?128:0)+(n.mode===Yu||n.mode===Ku?256:0),(0===d&&0===u||t===Pu)&&C===Lu&&(C=Bu),C},inflateEnd:e=>{if(ep(e))return Fu;let t=e.state;return t.window&&(t.window=null),e.state=null,Lu},inflateGetHeader:(e,t)=>{if(ep(e))return Fu;const n=e.state;return 0==(2&n.wrap)?Fu:(n.head=t,t.done=!1,Lu)},inflateSetDictionary:(e,t)=>{const n=t.length;let i,r,s;return ep(e)?Fu:(i=e.state,0!==i.wrap&&i.mode!==Wu?Fu:i.mode===Wu&&(r=1,r=rd(r,t,n,0),r!==i.check)?Uu:(s=lp(e,t,n,n),s?(i.mode=16210,zu):(i.havedict=1,Lu)))},inflateInfo:"pako inflate (from Nodeca project)"},dp=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const up=Object.prototype.toString,{Z_NO_FLUSH:pp,Z_FINISH:fp,Z_OK:mp,Z_STREAM_END:gp,Z_NEED_DICT:_p,Z_STREAM_ERROR:yp,Z_DATA_ERROR:bp,Z_MEM_ERROR:wp}=cd;function vp(e){this.options=au.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new du,this.strm.avail_out=0;let n=hp.inflateInit2(this.strm,t.windowBits);if(n!==mp)throw new Error(ad[n]);if(this.header=new dp,hp.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=hu.string2buf(t.dictionary):"[object ArrayBuffer]"===up.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=hp.inflateSetDictionary(this.strm,t.dictionary),n!==mp)))throw new Error(ad[n])}function kp(e,t){const n=new vp(t);if(n.push(e),n.err)throw n.msg||ad[n.err];return n.result}vp.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(o=t===~~t?t:!0===t?fp:pp,"[object ArrayBuffer]"===up.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),s=hp.inflate(n,o),s===_p&&r&&(s=hp.inflateSetDictionary(n,r),s===mp?s=hp.inflate(n,o):s===bp&&(s=_p));n.avail_in>0&&s===gp&&n.state.wrap>0&&0!==e[n.next_in];)hp.inflateReset(n),s=hp.inflate(n,o);switch(s){case yp:case bp:case _p:case wp:return this.onEnd(s),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(0===n.avail_out||s===gp))if("string"===this.options.to){let e=hu.utf8border(n.output,n.next_out),t=n.next_out-e,r=hu.buf2string(n.output,e);n.next_out=t,n.avail_out=i-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(r)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==mp||0!==a){if(s===gp)return s=hp.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},vp.prototype.onData=function(e){this.chunks.push(e)},vp.prototype.onEnd=function(e){e===mp&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=au.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Cp={Inflate:vp,inflate:kp,inflateRaw:function(e,t){return(t=t||{}).raw=!0,kp(e,t)},ungzip:kp,constants:cd};const{Deflate:Ep,deflate:Tp,deflateRaw:xp,gzip:Sp}=Eu,{Inflate:Ip,inflate:Ap,inflateRaw:Np,ungzip:Rp}=Cp;var Pp=Tp,Op=Ap;const Dp={encode:e=>{const t=Array.from(e).map((e=>e.codePointAt(0)||0)),n=[];for(const e of t)e<=127?n.push(e):e<=2047?(n.push(e>>6|192),n.push(63&e|128)):e<=65535?(n.push(e>>12|224),n.push(e>>6&63|128),n.push(63&e|128)):e<=1114111&&(n.push(e>>18|240),n.push(e>>12&63|128),n.push(e>>6&63|128),n.push(63&e|128));return Uint8Array.from(n).buffer},decode:e=>{const t=new Uint8Array(e);let n="",i=0;for(;i<t.length;){const e=t[i];if(0==(128&e))n+=String.fromCharCode(e),i+=1;else if(192==(224&e)){const r=t[i+1];n+=String.fromCharCode((31&e)<<6|63&r),i+=2}else if(224==(240&e)){const r=t[i+1],s=t[i+2];n+=String.fromCharCode((15&e)<<12|(63&r)<<6|63&s),i+=3}else if(240==(248&e)){const r=(7&e)<<18|(63&t[i+1])<<12|(63&t[i+2])<<6|63&t[i+3];n+=r<=1114111?String.fromCodePoint(r):"",i+=4}else n+="",i+=1}return n}},Lp=Dp;var jp,Mp,Fp=function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},Up=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};jp=new WeakMap,Mp=new WeakMap;const zp=class{constructor(e){jp.set(this,void 0),Mp.set(this,0),ArrayBuffer.isView(e)?Fp(this,jp,e.buffer,"f"):Fp(this,jp,new DataView(e,0,0).buffer,"f")}read(){var e,t;return new Uint8Array(Up(this,jp,"f"))[(Fp(this,Mp,(t=Up(this,Mp,"f"),e=t++,t),"f"),e)]}readNBytes(e){const t=Up(this,jp,"f"),n=t.byteLength,i=Up(this,Mp,"f");if(i>=n)return new ArrayBuffer(0);const r=Fp(this,Mp,Up(this,Mp,"f")+e,"f");return r>n?t.slice(i,n):t.slice(i,r)}};var Bp,qp=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Bp=new WeakMap;const Hp=class{constructor(){Bp.set(this,[])}write(e){const t=qp(this,Bp,"f");switch(typeof e){case"number":t.push(e);break;case"object":Array.isArray(e)?t.push(Uint8Array.from(e).buffer):ArrayBuffer.isView(e)?t.push(e.buffer):t.push(new DataView(e,0,0).buffer);break;default:throw new Error("Invalid value: "+e)}}toArrayBuffer(e){const t=qp(this,Bp,"f");if((e||(e=0))<=0)for(const n of t)e+="number"==typeof n?1:n.byteLength;const n=new Uint8Array(new ArrayBuffer(e),0,e);e=0;for(const i of t){if("number"==typeof i){n[e++]=i;continue}const t=i.byteLength;n.set(new Uint8Array(i,0,t),e),e+=t}return n.buffer}};function Wp(e){try{return new DataView(e,0,0),!0}catch(e){return!1}}function $p(e){const t=e.buffer,n=e.byteOffset,i=e.byteLength;return 0===n&&i===t.byteLength?t:t.slice(n,n+i)}function Vp(e,t){const n=Lp.encode(t),i=new DataView(new ArrayBuffer(4),0,4);i.setUint32(0,n.byteLength,!0),e.write(i),e.write(n)}function Kp(e,t){const n=new DataView(new ArrayBuffer(5),0,5);n.setUint8(0,102),n.setUint32(1,t.byteLength,!0),e.write(n),e.write(t)}function Yp(e,t){switch(typeof t){case"string":e.write(101),Vp(e,t);break;case"boolean":e.write([10,t?1:0]);break;case"undefined":e.write(0);break;case"number":{if(Number.isSafeInteger(t))if(t>=0){if(t<=255){const n=new DataView(new ArrayBuffer(2),0,2);return n.setUint8(0,10),n.setUint8(1,t),void e.write(n)}if(t<=65535){const n=new DataView(new ArrayBuffer(3),0,3);return n.setUint8(0,11),n.setUint16(1,t,!0),void e.write(n)}if(t<=4294967295){const n=new DataView(new ArrayBuffer(5),0,5);return n.setUint8(0,12),n.setUint32(1,t,!0),void e.write(n)}}else{if(t>=-128&&t<128){const n=new DataView(new ArrayBuffer(2),0,2);return n.setUint8(0,20),n.setInt8(1,t),void e.write(n)}if(t>=-32768&&t<32768){const n=new DataView(new ArrayBuffer(3),0,3);return n.setUint8(0,21),n.setInt16(1,t,!0),void e.write(n)}if(t>=-2147483648&&t<2147483648){const n=new DataView(new ArrayBuffer(5),0,5);return n.setUint8(0,22),n.setInt32(1,t,!0),void e.write(n)}}const n=new DataView(new ArrayBuffer(9),0,9);n.setUint8(0,33),n.setFloat64(1,t,!0),e.write(n)}break;case"bigint":{const n=new DataView(new ArrayBuffer(9),0,9);t>=0n?(n.setUint8(0,13),n.setBigUint64(1,t,!0)):(n.setUint8(0,23),n.setBigUint64(1,t,!0)),e.write(n)}break;case"object":null===t?e.write(255):Array.isArray(t)?function(e,t){const n=new DataView(new ArrayBuffer(5),0,5);n.setUint8(0,99),n.setUint32(1,t.length,!0),e.write(n);for(const n of t)Yp(e,n)}(e,t):Wp(t)?Kp(e,t):ArrayBuffer.isView(t)?Kp(e,$p(t)):function(e,t){if("function"==typeof t.toJSON)return void Yp(e,t.toJSON());const n=Object.keys(t);{const t=new DataView(new ArrayBuffer(5),0,5);t.setUint8(0,100),t.setUint32(1,n.length,!0),e.write(t)}for(const i of n){const n=t[i];switch(typeof n){case"boolean":case"bigint":case"number":case"object":case"string":case"undefined":Vp(e,i),Yp(e,n)}}}(e,t)}}function Gp(e,t){if("object"!=typeof e||null==e)throw new Error("Data must be a non-null object or array.");if("object"!=typeof(t||(t={})))throw new Error("The options parameter must be an object.");{const t=new Hp;Yp(t,e),e=t.toArrayBuffer()}const n=t.compressMethod||0,i=t.compressLevel||5;switch(n){case 0:break;case 1:e=Pp(e,{raw:!0,level:i,memLevel:9,chunkSize:8192,windowBits:15});break;case 3:e=Pp(e,{gzip:!0,level:i,memLevel:9,chunkSize:8192,windowBits:15});break;case 2:case 4:case 5:case 6:throw new Error("Not implemented");default:throw new Error("Unknown compress method: "+n)}const r=new Uint8Array(new ArrayBuffer(e.byteLength+7));return r[0]=128,r[1]=99,r[2]=98,r[3]=106,r[4]=102,r[5]=1,r[6]=n,r.set(new Uint8Array(e),7),r.buffer}function Zp(e){const t=e.read();switch(t){case 0:return;case 255:return null;case 10:return e.read();case 11:return new DataView(e.readNBytes(2),0,2).getUint16(0,!0);case 12:return new DataView(e.readNBytes(4),0,4).getUint32(0,!0);case 13:return new DataView(e.readNBytes(8),0,8).getBigUint64(0,!0);case 20:return e.read()<<8>>8;case 21:return new DataView(e.readNBytes(2),0,2).getInt16(0,!0);case 22:return new DataView(e.readNBytes(4),0,4).getInt32(0,!0);case 23:return new DataView(e.readNBytes(8),0,8).getBigInt64(0,!0);case 32:return new DataView(e.readNBytes(4),0,4).getFloat32(0,!0);case 33:return new DataView(e.readNBytes(8),0,8).getFloat64(0,!0);case 99:return function(e){const t=new DataView(e.readNBytes(4),0,4).getUint32(0,!0),n=new Array(t);for(let i=0;i<t;i++)n[i]=Zp(e);return n}(e);case 100:return function(e){const t=new DataView(e.readNBytes(4),0,4).getUint32(0,!0),n=Object.create(null);for(let i=0;i<t;i++)n[Lp.decode(e.readNBytes(new DataView(e.readNBytes(4),0,4).getUint32(0,!0)))]=Zp(e);return n}(e);case 101:return Lp.decode(e.readNBytes(new DataView(e.readNBytes(4),0,4).getUint32(0,!0)));case 102:return e.readNBytes(new DataView(e.readNBytes(4),0,4).getUint32(0,!0));default:throw new Error("Parse Error: Invalid data ID: "+t)}}function Qp(e,t){if("object"!=typeof(t||{}))throw new Error("The options parameter must be an object.");if(ArrayBuffer.isView(e)&&(e=$p(e)),!Wp(e))throw new Error("The data parameter must be an ArrayBuffer.");{const t=new Uint8Array(e,0,e.byteLength);if(128!==t[0]||99!==t[1]||98!==t[2]||106!==t[3]||102!==t[4]||1!==t[5])throw new Error("Parse Error: Input data is not valid.");switch(t[6]){case 0:e=e.slice(7);break;case 1:e=Op(e.slice(7),{raw:!0,chunkSize:8192,windowBits:15}).buffer;break;case 3:e=Op(e.slice(7),{chunkSize:8192,windowBits:15}).buffer;break;case 2:case 4:case 5:case 6:throw new Error("Not implemented");default:throw new Error("Parse Error: Unknown compress method.")}}return Zp(new zp(e))}Object.seal(Object.setPrototypeOf(n,null)),Object.freeze(Gp);const Jp=Object.freeze(Qp),Xp=Jp(Vc.decode("gGNiamYBAYVUbW/jRBAuSCAUgQCBEB+3PiEhcY7jpO21dtKqtJVAuoPqLnCgEzqt12N74/Wus7uOk/4X/iK/gdl1eneg4/gQ7c7LM3l2nhnnXx0cHIzw1zxqxdH6SCidv793sdWj47Zk9RrgAs2VuetPznZ5p7KiXJcnR9PjzbRr1ez4jm6KFS1EwYo66ytdr4sVyDjLdmvDasPjFprMVeTbaT1tmxNRw6dojjuZccUs75oxU82H6Go1FHwLH+G1srY1SRQ5Oi8pfI7HN+x5xS08a3kOepzDxscy+MshleGWK5loENTyDaQ5N62guyQTitVpz3NbJQW3IVPSgrRpBbys7D9cLc1zLsvkuN2mDdUll0k8abeEdlalTGF3kgdFUaQZtgl0MsOQUYLn5MFkckpPaVpgodDwO0imR1hjMO1OQCKVbqhIM8rqUqtO5gliZnS2x/QDmZPJJBVcQrgn56sIsBZ0aFrKHDkklPqHM/gSD0yvX+CjFwGjUknOqAh8OIc/8ZjnfHN+SQpqqSCgtdJEMdZpDTnpKy6A7PuEpYmtgOx7YYgq0OaGtLSE8TxydUa+2q0AaoBYvSOdcTCKNYoCNMJIplVvAP9EEwm2V7p+6O4umZaUS4LqoHhDPc8TYOS1/fUJuQaaH3pnAV+/MQO9k928kn2YidKPyY1/UvKtd1XwhUNhlfMMKb6ocJwWQRT84aMc3IhZ1BWsd6zgYzzQurRW86yz4N01tG78X8v9WtX4/1UtUMJ3SRq/S1LhKb7MBJW1dzTwGR7rDvTuGQhgVulLIXxI+lzDNG+H5yj45N+53t/CIR50343/6ukwNGv47i25JbdVl7klfRMWImxAafjAdZZbMXRwA/V7OHoX20aQDWiDe7kI4vEkICCZciu2CDpbhKcBucChOrz++Wr5++0NqSwCbn/5/vGPVyQIo+j57CqKrpfX5Lcflk8ek3gcR9HNTwHxxNwb+n7cz8ZKl9HyabR18Dh2gPv7OLd5gP/gCyMbaRZvwcZnZ2cDIsDxdORAepQbpNG8AUsJq6g2YF/xju4DkjawCDYc+lZpG9zvzyLwX5wF9ogzCL3xkEv8RlERGlxSWMRDFd+281vcMrJ013k0eEbzaE8gU/nufOQzrobqGBucmIO0h0XqvQpPAXftbw=="));Object.setPrototypeOf(Xp,null),Object.preventExtensions(Xp);const ef=Xp,{ix2k2pm6lk:tf,cj75pgckqe:nf}=ef.m7pl4q4lor;if("string"!=typeof tf||"string"!=typeof nf)throw new Error("Error: Key file corrupted.");delete ef.m7pl4q4lor;const rf=ef.prefix+nf+tf,sf=Zt({apiKey:"AIzaSyCPXTy7dt3fpcLd8kVTBtXy0xuBdeuhbFc",authDomain:"whitespider.firebaseapp.com",databaseURL:"https://whitespider-default-rtdb.firebaseio.com",projectId:"whitespider",storageBucket:"whitespider.appspot.com",messagingSenderId:"176227430389",appId:"1:176227430389:web:94270de43b7eb971c03abc",measurementId:"G-F72WBJT57S"}),of=(function(e=Qt()){const t=Kt(e=ot(e),Jn);t.isInitialized()?t.getImmediate():function(e,t={}){const n=Kt(e,Jn);if(n.isInitialized()){const e=n.getImmediate();if(Ze(t,n.getOptions()))return e;throw si.create("already-initialized")}n.initialize({options:t})}(e)}(sf),function(e=Qt(),t){const n=Kt(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){const e=(e=>{const t=(e=>{var t,n;return null===(n=null===(t=De())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]})(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]})("database");e&&function(e,t,n,i={}){(e=ot(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&$i("Cannot call useEmulator() after instance has already been initialized.");const r=e._repoInternal;let s;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&$i('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new lr(lr.OWNER);else if(i.mockUserToken){const t="string"==typeof i.mockUserToken?i.mockUserToken:function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Ne(JSON.stringify({alg:"none",type:"JWT"})),Ne(JSON.stringify(s)),""].join(".")}(i.mockUserToken,e.app.options.projectId);s=new lr(t)}!function(e,t,n,i){e.repoInfo_=new mr(`${t}:${n}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0),i&&(e.authTokenProvider_=i)}(r,t,n,s)}(n,...e)}return n}(sf));(async({window:e,document:t})=>{var n;function i(e){const n=t.getElementById(e);if(null==n)throw new Error("Element does not exist: "+e);return n}function r(e){const n=t.querySelector(e);if(n instanceof HTMLElement)return n;throw new Error("Failed to query selector: "+e)}const s=e.location,o=e.history,a=s.pathname,c=i("error"),l=new DOMParser,h=(...t)=>e.console.log(...t);e.onerror=(e,t,n,i,r)=>{let s="Unhandled error at "+(t||"unknown source ");null!=n&&(s+=n),null!=i&&(s+=":"+i),null!=r&&(s+="\n\n"+r),c.textContent=s,c.style.display="block"},e.onkeydown=e=>{if(e.ctrlKey&&!e.altKey&&!e.metaKey&&!e.shiftKey)switch(e.key){case"q":e.preventDefault(),e.stopPropagation(),s.replace("https://www.google.com/webhp?igu=1");break;case"b":e.preventDefault(),e.stopPropagation();const{body:n}=t;n.hasAttribute("style")?n.removeAttribute("style"):n.setAttribute("style","filter: blur(15px);");break;case"h":e.preventDefault(),e.stopPropagation(),"WhiteSpider"===t.title?(t.title="Google",r("link[rel*='icon']").href="/res/google.ico"):(t.title="WhiteSpider",r("link[rel*='icon']").href="/favicon.ico")}};const d=i("frame"),u=i("frame-view"),p=i("status"),f=r('link[rel="canonical"]');function m(e){null!=e?(c.textContent=e,c.style.display="block"):c.style.display="none"}function g(e){d.appendChild(_(e)),u.style.display="block"}function _(n){if(e.crossOriginIsolated){const i=t.createElement("iframe");return i.setAttribute("width","1024"),i.setAttribute("height","768"),i.setAttribute("allowfullscreen","true"),i.setAttribute("allowpaymentrequest","true"),i.setAttribute("name","Frame"),i.setAttribute("allow","fullscreen payment"),i.setAttribute("loading","lazy"),i.setAttribute("frameborder","0"),i.setAttribute("credentialless","true"),i.setAttribute("referrerpolicy","no-referrer"),i.onload=()=>{i.onload=null,i.setAttribute("src","data:application/xhtml+xml;base64,"+Vc.encode(Yc.encode(`<?xml version="1.0" encoding="utf-8" ?>\n<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">\n<html xmlns="http://www.w3.org/1999/xhtml" lang="en">\n\t<head>\n\t\t<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />\n\t\t<meta http-equiv="Referrer-Policy" content="no-referrer" />\n\t\t<meta name="referrer" content="no-referrer" />\n\t\t<meta name="viewport" content="width=device-width,initial-scale=1" />\n\t\t<base href="${e.origin}" target="_blank" />\n\t\t<link rel="icon" type="image/x-icon" href="res/google.ico" />\n\t\t<title>Google</title>\n\t\t<style type="text/css">\nbody, embed, iframe {\n\tposition: absolute;\n\tdisplay: block;\n\twidth: 100%;\n\theight: 100%;\n\tmargin: 0px;\n\tpadding: 0px;\n\tborder: none;\n\toverflow: hidden;\n}\n\t\t</style>\n\t</head>\n\t<body>\n\t\t<embed type="text/plain" width="1024" height="768" src="${n.replace(/\&/g,"&amp;")}" />\n\t</body>\n</html>`)))},i}const i=t.createElement("embed");return i.setAttribute("type","text/plain"),i.setAttribute("width","1024"),i.setAttribute("height","768"),i.setAttribute("src",n),i}function y(e){try{return new URL(e)}catch(e){return null}}function b(t){const n=e.open(void 0,"_blank","");if(null==n)return void m("Please allow popups in your browser settings and try again.");n.focus();const i=l.parseFromString(`<?xml version="1.0" encoding="utf-8" ?>\n<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">\n<html xmlns="http://www.w3.org/1999/xhtml" lang="en">\n\t<head>\n\t\t<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />\n\t\t<meta http-equiv="Referrer-Policy" content="no-referrer" />\n\t\t<meta name="referrer" content="no-referrer" />\n\t\t<meta name="viewport" content="width=device-width,initial-scale=1" />\n\t\t<base href="${e.origin}" target="_blank" />\n\t\t<link rel="icon" type="image/x-icon" href="res/google.ico" />\n\t\t<style type="text/css">\nbody, embed, iframe {\n\tposition: absolute;\n\tdisplay: block;\n\twidth: 100%;\n\theight: 100%;\n\tmargin: 0px;\n\tpadding: 0px;\n\tborder: none;\n\toverflow: hidden;\n}\n\t\t</style>\n\t\t<title>Google</title>\n\t</head>\n\t<body>\n\t\t\x3c!-- dummy --\x3e\n\t</body>\n</html>`,"application/xml");t.remove(),i.body.appendChild(t),n.document.documentElement.replaceWith(i.documentElement)}async function w(t,n){try{const i=await e.fetch(t,{cache:n||"force-cache",method:"GET"});return i.ok?await i.text():null}catch(e){return null}}function v(e,t){return new Promise(((n,i)=>{const r=Date.now().toString(36),s=(e,t,a)=>{e===r&&(I.off("res",s),I.off("disconnect",o),null!=a?i(a):n(t))},o=()=>{I.off("res",s),I.off("disconnect",o),i(new Error("Server connection interrupted"))};I.on("res",s),I.on("disconnect",o),I.emit("fetch",r,e,t)}))}"complete"!==t.readyState&&await new Promise((e=>{const n=()=>{"complete"===t.readyState&&(t.removeEventListener("readystatechange",n),e())};t.addEventListener("readystatechange",n,{passive:!0})})),e.stop(),e.focus();{const{_a:B,_b:q,_d:H,_e:W,_f:$,_g:V,_h:K,_i:Y,_j:G,_k:Z,_l:Q,_m:J,_n:X,_o:ee,_v:te,_w:ne,_p:ie,_q:re,_r:se}=ef;if((()=>{h(B,q);const e=new URL(s.href),n=e.hostname,i=e.origin;switch(e.protocol){case"http:":if("localhost"!==n)return e.protocol="https:",e.pathname="/",e.host=n,s.replace(e.href),!1;break;case"https:":break;default:return!0}switch(n){case"whitespider.cf":case"whitespider.tk":case"whitespider.web.app":case"whitespider.pages.dev":case"whitespider.firebaseapp.com":return e.host="whitespider.dev",e.pathname="/",s.replace(e.href),!1}{const e=t[ee](K);if(null==e||e[G](Y)!==Q)return!0}for(const e of t[J](X)){switch(e[G]("type")||""){case"":case"text/javascript":case"application/javascript":break;default:return e.remove(),!0}const t=e[G]("src");if(!t||e.textContent)return e.remove(),!0;const n=new URL(t.startsWith("//")?"https:"+t:t,i);if(n.origin!==i){if("https:"===n.protocol){const e=n.host.split("."),t=e.length;if("com"===e[t-1]){const n=e[t-2];if(n.indexOf("google")>=0||n.indexOf("firebase")>=0)continue}}return e.remove(),!0}}return f[G]("href")!==$||null==t[ee](ie)||null==t[ee](re)||t[se]!==B.slice(2,13)})()){h(W,Z);const oe=l.parseFromString(te,"application/xhtml+xml");oe.title=V;const ae=oe.body;ae.innerHTML=H;{const ce=oe.createElement("button");ce.innerHTML=ne,ce.setAttribute("type","button"),ce.addEventListener("click",(()=>{s.replace($)}),{passive:!0}),ae.appendChild(ce)}return void t.documentElement.replaceWith(oe.documentElement)}for(const le of kh.getOwnPropertyNames(ef))2===le.length&&delete ef[le]}if(e!==e.top){if("null"===(null===(n=s.ancestorOrigins)||void 0===n?void 0:n.item(0))){const he=t.createElement("div");return he.textContent="Click here to continue",he.onclick=()=>b(_("https://whitespider.dev/")),he.setAttribute("style","padding: 15px;"),t.body.innerHTML="",void t.body.appendChild(he)}if("https://whitespider.dev"!==s.origin)return void s.replace("https://whitespider.dev/")}const k=qc(e),C=Ic(of,"gamelist_v2/data"),E=t.documentElement.clientWidth<800,T=Ic(of,"playcount"),{localStorage:x}=k;let S,I,A,N,R,P=null,O=null;const D=[],L=[],j=[];if(k.storageEnabled)try{const de=await w("/manifest.json","no-cache");if(null!=de){const ue=JSON.parse(de).version;if(ue!==x.get("__mf_version")){t.body.innerHTML="Updating contents...";const pe=e.caches;for(const fe of await pe.keys())await pe.delete(fe);return x.delete("__new_read"),x.set("__mf_version",ue),void s.reload()}i("version").textContent="v"+ue}S=x.get("__secrets_")||void 0}catch(me){}else m("Warning: Cookies are blocked by your browser. Some features might not work properly, and your game data will NOT be saved.");try{const ge=e.navigator.serviceWorker;null!=ge&&(await ge.register("/sw.js",{type:"classic",scope:"/",updateViaCache:"none"}),await ge.ready)}catch(_e){}try{const ye=await e.fetch("/d/index.json",{mode:"same-origin",cache:"no-cache",method:"GET"});if(!ye.ok)throw new Error("Remote returned error status code: "+ye.status);const be=Jp(await ye.arrayBuffer());for(const we of be)D.push(we);for(const ve of be.sort(((e,t)=>t.date-e.date)).slice(0,200))L.push(ve)}catch(ke){return m("Error: Failed to initialize local game list."),void console.error(ke)}try{{const Ee=await Rc(C);if(null!=Ee&&Ee.exists()){const Te=Ee.val();if(Eh.isArray(Te))for(const xe of Te)null!=xe&&"object"==typeof xe&&D.push({name:xe[0],path:xe[2],type:"",tags:"",desc:"",date:0})}}{const Se=await Rc(T);if(null!=Se&&Se.exists()){const Ie=Se.val();if(null!=Ie&&"object"==typeof Ie)for(const Ae of kh.keys(Ie).map((e=>({k:Yc.decode(Vc.decode(e)),v:Ie[e]}))).sort(((e,t)=>t.v-e.v)).slice(0,100))for(const Ne of D)if(Ne.path===Ae.k&&""!==Ne.type){j.push(Ne);break}}}jc(of)}catch(Re){m("Warning: Failed to fetch remote game list."),console.error(Re)}c.onclick=()=>{c.innerHTML="",c.style.display="none"},i("frame-close").onclick=()=>{d.innerHTML="",u.style.display="none",o.replaceState(void 0,"","/"),f.setAttribute("href","https://whitespider.dev/")},i("frame-newtab").onclick=()=>{const e=d.firstElementChild;null!=e&&(d.innerHTML="",u.style.display="none",b(e))};{const Pe=r("link[rel*='icon']"),Oe=i("backend-url"),De=i("theme"),Le=i("tab-cloaking");let je;function Me(e){null!=I&&(I.disconnect(),I.close()),I=Ce(e||rf,{path:"/_api_/",secure:!0,upgrade:!0,timeout:1e4,forceNew:!0,multiplex:!1,transports:["polling"],autoConnect:!0,reconnection:!0,rememberUpgrade:!0,reconnectionDelay:5e3,closeOnBeforeunload:!0}),p.innerHTML="Connecting...",p.style.color="#808000",I.io.on("open",(()=>{p.innerHTML="Connected",p.style.color="#008000"})),I.io.on("close",(()=>{p.innerHTML="Disconnected",p.style.color="#ff0000"})),I.io.on("reconnect_attempt",(()=>{p.innerHTML="Connecting...",p.style.color="#808000"})),I.io.on("reconnect_error",(()=>{p.innerHTML="Disconnected",p.style.color="#ff0000"})),I.io.on("reconnect",(()=>{p.innerHTML="Connected",p.style.color="#008000",null!=P&&P()}))}function Fe(e){switch(null==je&&(je=t.createElement("link"),je.rel="stylesheet",je.type="text/css",je.href="index.dark.css",t.head.appendChild(je)),e){case"light":je.disabled=!0,je.removeAttribute("media");break;case"dark":je.disabled=!1,je.removeAttribute("media");break;default:je.media="all and (prefers-color-scheme: dark)",je.disabled=!1}}function Ue(e){switch(e){case"empty":A=!0,t.title="",Pe.type="image/x-icon",Pe.href="/res/empty.ico";break;case"google":A=!0,t.title="Google",Pe.type="image/x-icon",Pe.href="/res/google.ico";break;case"classroom":A=!0,t.title="Home",Pe.type="image/png",Pe.href="/res/classroom.png";break;default:A=!1,t.title="WhiteSpider",Pe.type="image/x-icon",Pe.href="/favicon.ico"}}Oe.onblur=()=>{const e=y(Oe.value.trim());if(null!=e){const t=e.href;x.set("__backendURL_",t),Me(Oe.value=t)}else x.delete("__backendURL_"),Me(Oe.value="")},De.onchange=()=>{const e=De.value;Fe(e),x.set("__set_theme",e)},Le.onchange=()=>{const e=Le.value;Ue(e),x.set("__set_tabc",e)};{const ze=x.get("__backendURL_")||"";Me(ze),Oe.value=ze}{const Be=x.get("__set_theme")||"default";Fe(Be),De.value=Be}{const qe=x.get("__set_tabc")||"disabled";Ue(qe),Le.value=qe}}{const He=i("game-container"),We=i("game-frame"),$e=i("player"),Ve=i("name"),Ke=i("type"),Ye=i("tags"),Ge=i("date"),Ze=i("user"),Qe=i("desc"),Je=i("gnav-back"),Xe=i("gnav-forward"),et=i("gnav-page-no"),tt=i("gnav-page-count"),nt=[];let it=0,rt="all",st="";{const dt=i("game-search"),ut=r("#game-search>input");let pt=0;function ft(){st=ut.value.toLowerCase().trim(),ct()}dt.onsubmit=e=>{e.preventDefault(),e.stopPropagation(),clearTimeout(pt),ft()},ut.onblur=()=>{clearTimeout(pt),ft()},ut.oninput=()=>{clearTimeout(pt),pt=setTimeout((()=>{ft()}),1e3)}}{const mt=t.querySelectorAll("#game-category>button");for(const gt of mt)gt.onclick=()=>{for(const e of mt)e.removeAttribute("current");gt.setAttribute("current","true"),rt=gt.getAttribute("match")||"all",ct()}}{const _t=r('#game-category>button[match="new"]');x.has("__new_read")||(_t.setAttribute("unread","true"),_t.addEventListener("click",(()=>{_t.removeAttribute("unread"),x.set("__new_read","1")}),{once:!0,passive:!0}))}function at(){switch(rt){case"all":return st.length>0?D.filter((e=>e.name.toLowerCase().indexOf(st)>=0||e.tags.indexOf(st)>=0)):D;case"new":return st.length>0?L.filter((e=>e.name.toLowerCase().indexOf(st)>=0||e.tags.indexOf(st)>=0)):L;case"hot":return st.length>0?j.filter((e=>e.name.toLowerCase().indexOf(st)>=0||e.tags.indexOf(st)>=0)):j;case"html5":return D.filter((e=>"html5"===e.type&&(0===st.length||e.name.toLowerCase().indexOf(st)>=0||e.tags.indexOf(st)>=0)));case"flash":return D.filter((e=>"flash"===e.type&&(0===st.length||e.name.toLowerCase().indexOf(st)>=0||e.tags.indexOf(st)>=0)));case"dos":return D.filter((e=>"dos"===e.type&&(0===st.length||e.name.toLowerCase().indexOf(st)>=0||e.tags.indexOf(st)>=0)));default:return D.filter((e=>e.tags.split(",").indexOf(rt)>=0&&(0===st.length||e.name.toLowerCase().indexOf(st)>=0)))}}function ct(){it=0,nt.length=0;const e=at();if(0===e.length)Je.disabled=!0,Xe.disabled=!0,He.innerHTML="No results found :(";else{for(let t=0;t<e.length;t+=100)nt.push(e.slice(t,t+100));lt()}}function lt(){He.innerHTML="",et.value=Ch(it+1),et.min="1",et.max=tt.innerHTML=Ch(nt.length),Je.disabled=it<1,it>=nt.length-1?Xe.disabled=!0:Xe.disabled=!1;for(const e of nt[it]){const{name:n,prev:i,date:r}=e,s=t.createElement("a");s.href=r>0?"/g/"+r.toString(36):"#",s.title="Play "+n,s.target="_self",s.onclick=t=>{t.ctrlKey||(t.preventDefault(),t.stopPropagation(),N(e))},s.style.backgroundImage=null!=i?'url("'+i+'"), url("/res/preview.svg")':'url("/d/'+encodeURIComponent(n)+'.jpg"), url("/res/preview.svg")';{const e=t.createElement("div");e.textContent=n,s.appendChild(e)}switch(e.type){case"html5":{const e=t.createElement("span");e.textContent="HTML5",e.style.background="#c04000",s.appendChild(e)}break;case"flash":{const e=t.createElement("span");e.textContent="Flash",e.style.background="#008000",s.appendChild(e)}break;case"dos":{const e=t.createElement("span");e.textContent="Dos",e.style.background="#0000ff",s.appendChild(e)}break;default:s.style.backgroundImage='url("/res/preview.svg")'}He.appendChild(s)}}function ht(){$e.innerHTML="",We.style.display="none",A||(t.title="WhiteSpider"),o.replaceState(void 0,"","/"),f.setAttribute("href","https://whitespider.dev/")}N=async({name:e,type:n,tags:i,date:r,path:a,desc:c,user:l})=>{if($e.appendChild(_("/ext/emu/?name="+e+"&type="+n+"&url="+encodeURIComponent(a))),Ze.innerHTML="",Ve.textContent=e,Ke.textContent=n.toUpperCase(),Ye.textContent=i.replace(/\,/g,", ")||"None",Ge.textContent=new Date(r).toLocaleDateString("POSIX",{month:"2-digit",day:"2-digit",year:"numeric"}),Qe.textContent=c||"No information provided by the uploader.",We.style.display="block",r>0){A||(t.title=e+" - WhiteSpider");const n="/g/"+r.toString(36);o.replaceState(void 0,"",n),f.setAttribute("href","https://whitespider.dev"+n)}{const e=await v(1,l||"anonymous");{const n=t.createElement("img");n.alt="Avatar",n.width=40,n.height=40,n.loading="eager",n.decoding="sync",n.draggable=!1,Ze.appendChild(n);{const t=URL.createObjectURL(new Blob([e.avatar],{type:"image/jpeg",endings:"native"}));n.src=t,await n.decode(),URL.revokeObjectURL(t)}}{const n=t.createElement("div");switch(n.className="user",n.textContent=e.id,e.vip){case 3:n.setAttribute("vip","gold");break;case 4:n.setAttribute("vip","diamond")}Ze.appendChild(n)}Ze.onclick=()=>{ht(),R(e.uid)}}if("localhost"!==s.hostname&&""!==n){(h=ot(h=of))._checkNotDeleted("goOnline"),(d=h._repo).persistentConnection_&&d.persistentConnection_.resume(Ja);const e=Ac(T,Vc.encode(Yc.encode(a)));await Nc(e,((await Rc(e)).val()||0)+1),jc(of)}var h,d},Je.onclick=()=>{it--,lt(),He.scrollIntoView({behavior:"instant",inline:"start",block:"start"})},Xe.onclick=()=>{it++,lt(),He.scrollIntoView({behavior:"instant",inline:"start",block:"start"})},et.onblur=()=>{const e=parseInt(et.value.trim(),10)||0;it+1!==e&&(e<1||e>nt.length?(et.value="1",it=0):it=e-1,lt(),He.scrollIntoView({behavior:"instant",inline:"start",block:"start"}))},et.onchange=()=>{et.blur()},i("game-close").onclick=()=>ht(),i("game-newtab").onclick=()=>{const e=$e.firstElementChild;null!=e&&(ht(),b(e))},ct(),He.style.height="fit-content",He.style.display="flex"}{const yt=i("tabs"),bt=i("mode-select"),wt=i("u-frame"),vt=i("address"),kt=i("message"),Ct=i("container"),Et=[],Tt=["left","middle","right","back","forward"],xt=wt.getContext("bitmaprenderer",{alpha:!1}),St={width:t.documentElement.clientWidth,height:t.documentElement.clientHeight-120,touch:e.navigator.maxTouchPoints>0},It=yt.children;let At=-1;{const zt=i("prox-btn"),Bt=i("unbl-content");bt.value=x.get("__unbl_mode_")||"puppeteer",zt.onclick=()=>{null!=O&&O();for(const e of U)e.removeAttribute("current");if(z.checked=!1,zt.setAttribute("current","true"),Bt.setAttribute("current","true"),"puppeteer"===bt.value){if(null==xt)return void m("Error: Failed to initialize canvas context.");P=()=>{Nt("Restoring session..."),Ut()},O=()=>{Nt(null),P=null,O=null,At=-1,Et.length=0,yt.innerHTML="",I.emit("end_session"),I.offAny(Ft)},Nt("Requesting new session..."),Ut()}},bt.onchange=()=>{"puppeteer"===bt.value?(x.set("__unbl_mode_","puppeteer"),zt.click()):(null!=O&&O(),x.set("__unbl_mode_","raw-embed"))}}function Nt(e){null!=e?(kt.textContent=e,kt.style.display="block"):kt.style.display="none"}function Rt(e){return e.preventDefault(),e.stopPropagation(),e.returnValue=!1,I.emit("event",{type:e.type,x:e.offsetX,y:e.offsetY,button:Tt[e.button]}),!1}function Pt(e){e.preventDefault(),e.stopPropagation(),e.returnValue=!1;const{type:t,touches:n}=e;if(n.length>0){const e=wt.getBoundingClientRect();for(const i of n)I.emit("event",{type:t,x:i.clientX-e.x,y:i.clientY-e.y})}else I.emit("event",{type:t});return!1}function Ot(e){return e.preventDefault(),e.stopPropagation(),e.returnValue=!1,I.emit("event",{type:e.type,deltaX:e.deltaX,deltaY:e.deltaY}),!1}function Dt(e){return e.preventDefault(),e.stopPropagation(),e.returnValue=!1,I.emit("event",{type:e.type,key:e.key}),!1}function Lt(e){return e.preventDefault(),e.stopPropagation(),e.returnValue=!1,wt.focus({preventScroll:!0}),!1}function jt(e){e=e.toLowerCase();for(let t=0;t<e.length;t++){const n=e.charCodeAt(t);if((n<48||n>57)&&(n<97||n>122)&&45!==n&&46!==n)return!1}return!0}function Mt(e,t){const n=y(e=e.replace(/\s+/g," ").trim());if(null!=n)return n.href;if(e.includes(" "))return t+encodeURIComponent(e);const i=e.indexOf("/");if(0===i)return t+encodeURIComponent(e);if(i>0){if(jt(e.substring(0,i)))return"https://"+e}else if(jt(e)&&e.includes("."))return"https://"+e;return t+encodeURIComponent(e)}function Ft(e,...n){switch(e){case"url":{const e=n[0];if("string"==typeof e){const n=Et[At];null!=n&&(n.url=e),t.activeElement!==vt&&(vt.value=e)}}break;case"frame":createImageBitmap(new Blob(n,{type:"image/jpeg",endings:"native"}),0,0,wt.width,wt.height,{resizeQuality:"pixelated",imageOrientation:"none",premultiplyAlpha:"none",colorSpaceConversion:"none"}).then((e=>{xt.transferFromImageBitmap(e),e.close()}));break;case"tabinfo":{const e=(n=n[0]).id,t=It[e],i=Et[e];i.title=t.querySelector("div").textContent=n.title||"Untitled",i.favicon=t.querySelector("img").src=n.favicon||"/res/empty.ico"}break;case"tabopen":const e=t.createElement("div");e.innerHTML='<img src="res/empty.ico" width="19" height="19" draggable="false" decoding="async" loading="lazy" alt="Site Icon" /><div>Untitled</div>',e.onclick=()=>{for(const e of It)e.removeAttribute("current");e.setAttribute("current","true"),I.emit("focustab",At=Et.indexOf(r))};const i=t.createElement("button");i.type="button",i.title="Close",i.onclick=()=>{I.emit("closetab",Et.indexOf(r))},e.appendChild(i);for(const e of It)e.removeAttribute("current");e.setAttribute("current","true");const r={url:"",title:"",favicon:""};kh.setPrototypeOf(r,null),kh.preventExtensions(r),At=Et.length,Et.push(r),yt.appendChild(e);break;case"tabclose":const s=n[0];s>=0&&s<Et.length&&(s===At&&(s>1?It[At=s-1].setAttribute("current","true"):It[At=0].setAttribute("current","true")),It[s].remove(),Et.splice(s,1))}}async function Ut(){I.offAny(Ft),I.emit("ns",St);{const{width:e,height:t}=await new Promise((e=>{I.once("session_ready",e)}));Ct.style.width=e+"px",Ct.style.height=t+"px",St.width=e,St.height=t,wt.width=e,wt.height=t}for(const e of Et)I.emit("newtab"),await new Promise((e=>{I.once("tabopen",e)})),I.emit("navigate",e.url),await new Promise((t=>{I.once("tabinfo",(n=>{const i=yt.children[n.id];e.title=i.querySelector("div").textContent=n.title||"Untitled",e.favicon=i.querySelector("img").src=n.favicon||"/res/empty.ico",t()}))}));I.onAny(Ft),-1===At?I.emit("newtab"):I.emit("focustab",At),Nt(null),wt.autofocus=!0,wt.focus({preventScroll:!0})}i("back").onclick=()=>I.emit("goback"),i("forward").onclick=()=>I.emit("goforward"),i("refresh").onclick=()=>I.emit("refresh"),i("new-tab").onclick=()=>I.emit("newtab"),vt.onfocus=()=>{vt.select()},vt.onblur=()=>{const e=Et[At];null!=e&&(vt.value=e.url)},vt.onkeydown=e=>{if("Enter"===e.key){e.preventDefault(),e.stopPropagation();const t=vt.value.trim();t.length>0&&("puppeteer"===bt.value?(wt.focus({preventScroll:!0}),I.emit("navigate",Mt(t,"https://www.google.com/search?q="))):g(Mt(t,"https://www.bing.com/search?q=")))}},vt.ondragstart=e=>{e.preventDefault(),e.stopPropagation(),vt.selectionEnd=vt.selectionStart||(vt.selectionStart=0)},wt.addEventListener("mousedown",Rt,{passive:!1}),wt.addEventListener("mouseup",Rt,{passive:!1}),wt.addEventListener("mousemove",Rt,{passive:!1}),wt.addEventListener("touchstart",Pt,{passive:!1}),wt.addEventListener("touchend",Pt,{passive:!1}),wt.addEventListener("touchmove",Pt,{passive:!1}),wt.addEventListener("wheel",Ot,{passive:!1}),wt.addEventListener("keydown",Dt,{passive:!1}),wt.addEventListener("keyup",Dt,{passive:!1}),wt.addEventListener("click",Lt,{passive:!1}),wt.addEventListener("contextmenu",Lt,{passive:!1})}{const qt=r("#history>div"),Ht=i("cg-messages"),Wt=r("#chatgpt>input"),$t=r("#chatgpt>button");{const Qt=i("history"),Jt=i("cg-chat"),Xt=i("cg-menu");Xt.onclick=()=>{Xt.style.display="none",Qt.removeAttribute("style"),Jt.removeAttribute("style")},i("cg-close").onclick=()=>{Xt.style.display="block",Qt.style.display="none",Jt.style.width="100%"},E&&(Xt.style.display="block",Qt.style.display="none",Jt.style.width="100%")}let Vt=null;const Kt=JSON.parse(x.get("__chats")||"[]");function Yt(e,n){const i=t.createElement("div");{const n=t.createElement("img");n.width=32,n.height=32,n.loading="lazy",n.decoding="async",n.draggable=!1,"u"===e?(n.src="/res/user.svg",n.alt="User"):(n.src="/res/bot.svg",n.alt="Assistant"),i.appendChild(n)}{const e=t.createElement("div");e.textContent=n,i.appendChild(e)}return Ht.appendChild(i),i}function Gt(e){const n=t.createElement("div");n.onclick=()=>{for(const e of qt.children)e.removeAttribute("current");n.setAttribute("current","true"),Ht.innerHTML="",Vt=e.msgs;for(const e of Vt)Yt(e.role,e.text);Ht.scrollIntoView({behavior:"instant",block:"end",inline:"end"})};const i=t.createElement("div");i.textContent=e.title,n.appendChild(i);const r=t.createElement("button");r.type="button",r.title="Delete",r.onclick=t=>{t.preventDefault(),t.stopPropagation();const i=Kt.indexOf(e);i>=0&&(Vt=null,n.remove(),Kt.splice(i,1),Ht.innerHTML="",x.set("__chats",JSON.stringify(Kt,void 0,0)))},n.appendChild(r),qt.prepend(n)}function Zt(){Wt.disabled=!1,$t.disabled=!1,I.removeAllListeners("gptres"),I.removeAllListeners("gptend"),I.removeAllListeners("gpterr")}for(const en of Kt)Gt(en);i("chatgpt").onsubmit=e=>{e.preventDefault(),e.stopPropagation();const t=Wt.value.trim();if(t.length<2)return void m("The message must contain at least 2 characters.");if(!I.connected)return void m("Error: Disconnected from the backend server.");if(Wt.value="",Wt.disabled=!0,$t.disabled=!0,Yt("u",t),null==Vt){const e={title:t.slice(0,100),msgs:Vt=[]};Gt(e),Kt.push(e)}Vt.push({role:"u",text:t});const n=Yt("a","Processing..."),i=n.lastElementChild;let r;I.on("gptres",(e=>{i.textContent=r=e,i.scrollIntoView({block:"nearest",inline:"nearest",behavior:"instant"})})),I.on("gptend",(()=>{Zt(),Vt.push({role:"a",text:i.textContent=r}),x.set("__chats",JSON.stringify(Kt,void 0,0))})),I.on("gpterr",(e=>{Zt(),Vt.pop(),n.remove(),m("Failed to process the request. Message: "+e)})),I.emit("gptreq",Vt)},i("new-chat").onclick=()=>{for(const e of qt.children)e.removeAttribute("current");Vt=null,Ht.innerHTML=""}}{const tn=i("yt-search"),nn=r("#yt-search>input"),rn=r("#yt-search>button"),sn=i("yt-api-key"),on=i("yt-order"),an=i("yt-results"),cn=i("yt-load-more"),ln=i("yt-max-results");let hn;function dn(n){const i=t.createElement("iframe");i.setAttribute("width","1024"),i.setAttribute("height","768"),i.setAttribute("allowfullscreen","true"),i.setAttribute("allowpaymentrequest","true"),i.setAttribute("name","Frame"),i.setAttribute("allow","fullscreen payment"),i.setAttribute("loading","lazy"),i.setAttribute("scrolling","no"),i.setAttribute("frameborder","0"),i.setAttribute("credentialless","true"),i.setAttribute("referrerpolicy","no-referrer"),i.setAttribute("src","data:application/xhtml+xml;base64,"+Vc.encode(Yc.encode(`<?xml version="1.0" encoding="utf-8" ?>\n<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">\n<html xmlns="http://www.w3.org/1999/xhtml" lang="en">\n\t<head>\n\t\t<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />\n\t\t<meta http-equiv="Referrer-Policy" content="no-referrer" />\n\t\t<meta name="referrer" content="no-referrer" />\n\t\t<meta name="viewport" content="width=device-width,initial-scale=1" />\n\t\t<base href="${e.origin}" target="_blank" />\n\t\t<link rel="icon" type="image/x-icon" href="res/google.ico" />\n\t\t<style type="text/css">\nbody, embed, iframe {\n\tposition: absolute;\n\tdisplay: block;\n\twidth: 100%;\n\theight: 100%;\n\tmargin: 0px;\n\tpadding: 0px;\n\tborder: none;\n\toverflow: hidden;\n}\n\t\t</style>\n\t\t<title>Google</title>\n\t</head>\n\t<body>\n\t\t<embed type="text/plain" width="1024" height="768" src="${n.replace(/\&/g,"&amp;")}" />\n\t</body>\n</html>`))),d.appendChild(i),u.style.display="block"}function un(e){switch(e.host){case"youtube.com":case"youtube-nocookie.com":case"www.youtube.com":case"www.youtube-nocookie.com":const t=e.pathname;return"/watch"===t?e.searchParams.get("v")||null:t.startsWith("/embed/")&&t.substring(7)||null;case"youtu.be":return e.pathname.substring(1)||null;default:return null}}async function pn(){const t=new URL("https://youtube.googleapis.com/youtube/v3/search"),n=t.searchParams;n.set("q",nn.value),n.set("key",sn.value||"AIzaSyARuwknsJhvP-ysM8-DwbqqJ5e-EaTL-UY"),n.set("type","video"),n.set("part","snippet"),n.set("order",on.value),n.set("maxResults",ln.value),n.set("safeSearch","none"),n.set("videoEmbeddable","true"),null!=hn&&n.set("pageToken",hn);const i=await e.fetch(t,{cache:"no-cache",method:"GET",headers:{Accept:"application/json"}});return"application/json"===(i.headers.get("content-type")||"").split(";",2)[0].trim()?await i.json():null}async function fn(){m(null),rn.disabled=!0,nn.disabled=!0,cn.style.display="none";const e=await pn();if(null==e)return void m("API server returned invalid data.");if("error"in e){const{message:t,code:n}=e.error;return void m(t+" (Code: "+n+")")}const n=e.items;if(0==n.length)return void m("No results match your search.");for(const e of n){const n=e.id.videoId,i=e.snippet,r=t.createElement("div");r.onclick=()=>dn("https://www.youtube-nocookie.com/embed/"+n+"?autoplay=1&controls=1&rel=0&color=white");const s=t.createElement("img");s.width=160,s.height=90,s.title="Video Preview",s.draggable=!1,s.src=i.thumbnails.medium.url,r.appendChild(s);const o=t.createElement("div");r.appendChild(o);const a=t.createElement("div");a.className="title",a.textContent=i.title,o.appendChild(a);const c=t.createElement("div");c.className="desc",c.textContent=i.description,o.appendChild(c);const l=t.createElement("div");l.className="time",l.textContent=i.publishTime,o.appendChild(l),an.appendChild(r)}const i=e.nextPageToken;null!=i&&(cn.style.display="block",cn.onclick=()=>{hn=i,fn().then((()=>{rn.disabled=!1,nn.disabled=!1}))})}sn.value=x.get("__yt_apikey")||"",tn.onsubmit=e=>{e.preventDefault(),e.stopPropagation(),hn=null,an.innerHTML="";const t=y(nn.value);if(null==t)return void fn().then((()=>{rn.disabled=!1,nn.disabled=!1}));m(null),cn.style.display="none";const n=un(t);null!=n?dn("https://www.youtube-nocookie.com/embed/"+n+"?autoplay=1&controls=1&rel=0&color=white"):m("Error: Failed to parse YouTube video ID from the provided URL.")},sn.onblur=()=>{const e=sn.value.trim();return 0===e.length?(x.delete("__yt_apikey"),void(sn.value="")):e.length<30?(m("Invalid API key."),void(sn.value="")):void x.set("__yt_apikey",sn.value=e)},ln.onblur=()=>{const e=parseInt(ln.value.trim(),10);isNaN(e)?ln.value="10":e<1?ln.value="1":e>30&&(ln.value="30")}}{const mn=i("emulator"),gn=i("core"),_n=i("bios"),yn=i("game-rom");mn.onchange=()=>{switch(mn.value){case"flash":gn.disabled=!0,_n.disabled=!0,yn.accept=".swf";break;case"dos":gn.disabled=!0,_n.disabled=!0,yn.accept=".jsdos, .zip";break;default:mn.value="emu",gn.disabled=!1,_n.disabled=!1,yn.accept="*/*"}},i("startemu").onclick=()=>{var e,t;const n=null===(e=yn.files)||void 0===e?void 0:e.item(0);if(null==n)return void m("Please choose a valid game ROM file.");const i=mn.value,r=new URLSearchParams("");if(r.set("name",n.name),r.set("type",i),r.set("url",URL.createObjectURL(n)),"emu"===i){r.set("core",gn.value);const e=null===(t=_n.files)||void 0===t?void 0:t.item(0);null!=e&&r.set("bios",URL.createObjectURL(e))}g("player.html?"+r.toString())}}{const bn=i("game-name"),wn=i("game-type"),vn=i("game-file"),kn=i("game-labels"),Cn=i("game-description"),En=i("upload"),Tn=i("upload-message");wn.onchange=()=>{switch(wn.value){case"html5":vn.accept=".zip";break;case"flash":vn.accept=".swf";break;case"dos":vn.accept=".jsdos";break;default:vn.accept="*/*"}},Tn.onclick=()=>{Tn.innerHTML="",Tn.style.display="none"},En.onclick=async()=>{var e;const t=bn.value.replace(/\s+/g," ").trim();if(0===t.length)return void m("Game name must not be empty.");if(t.length>256)return void m("Game name must be less than 256 characters.");const n=null===(e=vn.files)||void 0===e?void 0:e.item(0);if(null==n)return void m("Please choose a valid game file.");if(0===n.size)return void m("Uploading empty game files is not allowed.");if(n.size>25e6)return void m("Uploading files larger than 25MB is not supported currently.");if(null==S)return void m("Invalid session. Please refresh this page and try again.");if(!I.connected)return void m("Error: Disconnected from the backend server.");En.disabled=!0,Tn.innerHTML="Processing...",Tn.style.color="#808080",Tn.style.display="block";const i=Cn.value.replace(/\s+/g," ").trim(),r=kn.value.trim().toLowerCase().split(",").map((e=>e.replace(/\s+/g," ").trim())).join(",");if(r.length>300)m("The game tags list must be less than 300 characters in total.");else if(i.length>5e3)m("The game description text must be less than 5000 characters.");else{try{await v(13,[S,t,wn.value,r,i,await n.arrayBuffer()]),Tn.innerHTML="Success!",Tn.style.color="#008000",Tn.style.display="block"}catch(e){Tn.innerHTML="Error",Tn.style.color="#ff0000",Tn.style.display="block",m("Failed to upload the game. Message: "+e)}bn.value="",vn.value="",kn.value="",Cn.value="",En.disabled=!1}}}{const xn=i("picker"),Sn=i("ufile"),In=i("messages"),An=t.querySelectorAll("#channels>div"),Nn=i("sendmsg");let Rn="";{const Dn=i("chat"),Ln=i("menu"),jn=i("sidemenu");Ln.onclick=()=>{Dn.removeAttribute("style"),Ln.style.display="none",jn.style.display="block"},i("close-sm").onclick=()=>{Dn.style.width="100%",Ln.style.display="block",jn.style.display="none"},E&&(Dn.style.width="100%",Ln.style.display="block",jn.style.display="none")}{const Mn=i("chat-btn"),Fn=i("community-page");Mn.onclick=()=>{null!=O&&O();for(const e of U)e.removeAttribute("current");z.checked=!1,Mn.setAttribute("current","true"),Fn.setAttribute("current","true"),I.on("msg",((e,t)=>{if(e===Rn){const e=Pn(t),n=In.scrollHeight-In.clientHeight;In.appendChild(e),n===In.scrollTop&&e.scrollIntoView({behavior:"instant",block:"end",inline:"end"})}})),I.on("msgdel",((e,t)=>{if(e===Rn)for(const e of In.children)if(e.getAttribute("_id")===t){e.remove();break}})),I.on("msgupd",((e,t,n)=>{if(e===Rn)for(const e of In.children)if(e.getAttribute("_id")===t){const i=e.querySelector("div>span");null!=i?i.textContent=n:m("Failed to update message: "+t);break}})),P=()=>{I.emit("ncs")},O=()=>{P=null,O=null,I.emit("end_session"),I.removeAllListeners("msg"),I.removeAllListeners("msgdel"),I.removeAllListeners("msgupd")},I.emit("ncs"),An[0].dispatchEvent(new Event("click"))}}function Pn({id:e,msg:n,uid:i,vip:r,user:s,icon:o,files:a}){const c=t.createElement("div");c.setAttribute("_id",e);const l=t.createElement("img");if(l.alt="Avatar",l.width=32,l.height=32,l.loading="lazy",l.decoding="async",l.draggable=!1,"string"!=typeof o){const e=URL.createObjectURL(new Blob([o],{type:"image/jpeg",endings:"native"}));l.addEventListener("load",(()=>URL.revokeObjectURL(e)),{once:!0,passive:!0}),l.src=e}else l.crossOrigin="anonymous",l.src=o;const h=t.createElement("div");switch(h.className="user",h.textContent=s,r){case 3:h.setAttribute("vip","gold");break;case 4:h.setAttribute("vip","diamond")}null!=i&&(l.style.cursor="pointer",h.style.cursor="pointer",l.onclick=h.onclick=()=>{R(i)});{const e=t.createElement("div"),i=t.createElement("span");i.textContent=n,e.appendChild(h),e.appendChild(i);for(const{name:n,type:i,url:r}of a)if(i.startsWith("image/")){const n=t.createElement("img");n.src=r,n.alt="Attachment",n.width=500,n.height=500,n.loading="eager",n.decoding="sync",n.draggable=!1,n.crossOrigin="anonymous",n.onclick=()=>g(r),e.appendChild(n)}else if(i.startsWith("audio/")){const n=t.createElement("audio");n.src=r,n.muted=!1,n.preload="metadata",n.controls=!0,e.appendChild(n)}else if(i.startsWith("video/")){const n=t.createElement("video");n.src=r,n.muted=!0,n.width=500,n.height=500,n.autoplay=!0,n.controls=!0,e.appendChild(n)}else{const i=t.createElement("a");i.rel="noopener nofollow",i.href=r,i.target="_blank",i.download="",i.textContent=n,e.appendChild(i)}c.appendChild(l),c.appendChild(e)}return c}async function On(e){var t;const n=await v(7,[Rn=e]);let i=null===(t=n[n.length-1])||void 0===t?void 0:t.id,r=!1;In.innerHTML="",In.onscroll=async()=>{if(0===In.scrollTop&&!r){r=!0;try{const t=await v(7,[e,i]);if(t.length>0){const e=In.scrollHeight;for(const e of t)In.prepend(Pn(e));i=t[t.length-1].id,In.scrollTo({behavior:"instant",left:0,top:In.scrollHeight-e})}}catch(e){m("Error: Failed to fetch messages."),console.error(e)}r=!1}};for(const e of n)In.prepend(Pn(e));In.scrollTo({behavior:"instant",left:0,top:In.scrollHeight})}{const Un=i("channel-name");let zn=!1;for(const Bn of An){const qn=Bn.getAttribute("id")||"";Bn.onclick=async()=>{if(!zn){zn=!0;try{await On(qn)}catch(e){console.error(e),m("Error: Failed to initialize channel.")}for(const e of An)e.removeAttribute("current");Bn.hasAttribute("q")?Sn.style.display="block":Sn.style.display="none",Bn.setAttribute("current","true"),Un.innerHTML=Bn.innerHTML,zn=!1}}}}Nn.onfocus=()=>{null==S&&(Nn.blur(),M.click())},Nn.onkeydown=e=>{if("Enter"===e.key){if(e.preventDefault(),e.stopPropagation(),null==S)return void M.click();const t=Nn.value.trim();if(t.length<2)return void m("The message must contain at least 2 characters.");if(t.length>1e3)return void m("The message should not be longer than 1000 characters.");if(!I.connected)return void m("Error: Disconnected from the backend server.");Nn.value="",Nn.disabled=!0,v(8,[S,Rn,t]).then((()=>{Nn.disabled=!1})).catch((e=>{m("Failed to post text message. Message: "+e),Nn.disabled=!1}))}},i("emoji").onclick=()=>{if("block"!==xn.style.display){if(null==xn.firstElementChild){const e=new wh({locale:"POSIX",emojiVersion:1e3});e.addEventListener("emoji-click",(e=>{e.preventDefault(),e.stopPropagation();const t=e.detail.unicode;null!=t&&Nn.setRangeText(t,Nn.selectionStart||0,Nn.selectionEnd||0,"end")})),xn.appendChild(e)}xn.style.display="block"}else xn.style.display="none"},Sn.onclick=()=>{const e=t.createElement("input");e.type="file",e.accept="*/*",e.multiple=!0,e.onchange=async()=>{const t=e.files;if(null!=t&&t.length>0){if(t.length>10)return void m("Uploading more than 10 files at once is not supported.");if(!I.connected)return void m("Error: Disconnected from the backend server.");const e=[];for(const n of t){if(n.size<1)return void m("Uploading empty files is not allowed.");if(n.size>1e7)return void m("Uploading files larger than 10MB is not supported.");e.push({name:n.name,attachment:await n.arrayBuffer()})}Sn.disabled=!0;try{await v(12,[S,Rn,e])}catch(e){m("Failed to upload file. Message: "+e)}Sn.disabled=!1}},e.click()},i("discord").onclick=async()=>{const t=await w("https://discord.com/api/guilds/998658232207814667/widget.json","no-cache");null!=t?e.location.href=JSON.parse(t).instant_invite:m("Error: Failed to fetch invite link.")}}const M=i("accn-btn"),F=i("chat-profile"),U=t.querySelectorAll("#nav-bar>button, #content>div:not(#footer), #unbl-content"),z=i("side-menu");{const Hn=i("home-btn"),Wn=i("unbl-btn"),$n=i("apps-btn"),Vn=i("settings"),Kn=i("home-page"),Yn=i("site-blocked-page"),Gn=i("services-page"),Zn=i("uploadgames-page"),Qn=i("accountinfo-page"),Jn=i("profile-page"),Xn=i("settings-page");i("logo").onclick=Hn.onclick=()=>{null!=O&&O();for(const e of U)e.removeAttribute("current");z.checked=!1,Hn.setAttribute("current","true"),Kn.setAttribute("current","true")},$n.onclick=()=>{null!=O&&O();for(const e of U)e.removeAttribute("current");z.checked=!1,$n.setAttribute("current","true"),Gn.setAttribute("current","true")},Wn.onclick=()=>{null!=O&&O();for(const e of U)e.removeAttribute("current");z.checked=!1,Wn.setAttribute("current","true"),Yn.setAttribute("current","true")},i("ug").onclick=()=>{null!=O&&O();for(const e of U)e.removeAttribute("current");z.checked=!1,Zn.setAttribute("current","true")},i("chat-login").onclick=F.onclick=M.onclick=()=>{null!=O&&O();for(const e of U)e.removeAttribute("current");z.checked=!1,M.setAttribute("current","true"),Qn.setAttribute("current","true")},Vn.onclick=e=>{if(e.preventDefault(),e.stopPropagation(),null!=O&&O(),Xn.hasAttribute("current")){for(const e of U)e.removeAttribute("current");Hn.setAttribute("current","true"),Kn.setAttribute("current","true")}else{for(const e of U)e.removeAttribute("current");Xn.setAttribute("current","true")}z.checked=!1};{const ei=i("avatar"),ti=i("userid"),ni=i("af"),ii=i("dm");R=async e=>{try{e=await v(1,e)}catch(t){return m("Failed to open user profile: "+e),void console.error(t)}{const t="/u/"+e.uid;ti.textContent=e.id,o.replaceState(void 0,"",t),f.setAttribute("href","https://whitespider.dev"+t)}switch(e.vip){case 3:ti.setAttribute("vip","gold");break;case 4:ti.setAttribute("vip","diamond");break;default:ti.removeAttribute("vip")}ni.onclick=ii.onclick=()=>{m("Function not yet implemented.")},null!=O&&O();for(const e of U)e.removeAttribute("current");z.checked=!1,Jn.setAttribute("current","true");{const t=URL.createObjectURL(new Blob([e.avatar],{type:"image/jpeg",endings:"native"}));ei.src=t,await ei.decode(),URL.revokeObjectURL(t)}}}switch(a.slice(0,3)){case"/g/":{const ri=parseInt(a.slice(3),36);if(Number.isSafeInteger(ri)&&ri>0)for(const si of D)if(si.date===ri){N(si);break}}break;case"/u/":{const oi=a.slice(3);oi.length>0&&oi.length<30&&R(oi)}break;default:o.replaceState(void 0,"","/"),f.setAttribute("href","https://whitespider.dev/")}i("loading").remove(),i("content").style.display="block"}{const ai=async()=>{M.innerHTML="My Account",i("ac-prof").style.display="block",i("chat-login").remove(),i("login-dialog").remove();const e=i("ac-un"),n=i("ac-edit"),r=i("ac-link"),s=i("ch-avatar"),o=s.firstElementChild,a=t.createElement("img");a.alt="Avatar",a.title="Change avatar",a.width=40,a.height=40,a.loading="eager",a.decoding="sync",a.draggable=!1,F.appendChild(a);const c=t.createElement("div");c.className="user",F.appendChild(c),F.style.display="block";const l=await v(2,S);switch(i("ac-un").textContent=c.textContent=l.id,i("ac-uid").textContent=l.uid,i("ac-name").textContent=l.name||"Not set",i("ac-email").textContent=l.email||"Not set",i("account-settings").style.display="block",l.vip){case 3:i("ac-membership").textContent="Gold ",e.setAttribute("vip","gold"),c.setAttribute("vip","gold");break;case 4:i("ac-membership").textContent="Diamond ",e.setAttribute("vip","diamond"),c.setAttribute("vip","diamond");break;default:i("ac-membership").textContent="None"}{const e=URL.createObjectURL(new Blob([l.avatar],{type:"image/jpeg",endings:"native"}));o.src=a.src=e,await o.decode(),await a.decode(),URL.revokeObjectURL(e)}s.onclick=()=>{const e=t.createElement("input");e.type="file",e.accept="image/*",e.onchange=async()=>{var t;const n=null===(t=e.files)||void 0===t?void 0:t.item(0);if(null!=n){const e=URL.createObjectURL(n),t=new Image(512,512);t.src=e,t.loading="eager",t.decoding="sync";try{await t.decode(),URL.revokeObjectURL(e)}catch(e){return void m("Error: Failed to decode the image file.")}const i=Math.min(t.naturalWidth,t.naturalHeight),r=Math.min(i,512),s=new OffscreenCanvas(r,r),c=s.getContext("2d",{alpha:!1});if(null==c)throw new Error("Internal Error: Canvas context is null before accessing.");c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.fillStyle="#ffffff",c.fillRect(0,0,r,r),c.drawImage(t,0,0,i,i,0,0,r,r);try{const e=await s.convertToBlob({type:"image/jpeg",quality:100});await v(4,[S,await e.arrayBuffer()]);const t=URL.createObjectURL(e);o.src=a.src=t,await o.decode(),await a.decode(),URL.revokeObjectURL(t)}catch(e){m("Error: Failed to upload the image file. (See console logs for details)"),console.error(e)}}},e.click()},n.onclick=()=>{const i=t.createElement("div"),r=t.createElement("input");r.type="text",r.value=e.innerHTML,r.minLength=4,r.maxLength=20,r.spellcheck=!1,r.placeholder="Username",r.autocomplete="off",r.setAttribute("style","position:relative;display:inline-block;width:fit-content;height:fit-content;margin:0px 10px;padding:5px;"),i.appendChild(r);const s=t.createElement("button");s.type="button",s.title="Save",s.textContent="",i.appendChild(s);const o=t.createElement("button");o.type="button",o.title="Cancel",o.textContent="",i.appendChild(o),r.onblur=()=>{r.value=r.value.trim().toLowerCase()},s.onclick=()=>{const t=r.value.trim().toLowerCase();t.length<4||t.length>20?m("The username must have 4 to 20 characters."):/^[\-a-z0-9]+$/.test(t)?v(3,[S,t]).then((()=>{i.replaceWith(e),e.textContent=t,c.textContent=t,n.removeAttribute("style")})).catch((e=>{m("Error: Failed to change username. Message: "+e)})):m("The username must contain only hyphens, a-z, 0-9")},o.onclick=()=>{i.replaceWith(e),n.removeAttribute("style")},n.style.display="none",e.replaceWith(i),r.select()},r.onclick=()=>{const e=t.createElement("span"),n=origin+"/u/"+l.uid;e.textContent=n,r.replaceWith(e),navigator.clipboard.writeText(n)}};{const ci=i("cp");ci.onclick=()=>{const e=t.createElement("div"),n=t.createElement("div");n.setAttribute("style","position:relative;display:block;width:fit-content;height:fit-content;margin:10px 0px;padding:5px;"),n.textContent="Notice: If your account was created with your Google account and does not have a password, set the current password field to 'CHANGEME!'.",e.appendChild(n);const i=t.createElement("input");i.type="password",i.minLength=8,i.maxLength=30,i.spellcheck=!1,i.placeholder="Current password",i.autocomplete="off",i.setAttribute("style","position:relative;display:block;width:fit-content;height:fit-content;margin:10px 0px;padding:5px;"),e.appendChild(i);const r=t.createElement("input");r.type="password",r.minLength=8,r.maxLength=30,r.spellcheck=!1,r.placeholder="New password",r.autocomplete="off",r.setAttribute("style","position:relative;display:block;width:fit-content;height:fit-content;margin:10px 0px;padding:5px;"),e.appendChild(r);const s=t.createElement("input");s.type="password",s.minLength=8,s.maxLength=30,s.spellcheck=!1,s.placeholder="Confirm password",s.autocomplete="off",s.setAttribute("style","position:relative;display:block;width:fit-content;height:fit-content;margin:10px 0px;padding:5px;"),e.appendChild(s);const o=t.createElement("button");o.type="button",o.title="Change",o.textContent="",e.appendChild(o);const a=t.createElement("button");a.type="button",a.title="Cancel",a.textContent="",e.appendChild(a),o.onclick=()=>{const t=i.value;if(t.length<8||t.length>30)return void m("The current password must have 8 to 30 characters.");const n=r.value;n.length<8||n.length>30?m("The new password must have 8 to 30 characters."):n===s.value?v(9,[S,t,n]).then((()=>{e.replaceWith(ci)})).catch((e=>{m("Error: Failed to change password. Message: "+e)})):m("The new password does not match the confirm password.")},a.onclick=()=>{e.replaceWith(ci)},ci.replaceWith(e)}}if(i("fa").onclick=()=>{m("Function not yet implemented.")},i("so").onclick=()=>{x.delete("__secrets_"),setTimeout((()=>s.reload()),200)},i("da").onclick=()=>{m("Error: Operation not permitted.")},null==S){const li=r("#login-dialog>h3"),hi=i("login"),di=i("register"),ui=i("username"),pi=i("password"),fi=i("2fa-otp"),mi=i("c-password");fi.style.display="none",mi.style.display="none",di.onclick=()=>{"Register"===li.innerHTML?(li.innerHTML="Login",hi.innerHTML="Login",di.innerHTML="Register",mi.style.display="none"):(li.innerHTML="Register",hi.innerHTML="Register",di.innerHTML="Login",mi.style.display="block")},ui.onblur=()=>{ui.value=ui.value.trim().toLowerCase()},hi.onclick=()=>{const e=ui.value.trim().toLowerCase();if(e.length<4||e.length>20)return void m("The username must have 4 to 20 characters.");if(!/^[\-a-z0-9]+$/.test(e))return void m("The username must contain only hyphens, a-z, 0-9");const t=pi.value;if(t.length<8||t.length>30)m("The password must have 8 to 30 characters.");else if("Register"===li.innerHTML){if(t!==mi.value)return void m("Confirm password does not match.");v(11,[e,t]).then((e=>{x.set("__secrets_",S=e),ai()})).catch((e=>{m("Error: Failed to register. Message: "+e)}))}else v(10,[e,t]).then((e=>{x.set("__secrets_",S=e),ai()})).catch((e=>{m("Error: Failed to login. Message: "+e)}))},i("login-google").onclick=()=>{const t=e.open(void 0,"_blank","width="+screen.availWidth+",height="+screen.availHeight+",left=0,top=0,popup");if(null==t)return void m("Please allow popups in your browser settings and try again.");t.stop(),t.focus();const n=new URLSearchParams;n.set("client_id","176227430389-qkdboctmfhe9jnvnk2vmarafc5p8amuf.apps.googleusercontent.com"),n.set("redirect_uri",e.origin+"/auth.xht"),n.set("response_type","token"),n.set("state","12"),n.set("scope","email profile"),n.set("include_granted_scopes","true"),n.set("enable_granular_consent","true"),t.location.replace("https://accounts.google.com/o/oauth2/v2/auth?"+n.toString())};{const gi=e=>{(e=new URLSearchParams(e).get("access_token")||"").length>0&&v(0,e).then((e=>{x.set("__secrets_",S=e),ai()})).catch((e=>{console.error(e),m("Failed to retrieve login tokens. (See console logs for details)")}))},_i=x.get("_cre_");null==_i?e.addEventListener("message",(t=>{if(t.origin===e.origin){const e=t.data;"string"==typeof e&&e.length>0&&gi(e)}}),{once:!1,passive:!0}):(gi(_i),x.delete("_cre_"))}}else await ai()}})(window)})();